// --- NOVO: DICIONÃRIO DE TRADUÃ‡ÃƒO DA FASE 1 ---
// Baseado no PDF "TraduÃ§Ã£o Jogo (1).pdf"
const gameTranslations = {
<<<<<<< HEAD
Â  Â  'pt': {
Â  Â  Â  Â  // Chaves EstÃ¡ticas (do HTML)
Â  Â  Â  Â  fase1_titulo: "SafeQuest - Como Montar Cestas",
Â  Â  Â  Â  orientation_titulo: "Vire o seu dispositivo",
Â  Â  Â  Â  orientation_texto: "Para uma melhor experiÃªncia, este jogo deve ser jogado com a tela na horizontal.",
Â  Â  Â  Â  safequest_titulo: "SafeQuest",
Â  Â  Â  Â  fase1_subtitulo: "Fase 1: Como Montar Cestas de Suprimentos",
Â  Â  Â  Â  fase1_descricao: "Monte as cestas de acordo com o pedido da Arara Azul! Arraste os alimentos da esteira para os espaÃ§os e verifique se acertou.",
Â  Â  Â  Â  btn_comecar: "ComeÃ§ar!",
Â  Â  Â  Â  btn_continuar: "Continuar",
Â  Â  Â  Â  end_titulo_padrao: "Tempo Esgotado!",
Â  Â  Â  Â  end_titulo_vitoria: "Mestre da NutriÃ§Ã£o!",
Â  Â  Â  Â  end_score_texto_1: "VocÃª fez",
Â  Â  Â  Â  end_score_texto_2: "pedidos corretos!",
Â  Â  Â  Â  btn_jogar_novo: "Jogar de Novo",
Â  Â  Â  Â  livro_pag_ant: "â—€ PÃ¡gina Anterior",
Â  Â  Â  Â  livro_pag_prox: "PrÃ³xima PÃ¡gina â–¶",
Â  Â  Â  Â  pagina_indicador: "PÃ¡gina",
Â  Â  Â  Â  de_indicador: "de",
Â  Â  Â  Â  detalhe_descricao: "DescriÃ§Ã£o",
Â  Â  Â  Â  detalhe_curiosidade: "ğŸ’¡ Curiosidade Divertida",
Â  Â  Â  Â  detalhe_info: "ğŸ“Š InformaÃ§Ãµes Nutricionais",
Â  Â  Â  Â  header_pedidos: "Pedidos:",
Â  Â  Â  Â  header_etapa: "Etapa",
Â  Â  Â  Â  livro_titulo_hover: "Guia de Alimentos",
Â  Â  Â  Â  pedido_atual: "Pedido Atual:",
Â  Â  Â  Â  btn_verificar: "Verificar",
Â  Â  Â  Â  almanaque_titulo_carb: "Carboidratos",
Â  Â  Â  Â  almanaque_titulo_prot: "ProteÃ­nas",
Â  Â  Â  Â  almanaque_titulo_vit: "Vitaminas e Minerais",
Â  Â  Â  Â  almanaque_titulo_pega: "Pegadinhas (NÃ£o saudÃ¡veis)",

Â  Â  Â  Â  // DiÃ¡logos DinÃ¢micos (do PDF)
Â  Â  Â  Â  tutorial_title: "Tutorial (Montagem de cestas de suprimentos)",
Â  Â  Â  Â  tutorial: "OlÃ¡! Bem-vindo Ã  EstaÃ§Ã£o de NutriÃ§Ã£o. Aqui, sua missÃ£o Ã© montar cestas de alimentos equilibradas, seguindo os pedidos que aparecem na tela. Cada pedido precisa de trÃªs alimentos, e vocÃª pode arrastar os itens da esteira atÃ© as cestas para completÃ¡-lo. Quando tudo estiver certo, o botÃ£o de verificaÃ§Ã£o ficarÃ¡ aceso e vocÃª poderÃ¡ conferir o resultado. A cada acerto, o tempo aumenta, e novos pedidos surgem. EstÃ¡ pronto para comeÃ§ar a preparar refeiÃ§Ãµes saudÃ¡veis?",
Â  Â  Â  Â  stage1_title: "Etapa 1 - Carboidratos",
Â  Â  Â  Â  stage1: "Vamos comeÃ§ar pelos carboidratos. Eles sÃ£o os alimentos que dÃ£o energia para o corpo e ajudam a manter o ritmo do dia. PÃ£es, massas, arroz e batatas sÃ£o alguns exemplos. Observe a esteira e monte as cestas com alimentos desse grupo. Ã‰ sÃ³ arrastar cada item atÃ© o espaÃ§o certo e verificar o pedido.",
Â  Â  Â  Â  stage2_title: "Etapa 2 - ProteÃ­nas",
Â  Â  Â  Â  stage2: "Agora Ã© hora de adicionar as proteÃ­nas. Elas sÃ£o importantes para os mÃºsculos, o crescimento e a recuperaÃ§Ã£o do corpo. Carnes, ovos, feijÃ£o e leite fazem parte desse grupo. Continue montando as cestas, combinando carboidratos e proteÃ­nas para formar refeiÃ§Ãµes mais completas.",
Â  Â  Â  Â  stage3_title: "Etapa 3 - Vitaminas e Minerais",
Â  Â  Â  Â  stage3: "Estamos progredindo bem! Agora vamos incluir alimentos ricos em vitaminas e minerais. Eles fortalecem o corpo, aumentam a imunidade e deixam tudo funcionando do jeito certo. Frutas, verduras e legumes fazem parte dessa categoria. Complete as cestas escolhendo um alimento de cada grupo: carboidrato, proteÃ­na e vitaminas/minerais.",
Â  Â  Â  Â  stage4_title: "Etapa 4 - Alimentos 'Pegadinhas'",
Â  Â  Â  Â  stage4: "Agora chegou o verdadeiro desafio! Alguns alimentos parecem saudÃ¡veis, mas nÃ£o sÃ£o. SÃ£o as chamadas 'pegadinhas'. Eles tÃªm muito aÃ§Ãºcar, gordura ou ingredientes artificiais. Fique atento e evite colocÃ¡-los nas cestas. Escolha sempre as opÃ§Ãµes mais naturais e nutritivas.",
Â  Â  Â  Â  praise: [
Â  Â  Â  Â  Â  Â  "Excelente escolha! O pedido ficou perfeito e cheio de alimentos saudÃ¡veis.",
Â  Â  Â  Â  Â  Â  "Tudo certo! Essa cesta estÃ¡ equilibrada e nutritiva, do jeito que precisa ser.",
Â  Â  Â  Â  Â  Â  "Ã“timo trabalho! Essa combinaÃ§Ã£o Ã© ideal para manter uma boa alimentaÃ§Ã£o.",
Â  Â  Â  Â  Â  Â  "Perfeito! VocÃª montou a cesta corretamente e mostrou que estÃ¡ aprendendo bem sobre nutriÃ§Ã£o."
Â  Â  Â  Â  ],
Â  Â  Â  Â  hints: [
Â  Â  Â  Â  Â  Â  "Alguns alimentos nÃ£o combinam com o pedido atual. Observe o painel e veja o que estÃ¡ sendo solicitado antes de confirmar novamente.",
Â  Â  Â  Â  Â  Â  "Ops! Um dos alimentos escolhidos nÃ£o faz parte do grupo certo. Use o almanaque para revisar as categorias e tente de novo.",
Â  Â  Â  Â  Â  Â  "Essa cesta ainda pode melhorar. Verifique se todos os alimentos estÃ£o de acordo com o grupo pedido.",
Â  Â  Â  Â  Â  Â  "Quase tudo certo! SÃ³ revise os itens que nÃ£o pertencem ao grupo solicitado e faÃ§a os ajustes."
Â  Â  Â  Â  ],
Â  Â  Â  Â  variety: [
Â  Â  Â  Â  Â  Â  "Essa comida Ã© boa, mas existem muitas outras opÃ§Ãµes saudÃ¡veis! Experimente variar um pouco para deixar a refeiÃ§Ã£o mais equilibrada.",
Â  Â  Â  Â  Â  Â  "Lembre-se de que a alimentaÃ§Ã£o saudÃ¡vel tambÃ©m depende da diversidade. Tente usar alimentos diferentes para completar os prÃ³ximos pedidos.",
Â  Â  Â  Â  Â  Â  "Evitar repetiÃ§Ãµes Ã© importante! Varie os ingredientes e descubra novos alimentos nutritivos."
Â  Â  Â  Â  ],
Â  Â  Â  Â  performance: [
Â  Â  Â  Â  Â  Â  "VocÃª comeÃ§ou bem e jÃ¡ entendeu os primeiros passos para montar cestas equilibradas. Algumas escolhas ainda precisam de atenÃ§Ã£o, mas cada tentativa Ã© uma nova oportunidade de aprender mais sobre alimentaÃ§Ã£o saudÃ¡vel. Continue praticando, e logo conseguirÃ¡ montar cestas completas e nutritivas.",
Â  Â  Â  Â  Â  Â  "Excelente progresso! VocÃª mostrou que jÃ¡ sabe equilibrar bem os grupos alimentares e estÃ¡ aprendendo a identificar as opÃ§Ãµes corretas. Continue treinando sua atenÃ§Ã£o e logo alcanÃ§arÃ¡s resultados ainda melhores. Seu conhecimento estÃ¡ crescendo, assim como sua consciÃªncia sobre o que Ã© comer bem.",
Â  Â  Â  Â  Â  Â  "IncrÃ­vel! Todas as cestas foram montadas com atenÃ§Ã£o e equilÃ­brio. Seu desempenho mostra que vocÃª entende como formar refeiÃ§Ãµes saudÃ¡veis e variadas. Com esse conhecimento, vocÃª estÃ¡ pronto para ensinar outros a cuidar da alimentaÃ§Ã£o tambÃ©m. ParabÃ©ns por conquistar o tÃ­tulo de Mestre da NutriÃ§Ã£o!"
Â  Â  Â  Â  ],
Â  Â  Â  Â  defeat: [
Â  Â  Â  Â  Â  Â  "VocÃª nÃ£o conseguiu montar todos os pedidos a tempo, mas isso faz parte do aprendizado. Separar os grupos alimentares corretamente exige prÃ¡tica. Tente novamente e verÃ¡ como ficarÃ¡ mais fÃ¡cil reconhecer os alimentos certos.",
Â  Â  Â  Â  Â  Â  "O tempo acabou antes que todos os pedidos fossem montados. NÃ£o desanime! Observe com calma o que cada pedido solicita e use o almanaque se precisar de ajuda. A prÃ³xima tentativa serÃ¡ melhor.",
Â  Â  Â  Â  Â  Â  "Dessa vez o tempo nÃ£o foi suficiente, mas seu esforÃ§o jÃ¡ fez diferenÃ§a. Continue praticando para montar as cestas mais rÃ¡pido e com mais precisÃ£o. A prÃ¡tica leva ao equilÃ­brio!"
Â  Â  Â  Â  ],
Â  Â  Â  Â  other: [
Â  Â  Â  Â  Â  Â  "O tempo estÃ¡ passando, mas ainda dÃ¡ para montar mais cestas! Continue atento aos pedidos.",
Â  Â  Â  Â  Â  Â  "Se ficar em dÃºvida, abra o almanaque e relembre os grupos alimentares. Ele estÃ¡ sempre disponÃ­vel.",
Â  Â  Â  Â  Â  Â  "Cada cesta correta ajuda a manter a saÃºde da tripulaÃ§Ã£o da EstaÃ§Ã£o de NutriÃ§Ã£o. Continue com esse ritmo!",
Â  Â  Â  Â  Â  Â  "Montar pedidos saudÃ¡veis Ã© um Ã³timo treino para o dia a dia. VocÃª estÃ¡ se saindo muito bem.",
Â  Â  Â  Â  Â  Â  "Arraste os alimentos da esteira atÃ© as cestas para montar o pedido.",
Â  Â  Â  Â  Â  Â  "Mova os alimentos e forme cestas equilibradas.",
Â  Â  Â  Â  Â  Â  "Ao terminar, selecione o botÃ£o de verificaÃ§Ã£o para conferir o pedido.",
Â  Â  Â  Â  Â  Â  "Se errar, selecione o item incorreto para removÃª-lo e tentar novamente.",
Â  Â  Â  Â  Â  Â  "O tempo estÃ¡ acabando! Seja rÃ¡pido e complete o maior nÃºmero de cestas possÃ­vel."
Â  Â  Â  Â  ]
Â  Â  },
Â  Â  'en': {
Â  Â  Â  Â  // Chaves EstÃ¡ticas (do HTML)
Â  Â  Â  Â  fase1_titulo: "SafeQuest - How to Assemble Baskets",
Â  Â  Â  Â  orientation_titulo: "Turn your device",
Â  Â  Â  Â  orientation_texto: "For a better experience, this game should be played with the screen horizontally.",
Â  Â  Â  Â  safequest_titulo: "SafeQuest",
Â  Â  Â  Â  fase1_subtitulo: "Level 1: How to Assemble Supply Baskets",
Â  Â  Â  Â  fase1_descricao: "Assemble the baskets according to the Blue Macaw's order! Drag the food from the conveyor belt to the spaces and check if you got it right.",
Â  Â  Â  Â  btn_comecar: "Start!",
Â  Â  Â  Â  btn_continuar: "Continue",
Â  Â  Â  Â  end_titulo_padrao: "Time's Up!",
Â  Â  Â  Â  end_titulo_vitoria: "Master of Nutrition!",
Â  Â  Â  Â  end_score_texto_1: "You made",
Â  Â  Â  Â  end_score_texto_2: "correct orders!",
Â  Â  Â  Â  btn_jogar_novo: "Play Again",
Â  Â  Â  Â  livro_pag_ant: "â—€ Previous Page",
Â  Â  Â  Â  livro_pag_prox: "Next Page â–¶",
Â  Â  Â  Â  pagina_indicador: "Page",
Â  Â  Â  Â  de_indicador: "of",
Â  Â  Â  Â  detalhe_descricao: "Description",
Â  Â  Â  Â  detalhe_curiosidade: "ğŸ’¡ Fun Fact",
Â  Â  Â  Â  detalhe_info: "ğŸ“Š Nutritional Information",
Â  Â  Â  Â  header_pedidos: "Orders:",
Â  Â  Â  Â  header_etapa: "Stage",
Â  Â  Â  Â  livro_titulo_hover: "Food Guide",
Â  Â  Â  Â  pedido_atual: "Current Order:",
Â  Â  Â  Â  btn_verificar: "Check",
Â  Â  Â  Â  almanaque_titulo_carb: "Carbohydrates",
Â  Â  Â  Â  almanaque_titulo_prot: "Proteins",
Â  Â  Â  Â  almanaque_titulo_vit: "Vitamins and Minerals",
Â  Â  Â  Â  almanaque_titulo_pega: "Trick Foods (Unhealthy)",

Â  Â  Â  Â  // DiÃ¡logos DinÃ¢micos (do PDF)
Â  Â  Â  Â  tutorial_title: "Tutorial (Assembling supply baskets)",
Â  Â  Â  Â  tutorial: "Hello! Welcome to the Nutrition Station. Here, your mission is to assemble balanced food baskets, following the orders that appear on the screen. Each order requires three foods, and you can drag the items from the conveyor belt to the baskets to complete it. When everything is correct, the check button will light up and you can check the result. With each correct answer, the time increases and new orders appear. Are you ready to start preparing healthy meals?",
Â  Â  Â  Â  stage1_title: "Step 1 - Carbohydrates",
Â  Â  Â  Â  stage1: "Let's start with carbohydrates. These are foods that provide energy for the body and help you keep up with your daily routine. Bread, pasta, rice and potatoes are some examples. Look at the conveyor belt and fill the baskets with foods from this group. Just drag each item to the right space and check your order.",
Â  Â  Â  Â  stage2_title: "Step 2 - Proteins",
Â  Â  Â  Â  stage2: "Now it's time to add protein. Protein is important for muscles, growth, and recovery. Meat, eggs, beans, and milk are part of this group. Continue assembling the baskets, combining carbohydrates and protein to create more complete meals.",
Â  Â  Â  Â  stage3_title: "Step 3 - Vitamins and Minerals",
Â  Â  Â  Â  stage3: "We're making good progress! Now let's include foods rich in vitamins and minerals. They strengthen the body, boost immunity, and keep everything working properly. Fruits and vegetables are part of this category. Complete the baskets by choosing one food from each group: carbohydrates, protein, and vitamins/minerals.",
Â  Â  Â  Â  stage4_title: "Step 4 - Trick foods",
Â  Â  Â  Â  stage4: "Now comes the real challenge! Some foods appear healthy, but they are not. These are called 'tricky' foods. They contain a lot of sugar, fat, or artificial ingredients. Be aware and avoid putting them in your shopping cart. Always choose the most natural and nutritious options.",
Â  Â  Â  Â  praise: [
Â  Â  Â  Â  Â  Â  "Excellent choice! The order is perfect and full of healthy foods.",
Â  Â  Â  Â  Â  Â  "All right! This basket is balanced and nutritious, just the way it should be.",
Â  Â  Â  Â  Â  Â  "Great job! This combination is ideal for maintaining a good diet.",
Â  Â  Â  Â  Â  Â  "Perfect! You put the basket together correctly and showed that you are learning well about nutrition."
Â  Â  Â  Â  ],
Â  Â  Â  Â  hints: [
Â  Â  Â  Â  Â  Â  "Some foods do not match the current order. Check the panel and see what is being requested before confirming again.",
Â  Â  Â  Â  Â  Â  "Oops! One of the foods chosen is not part of the right group. Use the almanac to review the categories and try again.",
Â  Â  Â  Â  Â  Â  "This basket can still be improved. Check that all foods are in accordance with the requested group.",
Â  Â  Â  Â  Â  Â  "Almost everything is right! Just review the items that do not belong to the requested group and make adjustments."
Â  Â  Â  Â  ],
Â  Â  Â  Â  variety: [
Â  Â  Â  Â  Â  Â  "This food is good, but there are many other healthy options! Try varying it a little to make the meal more balanced.",
Â  Â  Â  Â  Â  Â  "Remember that healthy eating also depends on diversity. Try to use different foods to complete your next orders.",
Â  Â  Â  Â  Â  Â  "Avoiding repetition is important! Vary the ingredients and discover new nutritious foods."
Â  Â  Â  Â  ],
Â  Â  Â  Â  performance: [
Â  Â  Â  Â  Â  Â  "You've started well and already understand the first steps to putting together balanced baskets. Some choices still need attention, but each attempt is a new opportunity to learn more about healthy eating. Keep practicing, and soon you'll be able to put together complete and nutritious baskets.",
Â  Â  Â  Â  Â  Â  "Excellent progress! You have shown that you already know how to balance food groups well and are learning to identify the right options. Keep training your attention and you will soon achieve even better results. Your knowledge is growing, as is your awareness of what it means to eat well.",
Â  Â  Â  Â  Â  Â  "Amazing! All the baskets were assembled with care and balance. Your performance shows that you understand how to put together healthy meals and varied. With this knowledge, you are ready to teach others how to take care of their nutrition as well. Congratulations on earning the title of Master of Nutrition!"
Â  Â  Â  Â  ],
Â  Â  Â  Â  defeat: [
Â  Â  Â  Â  Â  Â  "You weren't able to assemble all the orders on time, but that's part of the learning process. Sorting food groups correctly takes practice. Try again and you'll see how much easier it becomes to recognize the right foods.",
Â  Â  Â  Â  Â  Â  "Time ran out before all the orders were assembled. Don't be discouraged! Calmly observe what each order requires and use the almanac if you need help. The next attempt will be better.",
Â  Â  Â  Â  Â  Â  "This time there wasn't enough time, but your effort has already made a difference. Keep practicing to assemble the baskets faster and more accurately. Practice makes perfect!"
Â  Â  Â  Â  ],
Â  Â  Â  Â  other: [
Â  Â  Â  Â  Â  Â  "Time is running out, but there's still time to put together more baskets! Keep an eye on the orders.",
Â  Â  Â  Â  Â  Â  "If in doubt, open the almanac and review the food groups. It's always available.",
Â  Â  Â  Â  Â  Â  "Each correct basket helps keep the Nutrition Station crew healthy. Keep up the good work!",
Â  Â  Â  Â  Â  Â  "Putting together healthy orders is great practice for everyday life. You're doing very well.",
Â  Â  Â  Â  Â  Â  "Drag the food from the conveyor belt to the baskets to assemble the order.",
Â  Â  Â  Â  Â  Â  "Move the food and form balanced baskets.",
Â  Â  Â  Â  Â  Â  "When finished, select the check button to check the order.",
Â  Â  Â  Â  Â  Â  "If you make a mistake, select the incorrect item to remove it and try again.",
Â  Â  Â  Â  Â  Â  "Time is running out! Be quick and complete as many baskets as possible."
Â  Â  Â  Â  ]
Â  Â  },
Â  Â  'es': {
Â  Â  Â  Â  // Chaves EstÃ¡ticas (do HTML)
Â  Â  Â  Â  fase1_titulo: "SafeQuest - CÃ³mo Armar Canastas",
Â  Â  Â  Â  orientation_titulo: "Gira tu dispositivo",
Â  Â  Â  Â  orientation_texto: "Para una mejor experiencia, este juego debe jugarse con la pantalla en horizontal.",
Â  Â  Â  Â  safequest_titulo: "SafeQuest",
Â  Â  Â  Â  fase1_subtitulo: "Nivel 1: CÃ³mo Armar Canastas de Suministros",
Â  Â  Â  Â  fase1_descricao: "Â¡Arma las canastas segÃºn el pedido del Guacamayo Azul! Arrastra los alimentos de la cinta a los espacios y comprueba si acertaste.",
Â  Â  Â  Â  btn_comecar: "Â¡Empezar!",
Â  Â  Â  Â  btn_continuar: "Continuar",
Â  Â  Â  Â  end_titulo_padrao: "Â¡Tiempo Agotado!",
Â  Â  Â  Â  end_titulo_vitoria: "Â¡Maestro de la NutriciÃ³n!",
Â  Â  Â  Â  end_score_texto_1: "Â¡Hiciste",
Â  Â  Â  Â  end_score_texto_2: "pedidos correctos!",
Â  Â  Â  Â  btn_jogar_novo: "Jugar de Nuevo",
Â  Â  Â  Â  livro_pag_ant: "â—€ PÃ¡gina Anterior",
Â  Â  Â  Â  livro_pag_prox: "PÃ¡gina Siguiente â–¶",
Â  Â  Â  Â  pagina_indicador: "PÃ¡gina",
Â  Â  Â  Â  de_indicador: "de",
Â  Â  Â  Â  detalhe_descricao: "DescripciÃ³n",
Â  Â  Â  Â  detalhe_curiosidade: "ğŸ’¡ Dato Curioso",
Â  Â  Â  Â  detalhe_info: "ğŸ“Š InformaciÃ³n Nutricional",
Â  Â  Â  Â  header_pedidos: "Pedidos:",
Â  Â  Â  Â  header_etapa: "Etapa",
Â  Â  Â  Â  livro_titulo_hover: "GuÃ­a de Alimentos",
Â  Â  Â  Â  pedido_atual: "Pedido Actual:",
Â  Â  Â  Â  btn_verificar: "Verificar",
Â  Â  Â  Â  almanaque_titulo_carb: "Carbohidratos",
Â  Â  Â  Â  almanaque_titulo_prot: "ProteÃ­nas",
Â  Â  Â  Â  almanaque_titulo_vit: "Vitaminas y Minerales",
Â  Â  Â  Â  almanaque_titulo_pega: "Alimentos Trampa (No saludables)",

Â  Â  Â  Â  // DiÃ¡logos DinÃ¢micos (do PDF)
Â  Â  Â  Â  tutorial_title: "Tutorial (Montaje de canastas de alimentos)",
Â  Â  Â  Â  tutorial: "Â¡Hola! Bienvenido a la EstaciÃ³n de NutriciÃ³n. AquÃ­, tu misiÃ³n es armar canastas de alimentos equilibrados, siguiendo los pedidos que aparecen em la pantalla. Cada pedido necesita tres alimentos, y puedes arrastrar los artÃ­culos de la cinta transportadora a las canastas para completarlo. Cuando todo estÃ© correcto, el botÃ³n de verificaciÃ³n se iluminarÃ¡ y podrÃ¡s comprobar el resultado. Com cada acierta, el tiempo aumenta y aparecen nuevos pedidos. Â¿EstÃ¡s listo para empezar a preparar comidas saludables?",
Â  Â  Â  Â  stage1_title: "Paso 1 - Carbohidratos",
Â  Â  Â  Â  stage1: "Empecemos por los carbohidratos. Son los alimentos que dan energÃ­a al cuerpo y ayudan a mantener el ritmo del dÃ­a. El pan, la pasta, el arroz y las patatas son algunos ejemplos. Observe la cinta transportadora y llene las cestas com alimentos de este grupo. Solo tienes que arrastrar cada artÃ­culo al espacio correcto y comprobar el pedido.",
Â  Â  Â  Â  stage2_title: "Paso 2 - ProteÃ­nas",
Â  Â  Â  Â  stage2: "Ahora es el momento de aÃ±adir las proteÃ­nas. Son importantes para los mÃºsculos, el crecimiento y la recuperaciÃ³n del corpo. Las carnes, los huevos, las legumbres y la leche forman parte de este grupo. ContinÃºa preparando las cestas, combinando carbohidratos y proteÃ­nas para crear comidas mÃ¡s completas.",
Â  Â  Â  Â  stage3_title: "Paso 3 - Vitaminas y Minerales",
Â  Â  Â  Â  stage3: "Â¡Estamos progresando bien! Ahora vamos a incluir alimentos ricos em vitaminas y minerales. Estos fortalecen el cuerpo, aumentan la inmunidad y hacen que todo funcione correctamente. Las frutas y verduras forman parte de esta categorÃ­a. Completa las cestas eligiendo un alimento de cada grupo: carbohidratos, proteÃ­nas y vitaminas/minerales.",
Â  Â  Â  Â  stage4_title: "Paso 4 - Alimentos Trampa",
Â  Â  Â  Â  stage4: "Â¡Ahora llega el verdadero reto! Algunos alimentos parecen saludables, pero no lo son. Son los llamados engaÃ±osos. Tienen mucho azÃºcar, grasa oningredientes artificiales. Mantente alerta y evita ponerlos em la cesta. Elige siempre las opciones mÃ¡s naturales y nutritivas.",
Â  Â  Â  Â  praise: [
Â  Â  Â  Â  Â  Â  "Â¡Excelente elecciÃ³n! El pedido es perfecto y estÃ¡ lleno de alimentos saludables.",
Â  Â  Â  Â  Â  Â  "Â¡Todo bien! Esta cesta es equilibrada y nutritiva, tal y como debe ser.",
Â  Â  Â  Â  Â  Â  "Â¡Buen trabajo! Esta combinaciÃ³n es ideal para mantener una buena alimentaciÃ³n.",
Â  Â  Â  Â  Â  Â  "Â¡Perfecto! Has preparado la cesta correctamente y has demostrado que estÃ¡s aprendiendo bien sobre nutriciÃ³n."
Â  Â  Â  Â  ],
Â  Â  Â  Â  hints: [
Â  Â  Â  Â  Â  Â  "Algunos alimentos no coinciden con el pedido actual. Observe el panel y compruebe lo que se estÃ¡ solicitando antes de volver a confirmar.",
Â  Â  Â  Â  Â  Â  "Â¡Vaya! Uno de los alimentos elegidos no pertenece al grupo correcto. Utilice el almanaque para revisar las categorÃ­as e intÃ©ntelo de nuevo.",
Â  Â  Â  Â  Â  Â  "Esta cesta aÃºn puede mejorar. Comprueba que todos los alimentos estÃ©n de acuerdo com el grupo solicitado.",
Â  Â  Â  Â  Â  Â  "Â¡Casi todo correcto! Solo revisa los artÃ­culos que no pertenecen al grupo solicitado y haz los ajustes necesarios."
Â  Â  Â  Â  ],
Â  Â  Â  Â  variety: [
Â  Â  Â  Â  Â  Â  "Esta comida estÃ¡ buena, pero hay muchas otras opciones saludables. Intenta variar um poco para que la comida sea mÃ¡s equilibrada.",
Â  Â  Â  Â  Â  Â  "Recuerda que uma alimentaciÃ³n saludable tambiÃ©n depende de la diversidad. Intenta usar alimentos diferentes para completar los prÃ³ximos pedidos.",
Â  Â  Â  Â  Â  Â  "Â¡Es importante evitar las repeticiones! VarÃ­a los ingredientes y descubre nuevos alimentos nutritivos."
Â    Â  Â  ],
Â  Â  Â  Â  performance: [
Â  Â  Â  Â  Â  Â  "Has empezado bien y ya has comprendido los primeros pasos para preparar cestas equilibradas. Algunas elecciones aÃºn requieren atenciÃ³n, pero cada intento es uma nueva oportunidad para aprender mÃ¡s sobre la alimentaciÃ³n saludable. Sigue practicando y pronto podrÃ¡s preparar cestas completas y nutritivas.",
Â  Â  Â  Â  Â  Â  "Â¡Excelente progreso! Has demostrado que ya sabes equilibrar bien los grupos alimenticios y estÃ¡s aprendiendo a identificar las opciones correctas. Sigue entrenando tu atenciÃ³n y pronto alcanzarÃ¡s resultados aÃºn mejores. Tu conocimiento estÃ¡ creciendo, al igual que tu conciencia sobre lo que es comer bien.",
Â  Â  Â  Â  Â  Â  "Â¡IncreÃ­ble! Todas las cestas se han preparado com cuidado y equilibrio. Su trabajo demuestra que entiende cÃ³mo crear comidas saludables y variadas. Con estos conocimientos, estÃ¡s listo para enseÃ±ar a otros a cuidar tambiÃ©n su alimentaciÃ³n. Â¡Enhorabuena por conseguir el tÃ­tulo de Maestro en NutriciÃ³n!"
Â  Â  Â  Â  ],
Â  Â  Â  Â  defeat: [
Â  Â  Â  Â  Â  Â  "No has conseguido preparar todos los pedidos a tiempo, pero eso forma parte del aprendizaje. Separar correctamente los grupos de alimentos requiere prÃ¡ctica. Vuelve a intentarlo y verÃ¡s cÃ³mo cada vez te resultarÃ¡ mÃ¡s fÃ¡cil reconocer los alimentos correctos.",
Â  Â  Â  Â  Â  Â  "El tiempo se acabÃ³ antes de que se completaran todos los pedidos. Â¡No te desanimes! Observa con calma lo que pide cada pedido y utiliza el almanaque si necesitas ayuda. La prÃ³xima vez lo harÃ¡s mejor.",
Â  Â  Â  Â  Â  Â  "Esta vez no ha habido tiempo suficiente, pero tu esfuerzo ya ha marcado la diferencia. Sigue practicando para montar las cestas mÃ¡s rÃ¡pido y con mayor precisiÃ³n. Â¡La prÃ¡ctica leva al equilibrio!."
Â  Â  Â  Â  ],
Â  Â  Â  Â  other: [
Â  Â  Â  Â  Â  Â  "El tiempo pasa, pero aÃºn da tiempo a preparar mÃ¡s cestas. Sigue atento a los pedidos.",
Â  Â  Â  Â  Â  Â  "Si tienes dudas, abre el almanaque y recuerda los grupos de alimentos. Siempre estÃ¡ disponible",
Â  Â  Â  Â  Â  Â  "Cada cesta correcta ayuda a mantener la salud de la tripulaciÃ³n de la EstaciÃ³n de NutriciÃ³n. Â¡Sigue asÃ­!.",
Â  Â  Â  Â  Â  Â  "Preparar pedidos saludables es un excelente entrenamiento para el dÃ­a a dÃ­a. Lo estÃ¡s haciendo muy bien.",
Â  Â  Â  Â  Â  Â  "Arrastra los alimentos de la cinta transportadora a las cestas para preparar el pedido.",
Â  Â  Â  Â  Â  Â  "Mueve los alimentos y forma cestas equilibradas.",
Â  Â  Â  Â  Â  Â  "Cuando termines, selecciona el botÃ³n de verificaciÃ³n para revisar el pedido.",
Â  Â  Â  Â  Â  Â  "Si te equivocas, selecciona el artÃ­culo incorrecto para eliminarlo e intÃ©ntalo de nuevo.",
Â  Â  Â  Â  Â  Â  "Â¡El tiempo se acaba! Sea rÃ¡pido y complete el mayor nÃºmero de cestas posible."
Â  Â  Â  Â  ]
Â  Â  }
};

// --- NOVO: FUNÃ‡Ã•ES DE TRADUÃ‡ÃƒO E CONFIGURAÃ‡ÃƒO ---

/**
 * Pega o idioma E o modo de cor salvos no localStorage pelo menu.
 */
function getSettings() {
    const defaultSettings = { language: 'pt', colorMode: 'default' };
    try {
        const settingsString = localStorage.getItem('safequest-settings');
        if (settingsString) {
            const savedSettings = JSON.parse(settingsString);
            
            // Valida o idioma
            const lang = gameTranslations[savedSettings.language] 
                         ? savedSettings.language 
                         : defaultSettings.language;
            
            // Valida o modo de cor
            const validModes = ['default', 'high-contrast', 'colorblind-safe'];
            const mode = validModes.includes(savedSettings.colorMode) 
                       ? savedSettings.colorMode 
                       : defaultSettings.colorMode;
            
            return { language: lang, colorMode: mode };
        }
    } catch (e) {
        console.error("Erro ao carregar configuraÃ§Ãµes:", e);
    }
    // Retorna o padrÃ£o se nada for encontrado
    return defaultSettings;
}

/**
* Aplica as traduÃ§Ãµes aos elementos estÃ¡ticos da pÃ¡gina.
*/
function translatePage(lang) {
Â  Â  const translations = gameTranslations[lang];
Â  Â  if (!translations) {
Â  Â  Â  Â  console.warn(`TraduÃ§Ã£o para '${lang}' nÃ£o encontrada.`);
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // Traduz todos os elementos com 'data-key'
Â  Â  document.querySelectorAll('[data-key]').forEach(element => {
Â  Â  Â  Â  const key = element.dataset.key;
Â  Â  Â  Â  if (translations[key]) {
Â  Â  Â  Â  Â  Â  element.textContent = translations[key];
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // Traduz o <title> da pÃ¡gina
Â  Â  const titleElement = document.querySelector('title[data-key="fase1_titulo"]');
Â  Â  if (titleElement && translations.fase1_titulo) {
Â  Â  Â  Â  document.title = translations.fase1_titulo;
Â  Â  }

Â  Â  // Traduz atributos 'title' (usando 'data-title-key')
Â  Â  document.querySelectorAll('[data-title-key]').forEach(element => {
Â  Â  Â  Â  const key = element.dataset.titleKey;
Â  Â  Â  Â  if (translations[key]) {
Â  Â  Â  Â  Â  Â  element.setAttribute('title', translations[key]);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // Casos especiais (elementos com spans dentro)
Â  Â  const scoreText = document.querySelector('[data-key="header_pedidos"]');
Â  Â  if (scoreText) scoreText.textContent = translations.header_pedidos;

Â  Â  const stageText = document.querySelector('[data-key="header_etapa"]');
Â  Â  if (stageText) stageText.textContent = translations.header_etapa;

Â  Â  const endScore1 = document.querySelector('[data-key="end_score_texto_1"]');
Â  Â  if (endScore1) endScore1.textContent = translations.end_score_texto_1;
Â  Â Â 
Â  Â  const endScore2 = document.querySelector('[data-key="end_score_texto_2"]');
Â  Â  if (endScore2) endScore2.textContent = translations.end_score_texto_2;
=======
    'pt': {
        // Chaves EstÃ¡ticas (do HTML)
        fase1_titulo: "SafeQuest - Como Montar Cestas",
        orientation_titulo: "Vire o seu dispositivo",
        orientation_texto: "Para uma melhor experiÃªncia, este jogo deve ser jogado com a tela na horizontal.",
        safequest_titulo: "SafeQuest",
        fase1_subtitulo: "Fase 1: Como Montar Cestas de Suprimentos",
        fase1_descricao: "Monte as cestas de acordo com o pedido da Arara Azul! Arraste os alimentos da esteira para os espaÃ§os e verifique se acertou.",
        btn_comecar: "ComeÃ§ar!",
        btn_continuar: "Continuar",
        end_titulo_padrao: "Tempo Esgotado!",
        end_titulo_vitoria: "Mestre da NutriÃ§Ã£o!",
        end_score_texto_1: "VocÃª fez",
        end_score_texto_2: "pedidos corretos!",
        btn_jogar_novo: "Jogar de Novo",
        livro_pag_ant: "â—€ PÃ¡gina Anterior",
        livro_pag_prox: "PrÃ³xima PÃ¡gina â–¶",
        pagina_indicador: "PÃ¡gina",
        de_indicador: "de",
        detalhe_descricao: "DescriÃ§Ã£o",
        detalhe_curiosidade: "ğŸ’¡ Curiosidade Divertida",
        detalhe_info: "ğŸ“Š InformaÃ§Ãµes Nutricionais",
        header_pedidos: "Pedidos:",
        header_etapa: "Etapa",
        livro_titulo_hover: "Guia de Alimentos",
        pedido_atual: "Pedido Atual:",
        btn_verificar: "Verificar",
        almanaque_titulo_carb: "Carboidratos",
        almanaque_titulo_prot: "ProteÃ­nas",
        almanaque_titulo_vit: "Vitaminas e Minerais",
        almanaque_titulo_pega: "Pegadinhas (NÃ£o saudÃ¡veis)",

        // DiÃ¡logos DinÃ¢micos (do PDF)
        tutorial_title: "Tutorial (Montagem de cestas de suprimentos)",
        tutorial: "OlÃ¡! Bem-vindo Ã  EstaÃ§Ã£o de NutriÃ§Ã£o. Aqui, sua missÃ£o Ã© montar cestas de alimentos equilibradas, seguindo os pedidos que aparecem na tela. Cada pedido precisa de trÃªs alimentos, e vocÃª pode arrastar os itens da esteira atÃ© as cestas para completÃ¡-lo. Quando tudo estiver certo, o botÃ£o de verificaÃ§Ã£o ficarÃ¡ aceso e vocÃª poderÃ¡ conferir o resultado. A cada acerto, o tempo aumenta, e novos pedidos surgem. EstÃ¡ pronto para comeÃ§ar a preparar refeiÃ§Ãµes saudÃ¡veis?",
        stage1_title: "Etapa 1 - Carboidratos",
        stage1: "Vamos comeÃ§ar pelos carboidratos. Eles sÃ£o os alimentos que dÃ£o energia para o corpo e ajudam a manter o ritmo do dia. PÃ£es, massas, arroz e batatas sÃ£o alguns exemplos. Observe a esteira e monte as cestas com alimentos desse grupo. Ã‰ sÃ³ arrastar cada item atÃ© o espaÃ§o certo e verificar o pedido.",
        stage2_title: "Etapa 2 - ProteÃ­nas",
        stage2: "Agora Ã© hora de adicionar as proteÃ­nas. Elas sÃ£o importantes para os mÃºsculos, o crescimento e a recuperaÃ§Ã£o do corpo. Carnes, ovos, feijÃ£o e leite fazem parte desse grupo. Continue montando as cestas, combinando carboidratos e proteÃ­nas para formar refeiÃ§Ãµes mais completas.",
        stage3_title: "Etapa 3 - Vitaminas e Minerais",
        stage3: "Estamos progredindo bem! Agora vamos incluir alimentos ricos em vitaminas e minerais. Eles fortalecem o corpo, aumentam a imunidade e deixam tudo funcionando do jeito certo. Frutas, verduras e legumes fazem parte dessa categoria. Complete as cestas escolhendo um alimento de cada grupo: carboidrato, proteÃ­na e vitaminas/minerais.",
        stage4_title: "Etapa 4 - Alimentos 'Pegadinhas'",
        stage4: "Agora chegou o verdadeiro desafio! Alguns alimentos parecem saudÃ¡veis, mas nÃ£o sÃ£o. SÃ£o as chamadas 'pegadinhas'. Eles tÃªm muito aÃ§Ãºcar, gordura ou ingredientes artificiais. Fique atento e evite colocÃ¡-los nas cestas. Escolha sempre as opÃ§Ãµes mais naturais e nutritivas.",
        praise: [
            "Excelente escolha! O pedido ficou perfeito e cheio de alimentos saudÃ¡veis.",
            "Tudo certo! Essa cesta estÃ¡ equilibrada e nutritiva, do jeito que precisa ser.",
            "Ã“timo trabalho! Essa combinaÃ§Ã£o Ã© ideal para manter uma boa alimentaÃ§Ã£o.",
            "Perfeito! VocÃª montou a cesta corretamente e mostrou que estÃ¡ aprendendo bem sobre nutriÃ§Ã£o."
        ],
        hints: [
            "Alguns alimentos nÃ£o combinam com o pedido atual. Observe o painel e veja o que estÃ¡ sendo solicitado antes de confirmar novamente.",
            "Ops! Um dos alimentos escolhidos nÃ£o faz parte do grupo certo. Use o almanaque para revisar as categorias e tente de novo.",
            "Essa cesta ainda pode melhorar. Verifique se todos os alimentos estÃ£o de acordo com o grupo pedido.",
            "Quase tudo certo! SÃ³ revise os itens que nÃ£o pertencem ao grupo solicitado e faÃ§a os ajustes."
        ],
        variety: [
            "Essa comida Ã© boa, mas existem muitas outras opÃ§Ãµes saudÃ¡veis! Experimente variar um pouco para deixar a refeiÃ§Ã£o mais equilibrada.",
            "Lembre-se de que a alimentaÃ§Ã£o saudÃ¡vel tambÃ©m depende da diversidade. Tente usar alimentos diferentes para completar os prÃ³ximos pedidos.",
            "Evitar repetiÃ§Ãµes Ã© importante! Varie os ingredientes e descubra novos alimentos nutritivos."
        ],
        performance: [
            "VocÃª comeÃ§ou bem e jÃ¡ entendeu os primeiros passos para montar cestas equilibradas. Algumas escolhas ainda precisam de atenÃ§Ã£o, mas cada tentativa Ã© uma nova oportunidade de aprender mais sobre alimentaÃ§Ã£o saudÃ¡vel. Continue praticando, e logo conseguirÃ¡ montar cestas completas e nutritivas.",
            "Excelente progresso! VocÃª mostrou que jÃ¡ sabe equilibrar bem os grupos alimentares e estÃ¡ aprendendo a identificar as opÃ§Ãµes corretas. Continue treinando sua atenÃ§Ã£o e logo alcanÃ§arÃ¡s resultados ainda melhores. Seu conhecimento estÃ¡ crescendo, assim como sua consciÃªncia sobre o que Ã© comer bem.",
            "IncrÃ­vel! Todas as cestas foram montadas com atenÃ§Ã£o e equilÃ­brio. Seu desempenho mostra que vocÃª entende como formar refeiÃ§Ãµes saudÃ¡veis e variadas. Com esse conhecimento, vocÃª estÃ¡ pronto para ensinar outros a cuidar da alimentaÃ§Ã£o tambÃ©m. ParabÃ©ns por conquistar o tÃ­tulo de Mestre da NutriÃ§Ã£o!"
        ],
        defeat: [
            "VocÃª nÃ£o conseguiu montar todos os pedidos a tempo, mas isso faz parte do aprendizado. Separar os grupos alimentares corretamente exige prÃ¡tica. Tente novamente e verÃ¡ como ficarÃ¡ mais fÃ¡cil reconhecer os alimentos certos.",
            "O tempo acabou antes que todos os pedidos fossem montados. NÃ£o desanime! Observe com calma o que cada pedido solicita e use o almanaque se precisar de ajuda. A prÃ³xima tentativa serÃ¡ melhor.",
            "Dessa vez o tempo nÃ£o foi suficiente, mas seu esforÃ§o jÃ¡ fez diferenÃ§a. Continue praticando para montar as cestas mais rÃ¡pido e com mais precisÃ£o. A prÃ¡tica leva ao equilÃ­brio!"
        ],
        other: [
            "O tempo estÃ¡ passando, mas ainda dÃ¡ para montar mais cestas! Continue atento aos pedidos.",
            "Se ficar em dÃºvida, abra o almanaque e relembre os grupos alimentares. Ele estÃ¡ sempre disponÃ­vel.",
            "Cada cesta correta ajuda a manter a saÃºde da tripulaÃ§Ã£o da EstaÃ§Ã£o de NutriÃ§Ã£o. Continue com esse ritmo!",
            "Montar pedidos saudÃ¡veis Ã© um Ã³timo treino para o dia a dia. VocÃª estÃ¡ se saindo muito bem.",
            "Arraste os alimentos da esteira atÃ© as cestas para montar o pedido.",
            "Mova os alimentos e forme cestas equilibradas.",
            "Ao terminar, selecione o botÃ£o de verificaÃ§Ã£o para conferir o pedido.",
            "Se errar, selecione o item incorreto para removÃª-lo e tentar novamente.",
            "O tempo estÃ¡ acabando! Seja rÃ¡pido e complete o maior nÃºmero de cestas possÃ­vel."
        ]
    },
    'en': {
        // Chaves EstÃ¡ticas (do HTML)
        fase1_titulo: "SafeQuest - How to Assemble Baskets",
        orientation_titulo: "Turn your device",
        orientation_texto: "For a better experience, this game should be played with the screen horizontally.",
        safequest_titulo: "SafeQuest",
        fase1_subtitulo: "Level 1: How to Assemble Supply Baskets",
        fase1_descricao: "Assemble the baskets according to the Blue Macaw's order! Drag the food from the conveyor belt to the spaces and check if you got it right.",
        btn_comecar: "Start!",
        btn_continuar: "Continue",
        end_titulo_padrao: "Time's Up!",
        end_titulo_vitoria: "Master of Nutrition!",
        end_score_texto_1: "You made",
        end_score_texto_2: "correct orders!",
        btn_jogar_novo: "Play Again",
        livro_pag_ant: "â—€ Previous Page",
        livro_pag_prox: "Next Page â–¶",
        pagina_indicador: "Page",
        de_indicador: "of",
        detalhe_descricao: "Description",
        detalhe_curiosidade: "ğŸ’¡ Fun Fact",
        detalhe_info: "ğŸ“Š Nutritional Information",
        header_pedidos: "Orders:",
        header_etapa: "Stage",
        livro_titulo_hover: "Food Guide",
        pedido_atual: "Current Order:",
        btn_verificar: "Check",
        almanaque_titulo_carb: "Carbohydrates",
        almanaque_titulo_prot: "Proteins",
        almanaque_titulo_vit: "Vitamins and Minerals",
        almanaque_titulo_pega: "Trick Foods (Unhealthy)",

        // DiÃ¡logos DinÃ¢micos (do PDF)
        tutorial_title: "Tutorial (Assembling supply baskets)",
        tutorial: "Hello! Welcome to the Nutrition Station. Here, your mission is to assemble balanced food baskets, following the orders that appear on the screen. Each order requires three foods, and you can drag the items from the conveyor belt to the baskets to complete it. When everything is correct, the check button will light up and you can check the result. With each correct answer, the time increases and new orders appear. Are you ready to start preparing healthy meals?",
        stage1_title: "Step 1 - Carbohydrates",
        stage1: "Let's start with carbohydrates. These are foods that provide energy for the body and help you keep up with your daily routine. Bread, pasta, rice and potatoes are some examples. Look at the conveyor belt and fill the baskets with foods from this group. Just drag each item to the right space and check your order.",
        stage2_title: "Step 2 - Proteins",
        stage2: "Now it's time to add protein. Protein is important for muscles, growth, and recovery. Meat, eggs, beans, and milk are part of this group. Continue assembling the baskets, combining carbohydrates and protein to create more complete meals.",
        stage3_title: "Step 3 - Vitamins and Minerals",
        stage3: "We're making good progress! Now let's include foods rich in vitamins and minerals. They strengthen the body, boost immunity, and keep everything working properly. Fruits and vegetables are part of this category. Complete the baskets by choosing one food from each group: carbohydrates, protein, and vitamins/minerals.",
        stage4_title: "Step 4 - Trick foods",
        stage4: "Now comes the real challenge! Some foods appear healthy, but they are not. These are called 'tricky' foods. They contain a lot of sugar, fat, or artificial ingredients. Be aware and avoid putting them in your shopping cart. Always choose the most natural and nutritious options.",
        praise: [
            "Excellent choice! The order is perfect and full of healthy foods.",
            "All right! This basket is balanced and nutritious, just the way it should be.",
            "Great job! This combination is ideal for maintaining a good diet.",
            "Perfect! You put the basket together correctly and showed that you are learning well about nutrition."
        ],
        hints: [
            "Some foods do not match the current order. Check the panel and see what is being requested before confirming again.",
            "Oops! One of the foods chosen is not part of the right group. Use the almanac to review the categories and try again.",
            "This basket can still be improved. Check that all foods are in accordance with the requested group.",
            "Almost everything is right! Just review the items that do not belong to the requested group and make adjustments."
        ],
        variety: [
            "This food is good, but there are many other healthy options! Try varying it a little to make the meal more balanced.",
            "Remember that healthy eating also depends on diversity. Try to use different foods to complete your next orders.",
            "Avoiding repetition is important! Vary the ingredients and discover new nutritious foods."
        ],
        performance: [
            "You've started well and already understand the first steps to putting together balanced baskets. Some choices still need attention, but each attempt is a new opportunity to learn more about healthy eating. Keep practicing, and soon you'll be able to put together complete and nutritious baskets.",
            "Excellent progress! You have shown that you already know how to balance food groups well and are learning to identify the right options. Keep training your attention and you will soon achieve even better results. Your knowledge is growing, as is your awareness of what it means to eat well.",
            "Amazing! All the baskets were assembled with care and balance. Your performance shows that you understand how to put together healthy meals and varied. With this knowledge, you are ready to teach others how to take care of their nutrition as well. Congratulations on earning the title of Master of Nutrition!"
        ],
        defeat: [
            "You weren't able to assemble all the orders on time, but that's part of the learning process. Sorting food groups correctly takes practice. Try again and you'll see how much easier it becomes to recognize the right foods.",
            "Time ran out before all the orders were assembled. Don't be discouraged! Calmly observe what each order requires and use the almanac if you need help. The next attempt will be better.",
            "This time there wasn't enough time, but your effort has already made a difference. Keep practicing to assemble the baskets faster and more accurately. Practice makes perfect!"
        ],
        other: [
            "Time is running out, but there's still time to put together more baskets! Keep an eye on the orders.",
            "If in doubt, open the almanac and review the food groups. It's always available.",
            "Each correct basket helps keep the Nutrition Station crew healthy. Keep up the good work!",
            "Putting together healthy orders is great practice for everyday life. You're doing very well.",
            "Drag the food from the conveyor belt to the baskets to assemble the order.",
            "Move the food and form balanced baskets.",
            "When finished, select the check button to check the order.",
            "If you make a mistake, select the incorrect item to remove it and try again.",
            "Time is running out! Be quick and complete as many baskets as possible."
        ]
    },
    'es': {
        // Chaves EstÃ¡ticas (do HTML)
        fase1_titulo: "SafeQuest - CÃ³mo Armar Canastas",
        orientation_titulo: "Gira tu dispositivo",
        orientation_texto: "Para una mejor experiencia, este juego debe jugarse con la pantalla en horizontal.",
        safequest_titulo: "SafeQuest",
        fase1_subtitulo: "Nivel 1: CÃ³mo Armar Canastas de Suministros",
        fase1_descricao: "Â¡Arma las canastas segÃºn el pedido del Guacamayo Azul! Arrastra los alimentos de la cinta a los espacios y comprueba si acertaste.",
        btn_comecar: "Â¡Empezar!",
        btn_continuar: "Continuar",
        end_titulo_padrao: "Â¡Tiempo Agotado!",
        end_titulo_vitoria: "Â¡Maestro de la NutriciÃ³n!",
        end_score_texto_1: "Â¡Hiciste",
        end_score_texto_2: "pedidos correctos!",
        btn_jogar_novo: "Jugar de Nuevo",
        livro_pag_ant: "â—€ PÃ¡gina Anterior",
        livro_pag_prox: "PÃ¡gina Siguiente â–¶",
        pagina_indicador: "PÃ¡gina",
        de_indicador: "de",
        detalhe_descricao: "DescripciÃ³n",
        detalhe_curiosidade: "ğŸ’¡ Dato Curioso",
        detalhe_info: "ğŸ“Š InformaciÃ³n Nutricional",
        header_pedidos: "Pedidos:",
        header_etapa: "Etapa",
        livro_titulo_hover: "GuÃ­a de Alimentos",
        pedido_atual: "Pedido Actual:",
        btn_verificar: "Verificar",
        almanaque_titulo_carb: "Carbohidratos",
        almanaque_titulo_prot: "ProteÃ­nas",
        almanaque_titulo_vit: "Vitaminas y Minerales",
        almanaque_titulo_pega: "Alimentos Trampa (No saludables)",

        // DiÃ¡logos DinÃ¢micos (do PDF)
        tutorial_title: "Tutorial (Montaje de canastas de alimentos)",
        tutorial: "Â¡Hola! Bienvenido a la EstaciÃ³n de NutriciÃ³n. AquÃ­, tu misiÃ³n es armar canastas de alimentos equilibrados, siguiendo los pedidos que aparecen em la pantalla. Cada pedido necesita tres alimentos, y puedes arrastrar los artÃ­culos de la cinta transportadora a las canastas para completarlo. Cuando todo estÃ© correcto, el botÃ³n de verificaciÃ³n se iluminarÃ¡ y podrÃ¡s comprobar el resultado. Com cada acierta, el tiempo aumenta y aparecen nuevos pedidos. Â¿EstÃ¡s listo para empezar a preparar comidas saludables?",
        stage1_title: "Paso 1 - Carbohidratos",
        stage1: "Empecemos por los carbohidratos. Son los alimentos que dan energÃ­a al cuerpo y ayudan a mantener el ritmo del dÃ­a. El pan, la pasta, el arroz y las patatas son algunos ejemplos. Observe la cinta transportadora y llene las cestas com alimentos de este grupo. Solo tienes que arrastrar cada artÃ­culo al espacio correcto y comprobar el pedido.",
        stage2_title: "Paso 2 - ProteÃ­nas",
        stage2: "Ahora es el momento de aÃ±adir las proteÃ­nas. Son importantes para los mÃºsculos, el crecimiento y la recuperaciÃ³n del corpo. Las carnes, los huevos, las legumbres y la leche forman parte de este grupo. ContinÃºa preparando las cestas, combinando carbohidratos y proteÃ­nas para crear comidas mÃ¡s completas.",
        stage3_title: "Paso 3 - Vitaminas y Minerales",
        stage3: "Â¡Estamos progresando bien! Ahora vamos a incluir alimentos ricos em vitaminas y minerales. Estos fortalecen el cuerpo, aumentan la inmunidad y hacen que todo funcione correctamente. Las frutas y verduras forman parte de esta categorÃ­a. Completa las cestas eligiendo un alimento de cada grupo: carbohidratos, proteÃ­nas y vitaminas/minerales.",
        stage4_title: "Paso 4 - Alimentos Trampa",
        stage4: "Â¡Ahora llega el verdadero reto! Algunos alimentos parecen saludables, pero no lo son. Son los llamados engaÃ±osos. Tienen mucho azÃºcar, grasa oningredientes artificiales. Mantente alerta y evita ponerlos em la cesta. Elige siempre las opciones mÃ¡s naturales y nutritivas.",
        praise: [
            "Â¡Excelente elecciÃ³n! El pedido es perfecto y estÃ¡ lleno de alimentos saludables.",
            "Â¡Todo bien! Esta cesta es equilibrada y nutritiva, tal y como debe ser.",
            "Â¡Buen trabajo! Esta combinaciÃ³n es ideal para mantener una buena alimentaciÃ³n.",
            "Â¡Perfecto! Has preparado la cesta correctamente y has demostrado que estÃ¡s aprendiendo bien sobre nutriciÃ³n."
        ],
        hints: [
            "Algunos alimentos no coinciden con el pedido actual. Observe el panel y compruebe lo que se estÃ¡ solicitando antes de volver a confirmar.",
            "Â¡Vaya! Uno de los alimentos elegidos no pertenece al grupo correcto. Utilice el almanaque para revisar las categorÃ­as e intÃ©ntelo de nuevo.",
            "Esta cesta aÃºn puede mejorar. Comprueba que todos los alimentos estÃ©n de acuerdo com el grupo solicitado.",
            "Â¡Casi todo correcto! Solo revisa los artÃ­culos que no pertenecen al grupo solicitado y haz los ajustes necesarios."
        ],
        variety: [
            "Esta comida estÃ¡ buena, pero hay muchas otras opciones saludables. Intenta variar um poco para que la comida sea mÃ¡s equilibrada.",
            "Recuerda que uma alimentaciÃ³n saludable tambiÃ©n depende de la diversidad. Intenta usar alimentos diferentes para completar los prÃ³ximos pedidos.",
            "Â¡Es importante evitar las repeticiones! VarÃ­a los ingredientes y descubre nuevos alimentos nutritivos."
        ],
        performance: [
            "Has empezado bien y ya has comprendido los primeros pasos para preparar cestas equilibradas. Algunas elecciones aÃºn requieren atenciÃ³n, pero cada intento es uma nueva oportunidad para aprender mÃ¡s sobre la alimentaciÃ³n saludable. Sigue practicando y pronto podrÃ¡s preparar cestas completas y nutritivas.",
            "Â¡Excelente progreso! Has demostrado que ya sabes equilibrar bien los grupos alimenticios y estÃ¡s aprendiendo a identificar las opciones correctas. Sigue entrenando tu atenciÃ³n y pronto alcanzarÃ¡s resultados aÃºn mejores. Tu conocimiento estÃ¡ creciendo, al igual que tu conciencia sobre lo que es comer bien.",
            "Â¡IncreÃ­ble! Todas las cestas se han preparado com cuidado y equilibrio. Su trabajo demuestra que entiende cÃ³mo crear comidas saludables y variadas. Con estos conocimientos, estÃ¡s listo para enseÃ±ar a otros a cuidar tambiÃ©n su alimentaciÃ³n. Â¡Enhorabuena por conseguir el tÃ­tulo de Maestro en NutriciÃ³n!"
        ],
        defeat: [
            "No has conseguido preparar todos los pedidos a tiempo, pero eso forma parte del aprendizaje. Separar correctamente los grupos de alimentos requiere prÃ¡ctica. Vuelve a intentarlo y verÃ¡s cÃ³mo cada vez te resultarÃ¡ mÃ¡s fÃ¡cil reconocer los alimentos correctos.",
            "El tiempo se acabÃ³ antes de que se completaran todos los pedidos. Â¡No te desanimes! Observa con calma lo que pide cada pedido y utiliza el almanaque si necesitas ayuda. La prÃ³xima vez lo harÃ¡s mejor.",
            "Esta vez no ha habido tiempo suficiente, pero tu esfuerzo ya ha marcado la diferencia. Sigue practicando para montar las cestas mÃ¡s rÃ¡pido y con mayor precisiÃ³n. Â¡La prÃ¡ctica leva al equilibrio!."
        ],
        other: [
            "El tiempo pasa, pero aÃºn da tiempo a preparar mÃ¡s cestas. Sigue atento a los pedidos.",
            "Si tienes dudas, abre el almanaque y recuerda los grupos de alimentos. Siempre estÃ¡ disponible",
            "Cada cesta correcta ayuda a mantener la salud de la tripulaciÃ³n de la EstaciÃ³n de NutriciÃ³n. Â¡Sigue asÃ­!.",
            "Preparar pedidos saludables es un excelente entrenamiento para el dÃ­a a dÃ­a. Lo estÃ¡s haciendo muy bien.",
            "Arrastra los alimentos de la cinta transportadora a las cestas para preparar el pedido.",
            "Mueve los alimentos y forma cestas equilibradas.",
            "Cuando termines, selecciona el botÃ³n de verificaciÃ³n para revisar el pedido.",
            "Si te equivocas, selecciona el artÃ­culo incorrecto para eliminarlo e intÃ©ntalo de nuevo.",
            "Â¡El tiempo se acaba! Sea rÃ¡pido y complete el mayor nÃºmero de cestas posible."
        ]
    }
};

// --- NOVO: FUNÃ‡Ã•ES DE TRADUÃ‡ÃƒO ---
/**
 * Pega o idioma salvo no localStorage pelo menu.
 * O menu salva em 'safequest-settings' como um JSON.
 */
function getLanguage() {
    try {
        const settingsString = localStorage.getItem('safequest-settings');
        if (settingsString) {
            const settings = JSON.parse(settingsString);
            // Verifica se a lÃ­ngua salva (ex: 'en') existe no nosso dicionÃ¡rio
            if (gameTranslations[settings.language]) {
                return settings.language;
            }
        }
    } catch (e) {
        console.error("Erro ao carregar configuraÃ§Ãµes de idioma:", e);
    }
    // Retorna 'pt' como padrÃ£o se nada for encontrado
    return 'pt';
}

/**
 * Aplica as traduÃ§Ãµes aos elementos estÃ¡ticos da pÃ¡gina.
 */
function translatePage(lang) {
    const translations = gameTranslations[lang];
    if (!translations) {
        console.warn(`TraduÃ§Ã£o para '${lang}' nÃ£o encontrada.`);
        return;
    }

    // Traduz todos os elementos com 'data-key'
    document.querySelectorAll('[data-key]').forEach(element => {
        const key = element.dataset.key;
        if (translations[key]) {
            element.textContent = translations[key];
        }
    });

    // Traduz o <title> da pÃ¡gina
    const titleElement = document.querySelector('title[data-key="fase1_titulo"]');
    if (titleElement && translations.fase1_titulo) {
        document.title = translations.fase1_titulo;
    }

    // Traduz atributos 'title' (usando 'data-title-key')
    document.querySelectorAll('[data-title-key]').forEach(element => {
        const key = element.dataset.titleKey;
        if (translations[key]) {
            element.setAttribute('title', translations[key]);
        }
    });

    // Casos especiais (elementos com spans dentro)
    const scoreText = document.querySelector('[data-key="header_pedidos"]');
    if (scoreText) scoreText.textContent = translations.header_pedidos;

    const stageText = document.querySelector('[data-key="header_etapa"]');
    if (stageText) stageText.textContent = translations.header_etapa;

    const endScore1 = document.querySelector('[data-key="end_score_texto_1"]');
    if (endScore1) endScore1.textContent = translations.end_score_texto_1;
    
    const endScore2 = document.querySelector('[data-key="end_score_texto_2"]');
    if (endScore2) endScore2.textContent = translations.end_score_texto_2;
>>>>>>> 1e29ed259d7cfc1a081e9058b6deb5b2e2b2d9e8
}

// --- FIM DAS FUNÃ‡Ã•ES DE TRADUÃ‡ÃƒO ---


window.onload = () => {

<<<<<<< HEAD
Â  Â  // --- NOVO: CARREGA IDIOMA E MODO DE COR ---
Â  Â  const settings = getSettings(); // 1. Usamos a nova funÃ§Ã£o
Â  Â  const currentLang = settings.language;
Â  Â  const currentColorMode = settings.colorMode; // 2. Pegamos o modo de cor
Â  Â  
Â  Â  const translations = gameTranslations[currentLang];
Â  Â  translatePage(currentLang);
Â  Â  // --- FIM DA APLICAÃ‡ÃƒO DE IDIOMA ---


    // --- NOVO: Define o sufixo do nome do arquivo ---
    // (Com base nos seus arquivos e botÃµes do menu)
    let assetSuffix;
    if (currentColorMode === 'high-contrast') {
        // Seu botÃ£o "Alto Contraste" vai usar os arquivos "-tea.png"
        // (Assumindo que '-tea' Ã© o seu modo de alto contraste)
        assetSuffix = '-tea'; 
    } else if (currentColorMode === 'colorblind-safe') {
        // Seu botÃ£o "Daltonismo" vai usar os arquivos "-daltonismo.png"
        assetSuffix = '-daltonismo';
    } else {
        // 'default' (PadrÃ£o)
        assetSuffix = '-padrao';
    }
    // --- FIM DA LÃ“GICA DO SUFIXO ---


Â  Â  // --- BLOQUEIO DE ZOOM ---
Â  Â  window.addEventListener('wheel', function(event) {
Â  Â  Â  Â  if (event.ctrlKey || event.metaKey) {
Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  }
Â  Â  }, { passive: false });

Â  Â  // --- SELEÃ‡ÃƒO DOS ELEMENTOS DA UI ---
Â  Â  const gameContainer = document.getElementById('game-container');
Â  Â  const startScreen = document.getElementById('start-screen');
Â  Â  const stageTransitionScreen = document.getElementById('stage-transition-screen');
Â  Â  const endScreen = document.getElementById('end-screen');
Â  Â  const startButton = document.getElementById('start-button');
Â  Â  const nextStageButton = document.getElementById('next-stage-button');
Â  Â  const restartButton = document.getElementById('restart-button');
    const backToMenuButton = document.getElementById('back-to-menu-button'); // <-- NOVO
Â  Â  const scoreEl = document.getElementById('score');
Â  Â  const stageDisplayEl = document.getElementById('stage-display');
Â  Â  const timerEl = document.getElementById('timer');
Â  Â  const esteiraContainer = document.getElementById('esteira-container'); // ReferÃªncia ao contÃªiner da esteira
Â  Â  const orderSlots = document.querySelectorAll('.ticket-item');
Â  Â  const plateSlots = document.querySelectorAll('#cestas-container .cesta');
Â  Â  const verifyButton = document.getElementById('verify-button');
Â  Â  const macawMessage = document.getElementById('macaw-message');
Â  Â  const macawText = document.getElementById('macaw-text');
Â  Â  const gameHeader = document.querySelector('header');
Â  Â  const gameMain = document.querySelector('main');
Â  Â  const macawSprite = document.getElementById('macaw-sprite');
Â  Â  const endMacawSprite = document.getElementById('end-macaw-sprite');
Â  Â  const stageMacawSprite = document.getElementById('stage-macaw-sprite');
Â  Â  const bookButton = document.getElementById('book-button');
Â  Â  const bookModal = document.getElementById('book-modal');
Â  Â  const bookModalClose = document.getElementById('book-modal-close');
Â  Â  const bookPagesContainer = document.getElementById('book-pages-container');
Â  Â  const pageSections = document.querySelectorAll('.page .section');
Â  Â  const prevPageBtn = document.getElementById('prev-page-btn');
Â  Â  const nextPageBtn = document.getElementById('next-page-btn');
Â  Â  const pageIndicator = document.getElementById('page-indicator');
Â  Â  const foodDetailModal = document.getElementById('food-detail-modal');
Â  Â  const foodDetailClose = document.getElementById('food-detail-close');
Â  Â  const foodDetailName = document.getElementById('food-detail-name');
Â  Â  const foodDetailImg = document.getElementById('food-detail-img');
Â  Â  const foodDetailDesc = document.getElementById('food-detail-desc');
Â  Â  const foodDetailFunFact = document.getElementById('food-detail-funfact');
Â  Â  const foodDetailNutri = document.getElementById('food-detail-nutri');

    // --- MUDANÃ‡A: Sprites da Arara usam o sufixo ---
Â  Â  const MACAW_SPRITES = {
Â  Â  Â  Â  falando: `assets/arara-falando${assetSuffix}.png`,
Â  Â  Â  Â  feliz: `assets/arara-feliz${assetSuffix}.png`,
Â  Â  Â  Â  triste: `assets/arara-triste${assetSuffix}.png`,
Â  Â  Â  Â  curiosa: `assets/arara-curiosa${assetSuffix}.png`
Â  Â  };
Â  Â Â 
Â  Â  // --- DiÃ¡logos dinÃ¢micos (usam 'translations' que Ã© carregado acima) ---
Â  Â  const introDialogues = [
Â  Â  Â  Â  { title: translations.tutorial_title, text: translations.tutorial },
Â  Â  Â  Â  { title: translations.stage1_title, text: translations.stage1 }
Â  Â  ];

Â  Â  const getRandomDialogue = (type) => {
Â  Â  Â  Â  const options = translations[type]; 
Â  Â  Â  Â  if (!options) return "DiÃ¡logo nÃ£o encontrado.";
Â  Â  Â  Â  return options[Math.floor(Math.random() * options.length)];
Â  Â  };

Â  Â  const INITIAL_TIME = 90;
Â  Â  const TIME_BONUS = 10;
Â  Â  const FOOD_SPAWN_INTERVAL = 2000;
Â  Â  const FOOD_SPEED = 120; // Pixels por segundo (ajustado na funÃ§Ã£o moveFood)

Â  Â  // --- LÃ“GICA DO CAMINHO DA ESTEIRA ---
Â  Â  const PATH_STATE = {
Â  Â  Â  Â  MOVE_DOWN: 1,
Â  Â  Â  Â  MOVE_RIGHT: 2,
Â  Â  Â  Â  MOVE_UP: 3,
Â  Â  Â  Â  MOVE_LEFT: 4,
Â  Â  Â  Â  MOVE_UP_EXIT: 5
Â  Â  };
Â  Â  const PATH_PERCENTAGES = {
Â  Â  Â  Â  SPAWN_X: 6,
Â  Â  Â  Â  SPAWN_Y: 19,
Â  Â  Â  Â  EXIT_X: 3,
Â  Â  Â  Â  EXIT_Y: 20,
Â  Â  Â  Â  TURN_1_Y: 63,
Â  Â  Â  Â  TURN_2_X: 92,
Â  Â  Â  Â  TURN_3_Y: 50,
Â  Â  Â  Â  TURN_4_X: 18
Â  Â  };
Â  Â  // --- FIM DA LÃ“GICA DO CAMINHO ---


    // --- MUDANÃ‡A PRINCIPAL: Objeto de alimentos multi-idioma usa o sufixo ---
Â  Â  const ALL_FOODS_DATA = {
Â  Â  Â  Â  // --- PORTUGUÃŠS ---
Â  Â  Â  Â  'pt': {
Â  Â  Â  Â  Â  Â  carboidrato: [
                { name: 'Arroz', img: `assets/arroz${assetSuffix}.png`, description: 'O arroz integral Ã© um grÃ£o que mantÃ©m a casca e o farelo. Ele fornece energia, ajuda na digestÃ£o por ter mais fibras.', funFact: 'Quando o arroz estÃ¡ cozinhando ele faz um barulhinho (como estalinhos), como se estivesse avisando que jÃ¡ estÃ¡ quase pronto.', nutritionalInfo: 'O arroz integral Ã© uma boa fonte de fibra, contÃ©m vitaminas do complexo B e minerais como magnÃ©sio, fÃ³sforo e ferro. A fibra contribui para a saciedade, as vitaminas e os minerais sÃ£o essenciais para diversas funÃ§Ãµes do corpo.' },
                { name: 'MacarrÃ£o', img: `assets/macarrao${assetSuffix}.png`, description: 'O macarrÃ£o integral fornece vitaminas, minerais e fibras para o nosso corpo, ajudando na digestÃ£o, controlando os nÃ­veis de aÃ§Ãºcar no sangue e fornecendo energia.', funFact: 'Alguns arqueÃ³logos encontraram vestÃ­gios de macarrÃ£o com quase 4 mil anos de idade, na China.', nutritionalInfo: 'O macarrÃ£o integral Ã© uma fonte rica de fibras, vitaminas e minerais, cada 100g de macarrÃ£o integral possui 124 calorias, auxilia na saciedade e no funcionamento do intestino.' },
                { name: 'Banana', img: `assets/banana${assetSuffix}.png`, description: 'A banana contribui para a saÃºde do coraÃ§Ã£o, melhora o funcionamento intestinal, aumenta a energia, fortifica os mÃºsculos e auxilia no humor.', funFact: 'As bananeiras nÃ£o sÃ£o Ã¡rvores, â€œsÃ£o ervas gigantesâ€, onde podem crescer mais de 7 metros de altura.', nutritionalInfo: 'A banana Ã© uma fonte de minerais como potÃ¡ssio e magnÃ©sio, vitamina B6 e C, e hidratos de carbono. Possui 26g de carboidrato, 98 calorias, 2g de fibras e 1,3g de proteÃ­nas.' },
            ],
Â  Â  Â  Â  Â  Â  proteina: [
                { name: 'Carne', img: `assets/carne${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Frango', img: `assets/frango${assetSuffix}.png`, description: 'O frango ajuda a construir mÃºsculos e dÃ¡ energia para o corpo.', funFact: 'Os atletas gostam de incluir bastante frango em seus pratos, pois ele ajuda a construir mÃºsculos e a dar bastante energia, principalmente o frango grelhado e cozido.', nutritionalInfo: 'O frango geralmente Ã© uma fonte rica em proteÃ­nas de alta qualidade e pobre em gorduras, com vitaminas do complexo B e minerais como selÃªnio e fÃ³sforo, sem hidratos de carbono e fibras.' },
                { name: 'Ovo', img: `assets/ovo${assetSuffix}.png`, description: 'O ovo da galinha ajuda o corpo a crescer e se manter saudÃ¡vel, alÃ©m disso, contÃ©m vitaminas e minerais importantes para os ossos, mÃºsculos e cÃ©rebro.', funFact: 'Se vocÃª girar um ovo cru e outro cozido, o cozido gira de forma firme, mas o cru balanÃ§a e tropeÃ§a por dentro.', nutritionalInfo: 'O ovo Ã© uma fonte de nutrientes completo, com baixo custo e versatilidade culinÃ¡ria, Ã© importante consumi-lo com cuidado para evitar contaminaÃ§Ã£o. Ele possui vitaminas A, D, E, B2, B12, folato e minerais essenciais como fÃ³sforo, ferro e selÃªnio.' },
                { name: 'SalmÃ£o', img: `assets/salmao${assetSuffix}.png`, description: 'O salmÃ£o grelhado ajuda na saÃºde dos ossos e no bem-estar mental por conta das vitaminas e minerais, no crescimento muscular devido as proteÃ­nas presentes.', funFact: 'A cor laranja do salmÃ£o nÃ£o Ã© natural, Ã© apenas um resultado da alimentaÃ§Ã£o do peixe ao comer algas e crustÃ¡ceos.', nutritionalInfo: 'O salmÃ£o grelhado sem sal ou Ã³leo, pode conter 243 calorias e 26g de proteÃ­nas Ã© uma fonte rica em vitaminas como a D e B12, e do mineral selÃªnio.' },
                { name: 'Peixe', img: `assets/peixe${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' }
            ],
Â  Â  Â  Â  Â  Â  vitamina: [
                { name: 'Cenoura', img: `assets/cenoura${assetSuffix}.png`, description: 'A cenoura ajuda a manter a visÃ£o saudÃ¡vel, ajudam o intestino a funcionar bem e dÃ¡ energia para o corpo.', funFact: 'Se vocÃª colocar cenouras cortadas em uma Ã¡gua com gÃ¡s, elas vÃ£o subir e descer como se estivessem fazendo uma coreografia.', nutritionalInfo: 'A cenoura Ã© um vegetal rico em vitamina A, que contribui para a saÃºde da visÃ£o e tem aÃ§Ã£o intoxicante. Ela contÃ©m vitaminas e minerais como potÃ¡ssio, e as fibras ajudam no funcionamento do intestino.' },
                { name: 'FeijÃ£o', img: `assets/feijao${assetSuffix}.png`, description: 'O feijÃ£o Ã© uma leguminosa rica em proteÃ­na e fibra, que ajuda a manter os mÃºsculos fortes e o intestino funcionando bem.', funFact: 'A planta mais alta do feijÃ£o alcanÃ§ou mais de 14 metros de altura, o que Ã© mais de trÃªs girafas empilhadas.', nutritionalInfo: 'O feijÃ£o Ã© um alimento rico em nutrientes, fornecendo proteÃ­nas vegetais, carboidratos completos, fibras e vitaminas de complexo B e minerais como ferro, fÃ³sforo e potÃ¡ssio. A forma de preparo do feijÃ£o influencia o valor nutricional exato.' },
                { name: 'Tomate', img: `assets/tomate${assetSuffix}.png`, description: 'O tomate auxilia na saÃºde do coraÃ§Ã£o e intestinal, fortalecendo os ossos, protegendo a pele e sendo aliado a imunidade.', funFact: 'A palavra tomate vem de "tomati", que significa "coisa roliÃ§a com umbigo", nome dado pelos astecas.', nutritionalInfo: 'O tomate Ã© rico em Ã¡gua, fibras, vitamina C e A e minerais como o potÃ¡ssio, magnÃ©sio, ferro e fÃ³sforo. Um tomate de 100g possui entre 18-23 calorias e aproximadamente 93-95% de Ã¡gua.' },
                { name: 'Abacaxi', img: `assets/abacaxi${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'BrÃ³colis', img: `assets/brocolis${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Couve', img: `assets/couve${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Laranja', img: `assets/laranja${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'MaÃ§Ã£', img: `assets/maca${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Pimenta', img: `assets/pimenta${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Repolho', img: `assets/repolho${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' }
            ],
Â  Â  Â  Â  Â  Â  pegadinha: [
                { name: 'Presunto', img: `assets/presunto${assetSuffix}.png`, description: 'O peito de peru processado tem proteÃ­nas, mas possui muito sal e conservantes, que podem fazer mal se comer em excesso.', funFact: 'No passado, os fabricantes queriam uma carne fatiada rÃ¡pida e prÃ¡tica, que parecesse mais "gorda e suculenta", ou seja, o peito de peru processado Ã© um tipo de truque mÃ¡gico.', nutritionalInfo: 'O peito de peru processado Ã© rico em proteÃ­nas e tem baixa quantidade de gordura, mas Ã© alto em sÃ³dio e contÃ©m aditivos conservantes, estabilizantes e amido. O valor nutritivo depende da marca.' },
                { name: 'Suco de Caixinha', img: `assets/suco-de-caixinha${assetSuffix}.png`, description: 'O suco de caixinha dÃ¡ energia rÃ¡pida, mas tem muito aÃ§Ãºcar e nem sempre muita fruta, ou seja, pode fazer mal aos dentes e ao corpo.', funFact: 'Apesar de parecer "sÃ³" fruta, a maioria dos sucos de caixinha contÃ©m Ã¡gua e aÃ§Ãºcar adicionados, entÃ£o nem sempre Ã© 100% fruta.', nutritionalInfo: 'Os sucos de caixinha variam nutricionalmente, mas sÃ£o ricos em calorias e aÃ§Ãºcares, com poucas fibras, podem conter aditivos como conservantes e aromatizantes. Sucos 100% integrais sem aÃ§Ãºcar Ã© a melhor opÃ§Ã£o.' },
                { name: 'Iogurte', img: `assets/yogurt${assetSuffix}.png`, description: 'O iogurte com sabor ajuda os ossos e mÃºsculos, mas contÃ©m bastante aÃ§Ãºcar, podendo prejudicar os dentes e aumentar os riscos de doenÃ§as.', funFact: 'Muitos dos corantes vermelhos usados em produtos como iogurte de morango podem ser feitos a partir de um inseto chamado cochonilha.', nutritionalInfo: 'Variam bastante dependendo da marca e do tipo, mas contÃ©m calorias, proteÃ­nas, gorduras, aÃ§Ãºcares e cÃ¡lcio.' },
                { name: 'Cupcake', img: `assets/cupcake${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Pizza', img: `assets/pizza${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Hamburguer', img: `assets/hamburguer${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Coca-Cola', img: `assets/cocacola${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Bolo', img: `assets/bolo${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' }
            ]
Â  Â  Â  Â  },
Â  Â  Â  Â  // --- ENGLISH (TraduÃ§Ã£o) ---
Â  Â  Â  Â  'en': {
Â  Â  Â  Â  Â  Â  carboidrato: [
                { name: 'Rice', img: `assets/arroz${assetSuffix}.png`, description: 'Brown rice is a grain that retains its husk and bran. It provides energy and aids digestion due to having more fiber.', funFact: 'When rice is cooking, it makes a little crackling noise, as if it\'s letting you know it\'s almost ready.', nutritionalInfo: 'Brown rice is a good source of fiber, contains B-complex vitamins, and minerals like magnesium, phosphorus, and iron. The fiber contributes to satiety, and the vitamins and minerals are essential for various body functions.' },
                { name: 'Pasta', img: `assets/macarrao${assetSuffix}.png`, description: 'Whole wheat pasta provides vitamins, minerals, and fiber for our body, helping with digestion, controlling blood sugar levels, and providing energy.', funFact: 'Some archaeologists found traces of pasta nearly 4,000 years old in China.', nutritionalInfo: 'Whole wheat pasta is a rich source of fiber, vitamins, and minerals. Every 100g of whole wheat pasta has 124 calories, aids in satiety, and helps intestinal function.' },
                { name: 'Banana', img: `assets/banana${assetSuffix}.png`, description: 'Bananas contribute to heart health, improve intestinal function, increase energy, strengthen muscles, and help with mood.', funFact: 'Banana plants are not trees, they are "giant herbs," which can grow over 7 meters tall.', nutritionalInfo: 'The banana is a source of minerals like potassium and magnesium, vitamins B6 and C, and carbohydrates. It has 26g of carbohydrates, 98 calories, 2g of fiber, and 1.3g of protein.' },
            ],
Â  Â  Â  Â  Â  Â  proteina: [
                { name: 'Meat', img: `assets/carne${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Chicken', img: `assets/frango${assetSuffix}.png`, description: 'Chicken helps build muscles and gives the body energy.', funFact: 'Athletes like to include a lot of chicken in their meals because it helps build muscle and provides plenty of energy, especially grilled and cooked chicken.', nutritionalInfo: 'Chicken is generally a source rich in high-quality proteins and low in fat, with B-complex vitamins and minerals like selenium and phosphorus, without carbohydrates and fiber.' },
                { name: 'Egg', img: `assets/ovo${assetSuffix}.png`, description: 'The chicken egg helps the body grow and stay healthy, and it also contains important vitamins and minerals for bones, muscles, and the brain.', funFact: 'If you spin a raw egg and a cooked egg, the cooked one spins steadily, but the raw one wobbles and stumbles inside.', nutritionalInfo: 'The egg is a complete nutrient source, with low cost and culinary versatility. It is important to consume it carefully to avoid contamination. It has vitamins A, D, E, B2, B12, folate, and essential minerals like phosphorus, iron, and selenium.' },
                { name: 'Salmon', img: `assets/salmao${assetSuffix}.png`, description: 'Grilled salmon supports bone health and mental well-being due to its vitamins and minerals, and muscle growth due to its proteins.', funFact: 'The orange color of salmon is not natural; it is just a result of the fish\'s diet of eating algae and crustaceans.', nutritionalInfo: 'Grilled salmon without salt or oil can contain 243 calories and 26g of protein. It is a rich source of vitamins like D and B12, and the mineral selenium.' },
                { name: 'Fish', img: `assets/peixe${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' }
            ],
Â  Â  Â  Â  Â  Â  vitamina: [
                { name: 'Carrot', img: `assets/cenoura${assetSuffix}.png`, description: 'Carrots help maintain healthy vision, help the intestines work well, and give the body energy.', funFact: 'If you put cut carrots in sparkling water, they will rise and fall as if they are doing a choreography.', nutritionalInfo: 'The carrot is a vegetable rich in vitamin A, which contributes to vision health and has a detoxifying action. It contains vitamins and minerals like potassium, and the fibers help with intestinal function.' },
                { name: 'Beans', img: `assets/feijao${assetSuffix}.png`, description: 'Beans are a legume rich in protein and fiber, which helps keep muscles strong and the intestines working well.', funFact: 'The tallest bean plant reached over 14 meters in height, which is more than three giraffes stacked on top of each other.', nutritionalInfo: 'Beans are a nutrient-rich food, providing plant-based proteins, complex carbohydrates, fiber, and B-complex vitamins, as well as minerals like iron, phosphorus, and potassium. The preparation method influences the exact nutritional value.' },
                { name: 'Tomato', img: `assets/tomate${assetSuffix}.png`, description: 'Tomatoes support heart and intestinal health, strengthening bones, protecting the skin, and boosting immunity.', funFact: 'The word tomato comes from "tomati," which means "plump thing with a navel," a name given by the Aztecs.', nutritionalInfo: 'The tomato is rich in water, fiber, vitamins C and A, and minerals like potassium, magnesium, iron, and phosphorus. A 100g tomato has between 18-23 calories and is approximately 93-95% water.' },
                { name: 'Pineapple', img: `assets/abacaxi${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Broccoli', img: `assets/brocolis${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Kale', img: `assets/couve${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Orange', img: `assets/laranja${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Apple', img: `assets/maca${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Pepper', img: `assets/pimenta${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Cabbage', img: `assets/repolho${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' }
            ],
Â  Â  Â  Â  Â  Â  pegadinha: [
                { name: 'Ham', img: `assets/presunto${assetSuffix}.png`, description: 'Processed turkey breast has protein, but it has a lot of salt and preservatives, which can be harmful if eaten in excess.', funFact: 'In the past, manufacturers wanted a quick and practical sliced meat that seemed "fatter and juicier," meaning processed turkey breast is a kind of magic trick.', nutritionalInfo: 'Processed turkey breast is rich in protein and low in fat, but high in sodium and contains additives like preservatives, stabilizers, and starch. The nutritional value depends on the brand.' },
                { name: 'Juice Box', img: `assets/suco-de-caixinha${assetSuffix}.png`, description: 'Juice boxes provide quick energy, but they have a lot of sugar and not always a lot of fruit, meaning they can be bad for your teeth and body.', funFact: 'Although it may seem like "just" fruit, most juice boxes contain added water and sugar, so it\'s not always 100% fruit.', nutritionalInfo: 'Juice boxes vary nutritionally, but are high in calories and sugars, with little fiber. They may contain additives like preservatives and flavorings. 100% whole juices without sugar are the best option.' },
                { name: 'Yogurt', img: `assets/yogurt${assetSuffix}.png`, description: 'Flavored yogurt helps bones and muscles, but contains a lot of sugar, which can harm teeth and increase the risk of diseases.', funFact: 'Many of the red dyes used in products like strawberry yogurt can be made from an insect called cochineal.', nutritionalInfo: 'They vary greatly depending on the brand and type, but contain calories, protein, fat, sugar, and calcium.' },
                { name: 'Cupcake', img: `assets/cupcake${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Pizza', img: `assets/pizza${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Hamburger', img: `assets/hamburguer${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Coca-Cola', img: `assets/cocacola${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },
                { name: 'Cake', img: `assets/bolo${assetSuffix}.png`, description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' }
            ]
Â  Â  Â  Â  },
Â  Â  Â  Â  // --- ESPAÃ‘OL (TraduÃ§Ã£o) ---
Â  Â  Â  Â  'es': {
Â  Â  Â  Â  Â  Â  carboidrato: [
                { name: 'Arroz', img: `assets/arroz${assetSuffix}.png`, description: 'El arroz integral es um grÃ£o que conserva su cÃ¡scara y salvado. Proporciona energÃ­a y ayuda en la digestiÃ³n por tener mÃ¡s fibra.', funFact: 'Cuando el arroz se estÃ¡ cocinando, hace un pequeÃ±o ruido de crujido, como si avisara que ya estÃ¡ casi listo.', nutritionalInfo: 'El arroz integral es una buena fuente de fibra, contiene vitaminas del complejo B y minerales como magnesio, fÃ³sforo y hierro. La fibra contribuye a la saciedad, y las vitaminas y minerales son esenciales para diversas funciones del cuerpo.' },
                { name: 'Pasta', img: `assets/macarrao${assetSuffix}.png`, description: 'La pasta integral proporciona vitaminas, minerales y fibra a nuestro cuerpo, ayudando en la digestiÃ³n, controlando los niveles de azÃºcar en sangre y proporcionando energÃ­a.', funFact: 'Algunos arqueÃ³logos encontraron restos de pasta de casi 4.000 aÃ±os de antigÃ¼edad en China.', nutritionalInfo: 'La pasta integral es una fuente rica en fibra, vitaminas y minerales. Cada 100g de pasta integral tiene 124 calorÃ­as, ayuda a la saciedad y al funcionamiento del intestino.' },
                { name: 'Banana', img: `assets/banana${assetSuffix}.png`, description: 'La banana contribuye a la salud del corazÃ³n, mejora el funcionamiento intestinal, aumenta la energÃ­a, fortalece los mÃºsculos y ayuda con el estado de Ã¡nimo.', funFact: 'Las plantas de banana no son Ã¡rboles, son "hierbas gigantes", que pueden crecer mÃ¡s de 7 metros de altura.', nutritionalInfo: 'La banana es una fuente de minerales como potasio y magnesio, vitaminas B6 y C, e hidratos de carbono. Posee 26g de carbohidratos, 98 calorÃ­as, 2g de fibra y 1.3g de proteÃ­na.' },
            ],
Â  Â  Â  Â  Â  Â  proteina: [
                { name: 'Carne', img: `assets/carne${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },
                { name: 'Pollo', img: `assets/frango${assetSuffix}.png`, description: 'El pollo ayuda a construir mÃºsculos y da energÃ­a al cuerpo.', funFact: 'A los atletas les gusta incluir mucho pollo en sus platos, ya que ayuda a construir mÃºsculo y a dar mucha energÃ­a, especialmente el pollo a la parrilla y cocido.', nutritionalInfo: 'El pollo generalmente es una fuente rica en proteÃ­nas de alta calidad y baja en grasas, con vitaminas del complejo B y minerales como selenio y fÃ³sforo, sin carbohidratos ni fibra.' },
                { name: 'Huevo', img: `assets/ovo${assetSuffix}.png`, description: 'El huevo de gallina ayuda al cuerpo a crecer y mantenerse saludable, ademÃ¡s, contiene vitaminas y minerales importantes para los huesos, mÃºsculos y cerebro.', funFact: 'Si giras un huevo crudo y uno cocido, el cocido gira firmemente, pero el crudo se tambalea y tropieza por dentro.', nutritionalInfo: 'El huevo es una fuente completa de nutrientes, de bajo costo y versatilidad culinaria. Es importante consumirlo con cuidado para evitar la contaminaciÃ³n. Posee vitaminas A, D, E, B2, B12, folato y minerales esenciales como fÃ³sforo, hierro y selenio.' },
                { name: 'SalmÃ³n', img: `assets/salmao${assetSuffix}.png`, description: 'El salmÃ³n a la parrilla ayuda a la salud Ã³sea y al bienestar mental gracias a sus vitaminas y minerales, y al crecimiento muscular debido a las proteÃ­nas presentes.', funFact: 'El color naranja del salmÃ³n no es natural; es solo el resultado de la alimentaciÃ³n del pez al comer algas y crustÃ¡ceos.', nutritionalInfo: 'El salmÃ³n a la parrilla sin sal ni aceite puede contener 243 calorÃ­as y 26g de proteÃ­na. Es una fuente rica en vitaminas como la D y B12, y el mineral selenio.' },
                { name: 'Pescado', img: `assets/peixe${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' }
            ],
Â  Â  Â  Â  Â  Â  vitamina: [
                { name: 'Zanahoria', img: `assets/cenoura${assetSuffix}.png`, description: 'La zanahoria ayuda a mantener una visiÃ³n saludable, ayuda a que los intestinos funcionen bien y da energÃ­a al cuerpo.', funFact: 'Si pones zanahorias cortadas en agua con gas, subirÃ¡n y bajarÃ¡n como si estuvieran haciendo una coreografÃ­a.', nutritionalInfo: 'La zanahoria es un vegetal rico en vitamina A, que contribui para a saÃºde da visÃ£o e tem aÃ§Ã£o desintoxicante. Contiene vitaminas y minerales como el potasio, y las fibras ayudan al funcionamiento del intestino.' },
                { name: 'Frijoles', img: `assets/feijao${assetSuffix}.png`, description: 'Los frijoles son una legumbre rica en proteÃ­na y fibra, que ayuda a mantener los mÃºsculos fuertes y el intestino funcionando bien.', funFact: 'La planta de frijol mÃ¡s alta alcanzÃ³ mÃ¡s de 14 metros de altura, lo que es mÃ¡s que tres jirafas apiladas.', nutritionalInfo: 'Los frijoles son un alimento rico en nutrientes, que proporciona proteÃ­nas vegetales, carbohidratos complejos, fibra y vitaminas del complejo B, y minerales como hierro, fÃ³sforo y potasio. La forma de preparar los frijoles influye en el valor nutricional exacto.' },
                { name: 'Tomate', img: `assets/tomate${assetSuffix}.png`, description: 'El tomate ayuda a la salud del corazÃ³n e intestinal, fortaleciendo los huesos, protegiendo la piel y siendo un aliado de la inmunidad.', funFact: 'La palabra tomate proviene de "tomati", que significa "cosa redonda con ombligo", nombre dado por los aztecas.', nutritionalInfo: 'El tomate es rico en agua, fibra, vitaminas C y A, y minerales como potasio, magnesio, hierro y fÃ³sforo. Un tomate de 100g tiene entre 18-23 calorÃ­as y aproximadamente 93-95% de agua.' },
                { name: 'PiÃ±a', img: `assets/abacaxi${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'BrÃ³coli', img: `assets/brocolis${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Col Rizada', img: `assets/couve${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Naranja', img: `assets/laranja${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Manzana', img: `assets/maca${assetSuffix}.png`, description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },
                { name: 'Pimiento', img: `assets/pimenta${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Repollo', img: `assets/repolho${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' }
            ],
Â  Â  Â  Â  Â  Â  pegadinha: [
                { name: 'JamÃ³n', img: `assets/presunto${assetSuffix}.png`, description: 'La pechuga de pavo procesada tiene proteÃ­nas, pero tiene mucha sal y conservantes, que pueden ser perjudiciales si se comen en exceso.', funFact: 'En el pasado, los fabricantes querÃ­an una carne en lonchas rÃ¡pida y prÃ¡ctica, que pareciera mÃ¡s "grasa y jugosa", es decir, la pechuga de pavo procesada es una especie de truco de magia.', nutritionalInfo: 'La pechuga de pavo procesada es rica en proteÃ­nas y baja en grasas, pero alta en sodio y contiene aditivos como conservantes, estabilizadores y almidÃ³n. El valor nutricional depende de la marca.' },
                { name: 'Jugo en Caja', img: `assets/suco-de-caixinha${assetSuffix}.png`, description: 'El jugo en caja da energÃ­a rÃ¡pida, pero tiene mucho azÃºcar y no siempre mucha fruta, es decir, puede ser malo para los dientes y el cuerpo.', funFact: 'Aunque parezca "solo" fruta, la mayorÃ­a de los jugos en caja contienen agua y azÃºcar aÃ±adidos, por lo que no siempre es 100% fruta.', nutritionalInfo: 'Los jugos en caja varÃ­an nutricionalmente, pero son altos en calorÃ­as y azÃºcares, con poca fibra. Pueden contener aditivos como conservantes y saborizantes. Los jugos 100% integrales sin azÃºcar son la mejor opciÃ³n.' },
                { name: 'Yogur', img: `assets/yogurt${assetSuffix}.png`, description: 'El yogur de sabores ayuda a los huesos y mÃºsculos, pero contiene bastante azÃºcar, lo que puede daÃ±ar los dientes y aumentar el riesgo de enfermedades.', funFact: 'Muchos de los colorantes rojos usados en productos como el yogur de fresa pueden estar hechos de un insecto llamado cochinilla.', nutritionalInfo: 'VarÃ­an mucho segÃºn la marca y el tipo, pero contienen calorÃ­as, proteÃ­nas, grasas, azÃºcares y calcio.' },
                { name: 'Cupcake', img: `assets/cupcake${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Pizza', img: `assets/pizza${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Hamburguesa', img: `assets/hamburguer${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Coca-Cola', img: `assets/cocacola${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' },
                { name: 'Pastel', img: `assets/bolo${assetSuffix}.png`, description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponÃ­vel.' }
            ]
Â  Â  Â  Â  }
Â  Â  };


Â  Â  // --- MUDANÃ‡A PRINCIPAL: Seleciona o objeto de alimentos com base no idioma carregado ---
Â  Â  // O resto do script usarÃ¡ esta variÃ¡vel 'FOODS'
Â  Â  const FOODS = ALL_FOODS_DATA[currentLang] || ALL_FOODS_DATA['pt'];
Â  Â  // --- FIM DA MUDANÃ‡A ---


Â  Â  // --- NOVO: Nomes dos grupos de alimentos traduzidos ---
Â  Â  const FOOD_GROUP_NAMES = {Â 
Â  Â  Â  Â  carboidrato: translations.almanaque_titulo_carb,Â 
Â  Â  Â  Â  proteina: translations.almanaque_titulo_prot,Â 
Â  Â  Â  Â  vitamina: translations.almanaque_titulo_vit,Â 
Â  Â  Â  Â  pegadinha: translations.almanaque_titulo_pega
Â  Â  };
Â  Â Â 
Â  Â  // --- NOVO: TÃ­tulos das etapas traduzidos ---
Â  Â  const STAGES = [
Â  Â  Â  Â  { stage: 1, goal: 3, orderSize: 3, foodTypes: ['carboidrato'], possibleOrderTypes: ['carboidrato'], title: translations.stage1_title },
Â  Â  Â  Â  { stage: 2, goal: 5, orderSize: 3, foodTypes: ['carboidrato', 'proteina'], possibleOrderTypes: ['carboidrato', 'proteina'], title: translations.stage2_title },
Â  Â  Â  Â  { stage: 3, goal: 7, orderSize: 3, foodTypes: ['carboidrato', 'proteina', 'vitamina'], possibleOrderTypes: ['carboidrato', 'proteina', 'vitamina'], title: translations.stage3_title },
Â  Â  Â  Â  { stage: 4, goal: 10, orderSize: 3, foodTypes: ['carboidrato', 'proteina', 'vitamina', 'pegadinha'], possibleOrderTypes: ['carboidrato', 'proteina', 'vitamina'], title: translations.stage4_title }
Â  Â  ];

Â  Â  let timer, score, currentStageIndex, stageOrders, timerInterval, foodSpawnInterval, gameLoopInterval, macawTimeout, otherDialogueTimeout;
Â  Â  let isPaused = false;
Â  Â  let currentOrder = [];
Â  Â  let plateContents = [null, null, null];
Â  Â  let sounds = {};
Â  Â  let audioInitialized = false;
Â  Â  let lastUsedFoods = [];
Â  Â  let isShowingIntro = false;
Â  Â  let introStep = 0;

Â  Â  let allBookFoods = [];
Â  Â  let pages = [];
Â  Â  let currentPage = 1;
Â  Â  const ITEMS_PER_SECTION = 3;
Â  Â  const SECTIONS_PER_PAGE = 6;
Â  Â  const ITEMS_PER_PAGE = ITEMS_PER_SECTION * SECTIONS_PER_PAGE;

Â  Â  let pausedBeforeModal = false;
Â  Â  let modalPauseCount = 0;

Â  Â  // --- NOVO: VariÃ¡veis para Drag & Drop por Toque ---
Â  Â  let draggedItem = null;Â  Â  Â  // Armazena o item sendo arrastado pelo toque
Â  Â  let currentDropTarget = null; // Armazena a cesta (slot) que estÃ¡ sob o dedo
Â  Â  let touchOffsetX = 0;Â  Â  Â  Â  // Offset X do toque dentro do item
Â  Â  let touchOffsetY = 0;Â  Â  Â  Â  // Offset Y do toque dentro do item
Â  Â  let esteiraRect = null;Â  Â  Â  // Cache da posiÃ§Ã£o da esteira para performance
Â  Â  // --- FIM: VariÃ¡veis de Toque ---

Â  Â  function pushModalPause() {
Â  Â  Â  Â  if (modalPauseCount === 0) {
Â  Â  Â  Â  Â  Â  pausedBeforeModal = isPaused;
Â  Â  Â  Â  Â  Â  isPaused = true;
Â  Â  Â  Â  }
Â  Â  Â  Â  modalPauseCount++;
Â  Â  }

Â  Â  function popModalPause() {
Â  Â  Â  Â  if (modalPauseCount > 0) modalPauseCount--;
Â  Â  Â  Â  if (modalPauseCount === 0) {
Â  Â  Â  Â  Â  Â  isPaused = pausedBeforeModal;
Â  Â  Â  Â  Â  Â  pausedBeforeModal = false;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  isPaused = true;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- SEÃ‡ÃƒO DE ÃUDIO ---
Â  Â  function initAudio() {
Â  Â  Â  Â  if (audioInitialized) return;
Â  Â  Â  Â  const soundFiles = {
Â  Â  Â  Â  Â  Â  'acerto': 'assets/acerto.mp3',
Â  Â  Â  Â  Â  Â  'alerta-cronometro': 'assets/alerta-do-cronometro.mp3',
Â  Â  Â  Â  Â  Â  'avaliacao-final': 'assets/avaliacao-final.mp3',
Â  Â  Â  Â  Â  Â  'bonus-tempo': 'assets/bonus-de-tempo.mp3',
Â  Â  Â  Â  Â  Â  'clique-ui': 'assets/clique-ui.mp3',
Â  Â  Â  Â  Â  Â  'erro': 'assets/erro.mp3',
Â  Â  Â  Â  Â  Â  'musica-fundo': 'assets/musica-dinamica-fundo.mp3',
Â  Â  Â  Â  Â  Â  'pegar-soltar': 'assets/pegar-soltar-item.mp3'
Â  Â  Â  Â  };
Â  Â  Â  Â  for (const key in soundFiles) {
Â  Â  Â  Â  Â  Â  sounds[key] = new Audio(soundFiles[key]);
Â  Â  Â  Â  }
Â  Â  Â  Â  sounds['musica-fundo'].loop = true;
Â  Â  Â  Â  audioInitialized = true;
Â  Â  }

Â  Â  function playSound(name) {
Â  Â  Â  Â  if (!audioInitialized || !sounds[name]) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- NOVO: Verifica Ã¡udio nas configuraÃ§Ãµes ---
Â  Â  Â  Â  const settingsString = localStorage.getItem('safequest-settings');
Â  Â  Â  Â  let canPlay = true;
Â  Â  Â  Â  if (settingsString) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const settings = JSON.parse(settingsString);
Â  Â  Â  Â  Â  Â  Â  Â  if (name === 'musica-fundo' && !settings.music) canPlay = false;
Â  Â  Â  Â  Â  Â  Â  Â  if (name !== 'musica-fundo' && !settings.sfx) canPlay = false;
Â  Â  Â  Â  Â  Â  } catch (e) { /* ignora erro */ }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!canPlay) return;
Â  Â  Â  Â  // --- FIM DA VERIFICAÃ‡ÃƒO ---

Â  Â  Â  Â  const sound = sounds[name];
Â  Â  Â  Â  if (name !== 'musica-fundo') {
Â  Â  Â  Â  Â  Â  sound.currentTime = 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  sound.play().catch(error => console.error(`Erro ao tocar o som '${name}':`, error));
Â  Â  }

Â  Â  function stopSound(name) {
Â  Â  Â  Â  if (!audioInitialized || !sounds[name]) return;
Â  Â  Â  Â  const sound = sounds[name];
Â  Â  Â  Â  sound.pause();
Â  Â  Â  Â  sound.currentTime = 0;
Â  Â  }

Â  Â  function fadeIn(name, targetVolume = 0.3, duration = 1500) {
Â  Â  Â  Â  if (!audioInitialized || !sounds[name]) return;

Â  Â  Â  Â  // --- NOVO: Verifica Ã¡udio nas configuraÃ§Ãµes ---
Â  Â  Â  Â  const settingsString = localStorage.getItem('safequest-settings');
Â  Â  Â  Â  if (settingsString) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const settings = JSON.parse(settingsString);
Â  Â  Â  Â  Â  Â  Â  Â  if (name === 'musica-fundo' && !settings.music) return; // NÃ£o toca
Â  Â  Â  Â  Â  Â  } catch (e) { /* ignora erro */ }
Â  Â  Â  Â  }
Â  Â  Â  Â  // --- FIM DA VERIFICAÃ‡ÃƒO ---

Â  Â  Â  Â  const sound = sounds[name];
Â  Â  Â  Â  const intervalTime = 50;
Â  Â  Â  Â  const fadeSteps = duration / intervalTime;
Â  Â  Â  Â  const volumeIncrement = targetVolume / fadeSteps;
Â  Â  Â  Â  sound.volume = 0;
Â  Â  Â  Â  sound.play().catch(error => console.error(`Erro ao iniciar o som para fade-in:`, error));
Â  Â  Â  Â  const fadeInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  if (sound.volume < targetVolume) {
Â  Â  Â  Â  Â  Â  Â  Â  sound.volume = Math.min(targetVolume, sound.volume + volumeIncrement);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(fadeInterval);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, intervalTime);
Â  Â  }

Â  Â  function fadeOut(name, duration = 1000) {
Â  Â  Â  Â  if (!audioInitialized || !sounds[name]) return;
Â  Â  Â  Â  const sound = sounds[name];
Â  Â  Â  Â  const intervalTime = 50;
Â  Â  Â  Â  const fadeSteps = duration / intervalTime;
Â  Â  Â  Â  const startVolume = sound.volume;
Â  Â  Â  Â  const volumeDecrement = startVolume / fadeSteps;
Â  Â  Â  Â  const fadeInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  if (sound.volume > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  sound.volume = Math.max(0, sound.volume - volumeDecrement);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(fadeInterval);
Â  Â  Â  Â  Â  Â  Â  Â  sound.pause();
Â  Â  Â  Â  Â  Â  Â  Â  sound.currentTime = 0;
Â  Â  Â  Â  Â  Â  Â  Â  sound.volume = startVolume;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, intervalTime);
Â  Â  }
Â  Â  // --- FIM DA SEÃ‡ÃƒO DE ÃUDIO ---

Â  Â  function init() {
Â  Â  Â  Â  startButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  initAudio();
Â  Â  Â  Â  Â  Â  startIntroduction();
Â  Â  Â  Â  });
Â  Â  Â  Â  restartButton.addEventListener('click', () => {
Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  stopSound('avaliacao-final');
Â  Â  Â  Â  stopSound('alerta-cronometro');
Â  Â  Â  Â  stopSound('musica-fundo');
Â  Â  Â  Â  startGame();
Â  Â  Â  Â  });
        
        // --- CÃ“DIGO QUE FALTA ---
        // Adicione este bloco:
        backToMenuButton.addEventListener('click', () => {
        playSound('clique-ui'); // Opcional: tocar som de clique
        
        // Redireciona o usuÃ¡rio para a pÃ¡gina do menu
        // Altere 'index.html' se o nome do seu menu for outro
        window.location.href = 'menu_index.html'; 
        });

Â  Â  Â  Â  backToMenuButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  window.location.href = "../menu/menu_index.html";
Â  Â  Â  Â  });
Â  Â  Â  Â  nextStageButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  handleNextButtonClick();
Â  Â  Â  Â  });
Â  Â  Â  Â  verifyButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  verifyOrder();
Â  Â  Â  Â  });
Â  Â  Â  Â  plateSlots.forEach(slot => {
Â  Â  Â  Â  Â  Â  slot.addEventListener('dragover', handleDragOver);
Â  Â  Â  Â  Â  Â  slot.addEventListener('dragleave', handleDragLeave);
Â  Â  Â  Â  Â  Â  slot.addEventListener('drop', handleDrop);
Â  Â  Â  Â  Â  Â  slot.addEventListener('click', handlePotClick);
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- NOVO: Listeners de Toque Globais ---
Â  Â  Â  Â  // Adiciona os listeners ao gameContainer para capturar o movimento em qualquer lugar
Â  Â  Â  Â  gameContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
Â  Â  Â  Â  gameContainer.addEventListener('touchend', handleTouchEnd);
Â  Â  Â  Â  gameContainer.addEventListener('touchcancel', handleTouchEnd); // Cancela o toque se algo interromper
Â  Â  Â  Â  // --- FIM: Listeners de Toque ---

Â  Â  Â  Â  const portraitMediaQuery = window.matchMedia("(orientation: portrait)");
Â  Â  Â  Â  function handleOrientationChange(e) {
Â  Â  Â  Â  Â  Â  const orientationWarning = document.getElementById('orientation-warning');
Â  Â  Â  Â  Â  Â  if (e.matches) {
Â  Â  Â  Â  Â  Â  Â  Â  // Se estÃ¡ em modo retrato, pausa o jogo e MOSTRA o aviso
Â  Â  Â  Â  Â  Â  Â  Â  orientationWarning.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  orientationWarning.classList.add('flex');
Â  Â  Â  Â  Â  Â  Â  Â  isPaused = true;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Se estÃ¡ em modo paisagem, ESCONDE o aviso e despausa (se nÃ£o houver outra pausa)
Â  Â  Â  Â  Â  Â  Â  Â  orientationWarning.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  orientationWarning.classList.remove('flex');

Â  Â  Â  Â  Â  Â  Â  Â  const isAnyModalOpen = bookModal.classList.contains('flex') ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stageTransitionScreen.classList.contains('flex') ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  endScreen.classList.contains('flex') ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startScreen.classList.contains('flex');
Â  Â  Â  Â  Â  Â  Â  Â  if (!isShowingIntro && !isAnyModalOpen && modalPauseCount === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isPaused = false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  portraitMediaQuery.addEventListener('change', handleOrientationChange);
Â  Â  Â  Â  handleOrientationChange(portraitMediaQuery); // Checa a orientaÃ§Ã£o inicial
Â  Â  Â  Â  const resizeObserver = new ResizeObserver(handleResize);
Â  Â  Â  Â  resizeObserver.observe(gameContainer);
Â  Â  Â  Â  prepareBookContent();
Â  Â  Â  Â  calculatePages();
Â  Â  Â  Â  bookButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  openBook();
Â  Â  Â  Â  });
Â  Â  Â  Â  bookModalClose.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  closeBook();
Â  Â  Â  Â  });
Â  Â  Â  Â  foodDetailClose.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  closeFoodDetails();
Â  Â  Â  Â  });
Â  Â  Â  Â  prevPageBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  changePage(-1);
Â  Â  Â  Â  });
Â  Â  Â  Â  nextPageBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  changePage(1);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- FUNÃ‡Ã•ES DO LIVRO E MODAIS ---
Â  Â  function prepareBookContent() {
    allBookFoods = [];
    const categoryOrder = ['carboidrato', 'proteina', 'vitamina', 'pegadinha'];
    categoryOrder.forEach(categoryKey => {
Â  Â  Â  Â  // A variÃ¡vel 'FOODS' jÃ¡ estÃ¡ no idioma correto
Â  Â  Â  Â  if (FOODS[categoryKey]) {
Â  Â  Â  Â  Â  Â  FOODS[categoryKey].forEach(food => {
Â  Â  Â  Â  Â  Â  Â  Â  allBookFoods.push({ ...food, category: categoryKey });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
    });
}

Â  Â  function calculatePages() {
Â  Â  Â  Â  pages = [];
Â  Â  Â  Â  for (let i = 0; i < allBookFoods.length; i += ITEMS_PER_PAGE) {
Â  Â  Â  Â  Â  Â  pages.push(allBookFoods.slice(i, i + ITEMS_PER_PAGE));
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderPage(pageNumber) {
Â  Â  currentPage = pageNumber;
Â  Â  const pageData = pages[currentPage - 1] || [];
Â  Â  pageSections.forEach(section => section.innerHTML = '');

Â  Â  for (let s = 0; s < pageSections.length; s++) {
Â  Â  Â  Â  const sectionEl = pageSections[s];
Â  Â  Â  Â  const chunkStart = s * ITEMS_PER_SECTION;
Â  Â  Â  Â  const chunk = pageData.slice(chunkStart, chunkStart + ITEMS_PER_SECTION);

Â  Â  Â  Â  if (chunk.length === 0) continue;

Â  Â  Â  Â  const inner = document.createElement('div');
Â  Â  Â  Â  inner.className = 'section-inner';

Â  Â  Â  Â  const categoryKey = chunk[0].category;
Â  Â  Â  Â  const titleEl = document.createElement('div');
Â  Â  Â  Â  titleEl.className = 'category-title';
Â  Â  Â  Â  // --- NOVO: Usa o nome traduzido do grupo ---
Â  Â  Â  Â  titleEl.textContent = FOOD_GROUP_NAMES[categoryKey] || '';
Â  Â  Â  Â  inner.appendChild(titleEl);

Â  Â  Â  Â  const itemsContainer = document.createElement('div');
Â  Â  Â  Â  itemsContainer.className = 'food-items-container';

Â  Â  Â  Â  chunk.forEach(food => {
Â  Â  Â  Â  Â  Â  const itemEl = document.createElement('div');
Â  Â  Â  Â  Â  Â  itemEl.className = 'book-food-item';
Â  Â  Â  Â  Â  Â  itemEl.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  Â  Â  Â  Â  showFoodDetails(food);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  const img = document.createElement('img');
Â  Â  Â  Â  Â  Â  img.src = food.img;
Â  Â  Â  Â  Â  Â  img.alt = food.name;
Â  Â  Â  Â  Â  Â  const name = document.createElement('p');
Â  Â  Â  Â  Â  Â  name.textContent = food.name;
Â  Â  Â  Â  Â  Â  itemEl.appendChild(img);
Â  Â  Â  Â  Â  Â  itemEl.appendChild(name);
Â  Â  Â  Â  Â  Â  itemsContainer.appendChild(itemEl);
Â  Â  Â  Â  });

Â  Â  Â  Â  inner.appendChild(itemsContainer);
Â  Â  Â  Â  sectionEl.appendChild(inner);
Â  Â  }

Â  Â  updateNavigation();
}

Â  Â  function updateNavigation() {
Â  Â  Â  Â  // --- NOVO: Texto do indicador de pÃ¡gina traduzido ---
Â  Â  Â  Â  pageIndicator.textContent = `${translations.pagina_indicador} ${currentPage} ${translations.de_indicador} ${pages.length}`;
Â  Â  Â  Â  prevPageBtn.disabled = currentPage === 1;
Â  Â  Â  Â  nextPageBtn.disabled = currentPage === pages.length;
Â  Â  }

Â  Â  function changePage(direction) {
Â  Â  Â  Â  const newPage = currentPage + direction;
Â  Â  Â  Â  if (newPage > 0 && newPage <= pages.length) {
Â  Â  Â  Â  Â  Â  bookPagesContainer.classList.add('fade-out');
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  renderPage(newPage);
Â  Â  Â  Â  Â  Â  Â  Â  bookPagesContainer.classList.remove('fade-out');
Â  Â  Â  Â  Â  Â  }, 300);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function openBook() {
Â  Â  pushModalPause();
Â  Â  renderPage(1);
Â  Â  bookModal.classList.remove('hidden');
Â  Â  bookModal.classList.add('flex');
}

Â  Â  function closeBook() {
Â  Â  bookModal.classList.add('hidden');
Â  Â  bookModal.classList.remove('flex');
Â  Â  popModalPause();
}

Â  Â  function showFoodDetails(food) {
Â  Â  Â  Â  foodDetailName.textContent = food.name;
Â  Â  Â  Â  foodDetailImg.src = food.img;
Â  Â  Â  Â  foodDetailImg.alt = food.name;
Â  Â  Â  Â  foodDetailDesc.textContent = food.description;
Â  Â  Â  Â  foodDetailFunFact.textContent = food.funFact;
Â  Â  Â  Â  foodDetailNutri.textContent = food.nutritionalInfo;
Â  Â  Â  Â  foodDetailModal.classList.remove('hidden');
Â  Â  Â  Â  foodDetailModal.classList.add('flex');
Â  Â  Â  Â  pushModalPause();
Â  Â  }

Â  Â  function closeFoodDetails() {
Â  Â  Â  Â  foodDetailModal.classList.add('hidden');
Â  Â  Â  Â  foodDetailModal.classList.remove('flex');
Â  Â  Â  Â  popModalPause();
Â  Â  }
Â  Â  // --- FIM FUNÃ‡Ã•ES DO LIVRO E MODAIS ---

Â  Â  // --- FUNÃ‡Ã•ES DE INTRODUÃ‡ÃƒO E TRANSIÃ‡ÃƒO ---
Â  Â  function startIntroduction() {
Â  Â  Â  Â  playSound('clique-ui');
Â  Â  Â  Â  startScreen.classList.add('hidden');
Â  Â  Â  Â  isShowingIntro = true;
Â  Â  Â  Â  introStep = 0;
Â  Â  Â  Â  showNextIntroDialogue();
Â  Â  }

Â  Â  function showNextIntroDialogue() {
Â  Â  Â  Â  if (introStep < introDialogues.length) {
Â  Â  Â  Â  Â  Â  const dialogue = introDialogues[introStep];
Â  Â  Â  Â  Â  Â  stageMacawSprite.src = MACAW_SPRITES.falando;
Â  Â  Â  Â  Â  Â  document.getElementById('stage-title').textContent = dialogue.title;
Â  Â  Â  Â  Â  Â  document.getElementById('stage-explanation').textContent = dialogue.text;
Â  Â  Â  Â  Â  Â  stageTransitionScreen.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  stageTransitionScreen.classList.add('flex');
Â  Â  Â  Â  Â  Â  isPaused = true;
Â  Â  Â  Â  Â  Â  introStep++;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  isShowingIntro = false;
Â  Â  Â  Â  Â  Â  stageTransitionScreen.classList.add('hidden');
Â  Â  Â  Â  Â  Â  stageTransitionScreen.classList.remove('flex'); // Garante que saiu do flex
Â  Â  Â  Â  Â  Â  isPaused = false;
Â  Â  Â  Â  Â  Â  startGame();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function handleNextButtonClick() {
Â  Â  Â  Â  if (isShowingIntro) {
Â  Â  Â  Â  Â  Â  showNextIntroDialogue();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  resumeGame();
Â  Â  Â  Â  }
Â  Â  }
Â  Â  // --- FIM FUNÃ‡Ã•ES DE INTRODUÃ‡ÃƒO E TRANSIÃ‡ÃƒO ---

Â  Â  // --- AJUSTE DE REDIMENSIONAMENTO ---
Â  Â  function handleResize() {
Â  Â  Â  Â  if (isPaused || !gameLoopInterval || !esteiraContainer) return;
Â  Â  Â  Â  const foodsOnBelt = esteiraContainer.querySelectorAll('.food-item');
Â  Â  Â  Â  const container = esteiraContainer;
Â  Â  Â  Â  const verticalCenterPx = container.clientWidth * (PATH_PERCENTAGES.SPAWN_X / 100);
Â  Â  Â  Â  const wiggle = 20;
Â  Â  Â  Â  foodsOnBelt.forEach(food => {
Â  Â  Â  Â  Â  Â  const path = parseInt(food.dataset.path);
Â  Â  Â  Â  Â  Â  if (path === PATH_STATE.MOVE_DOWN) {
Â  Â  Â  Â  Â  Â  Â  Â  food.style.left = `${verticalCenterPx - (wiggle / 2) + (Math.random() * wiggle)}px`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
Â  Â  // --- FIM AJUSTE DE REDIMENSIONAMENTO ---

Â  Â  // --- FUNÃ‡Ã•ES PRINCIPAIS DO JOGO ---
Â  Â  function startGame() {
Â  Â  Â  Â  endScreen.classList.add('hidden');
Â  Â  Â  Â  endScreen.classList.remove('flex');
Â  Â  Â  Â  startScreen.classList.add('hidden');
Â  Â  Â  Â  startScreen.classList.remove('flex');
Â  Â  Â  Â  gameHeader.classList.remove('hidden');
Â  Â  Â  Â  gameMain.classList.remove('hidden');
Â  Â  Â  Â  timer = INITIAL_TIME;
Â  Â  Â  Â  score = 0;
Â  Â  Â  Â  currentStageIndex = 0;
Â  Â  Â  Â  isPaused = false;
Â  Â  Â  Â  lastUsedFoods = [];
Â  Â  Â  Â  updateScore(0);
Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  esteiraContainer.innerHTML = '';
Â  Â  Â  Â  setupStage();
Â  Â  Â  Â  startGameplayLoops();
Â  Â  Â  Â  scheduleRandomDialogue();
Â  Â  Â  Â  fadeIn('musica-fundo', 0.3, 1500);
Â  Â  }

Â  Â  function startGameplayLoops() {
Â  Â  Â  Â  if (timerInterval) clearInterval(timerInterval);
Â  Â  Â  Â  if (foodSpawnInterval) clearInterval(foodSpawnInterval);
Â  Â  Â  Â  if (gameLoopInterval) clearInterval(gameLoopInterval);
Â  Â  Â  Â  startTimer();
Â  Â  Â  Â  startSpawningFood();
Â  Â  Â  Â  startGameLoop();
Â  Â  }

Â  Â  function setupStage() {
Â  Â  Â  Â  stageOrders = 0;
Â  Â  Â  Â  stageDisplayEl.textContent = STAGES[currentStageIndex].stage;
Â  Â  Â  Â  generateOrder();
Â  Â  }

Â  Â  function generateOrder() {
Â  Â  Â  Â  const stage = STAGES[currentStageIndex];
Â  Â  Â  Â  currentOrder = [];
Â  Â  Â  Â  clearPlate();
Â  Â  Â  Â  for (let i = 0; i < stage.orderSize; i++) {
Â  Â  Â  Â  Â  Â  const type = stage.possibleOrderTypes[Math.floor(Math.random() * stage.possibleOrderTypes.length)];
Â  Â  Â  Â  Â  Â  currentOrder.push(type);
Â  Â  Â  Â  Â  Â  // --- NOVO: Usa o nome traduzido do grupo ---
Â  Â  Â  Â  Â  Â  orderSlots[i].textContent = FOOD_GROUP_NAMES[type];
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function startTimer() {
Â  Â  Â  Â  if (timerInterval) clearInterval(timerInterval);
Â  Â  Â  Â  timerInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  if (isPaused) return;
Â  Â  Â  Â  Â  Â  timer--;
Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  if (timer <= 15 && timer > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  timerEl.classList.add('timer-warning');
Â  Â  Â  Â  Â  Â  Â  Â  if (timer % 2 === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playSound('alerta-cronometro');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  timerEl.classList.remove('timer-warning');
                stopSound('alerta-cronometro');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (timer <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  timer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  Â  Â  endGame(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 1000);
Â  Â  }

Â  Â  function updateTimerDisplay() {
Â  Â  Â  Â  const minutes = Math.floor(timer / 60).toString().padStart(2, '0');
Â  Â  Â  Â  const seconds = (timer % 60).toString().padStart(2, '0');
Â  Â  Â  Â  timerEl.textContent = `${minutes}:${seconds}`;
Â  Â  }

Â  Â  function startSpawningFood() {
Â  Â  Â  Â  if (foodSpawnInterval) clearInterval(foodSpawnInterval);
Â  Â  Â  Â  if (!isPaused) spawnFood();
Â  Â  Â  Â  foodSpawnInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  if (isPaused) return;
Â  Â  Â  Â  Â  Â  spawnFood();
Â  Â  Â  Â  }, FOOD_SPAWN_INTERVAL);
Â  Â  }

Â  Â  function spawnFood() {
Â  Â  Â  Â  const stage = STAGES[currentStageIndex];
Â  Â  Â  Â  const randomType = stage.foodTypes[Math.floor(Math.random() * stage.foodTypes.length)];
Â  Â  Â  Â Â 
Â  Â  Â  Â  // A variÃ¡vel 'FOODS' jÃ¡ estÃ¡ no idioma correto
Â  Â  Â  Â  if (!FOODS[randomType] || FOODS[randomType].length === 0) return; // Checagem de seguranÃ§a

Â  Â  Â  Â  const foodData = FOODS[randomType][Math.floor(Math.random() * FOODS[randomType].length)];
Â  Â  Â  Â  const container = esteiraContainer;
Â  Â  Â  Â  if (!container) return;

Â  Â  Â  Â  const foodEl = document.createElement('div');
Â  Â  Â  Â  foodEl.id = `food-${Date.now()}-${Math.random()}`;
Â  Â  Â  Â  foodEl.className = 'food-item';
Â  Â  Â  Â  foodEl.style.backgroundImage = `url('${foodData.img}')`; // foodData.img jÃ¡ tem o sufixo correto
Â  Â  Â  Â  foodEl.draggable = true;
Â  Â  Â  Â  foodEl.dataset.type = randomType;
Â  Â  Â  Â  foodEl.dataset.img = foodData.img;
Â  Â  Â  Â  foodEl.dataset.name = foodData.name;

Â  Â  Â  Â  // --- Eventos de MOUSE (PC) ---
Â  Â  Â  Â  foodEl.addEventListener('dragstart', (e) => {
Â  Â  Â  Â  Â  Â  if (isPaused) {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  playSound('pegar-soltar');
Â  Â  Â  Â  Â  Â  e.dataTransfer.setData('text/plain', foodEl.id);
Â  Â  Â  Â  Â  Â  foodEl.dataset.dragging = 'true';
Â  Â  Â  Â  Â  Â  setTimeout(() => foodEl.classList.add('opacity-50'), 0);
Â  Â  Â  Â  });
Â  Â  Â  Â  foodEl.addEventListener('dragend', () => {
Â  Â  Â  Â  Â  Â  Â foodEl.classList.remove('opacity-50');
Â  Â  Â  Â  Â  Â  Â delete foodEl.dataset.dragging;
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- NOVO: Evento de TOQUE (Mobile) ---
Â  Â  Â  Â  // { passive: false } Ã© crucial para permitir o e.preventDefault()
Â  Â  Â  Â  foodEl.addEventListener('touchstart', handleTouchStart, { passive: false });
Â  Â  Â  Â  // --- FIM: Evento de Toque ---

Â  Â  Â  Â  foodEl.style.top = `${container.clientHeight * (PATH_PERCENTAGES.SPAWN_Y / 100)}px`;
Â  Â  Â  Â  const wiggle = 20;
Â  Â  Â  Â  const verticalCenterPx = container.clientWidth * (PATH_PERCENTAGES.SPAWN_X / 100);
Â  Â  Â  Â  foodEl.style.left = `${verticalCenterPx - (wiggle / 2) + (Math.random() * wiggle)}px`;
Â  Â  Â  Â  foodEl.dataset.path = PATH_STATE.MOVE_DOWN;

Â  Â  Â  Â  foodEl.classList.add('food-spawn');
Â  Â  Â  Â  foodEl.addEventListener('animationend', () => foodEl.classList.remove('food-spawn'), { once: true });

Â  Â  Â  Â  container.appendChild(foodEl);
Â  Â  }

Â  Â  function startGameLoop() {
Â  Â  Â  Â  if (gameLoopInterval) clearInterval(gameLoopInterval);
Â  Â  Â  Â  gameLoopInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  if (isPaused) return;
Â  Â  Â  Â  Â  Â  moveFood();
Â  Â  Â  Â  }, 1000 / 60);
Â  Â  }

Â  Â  function moveFood() {
Â  Â  Â  Â  const foodsOnBelt = esteiraContainer.querySelectorAll('.food-item:not([data-dragging="true"])');
Â  Â  Â  Â  const speed = (FOOD_SPEED / 60);
Â  Â  Â  Â  const container = esteiraContainer;
Â  Â  Â  Â  if (!container) return;

Â  Â  Â  Â  const turn1Y_px = container.clientHeight * (PATH_PERCENTAGES.TURN_1_Y / 100);
Â  Â  Â  Â  const turn2X_px = container.clientWidth * (PATH_PERCENTAGES.TURN_2_X / 100);
Â  Â  Â  Â  const turn3Y_px = container.clientHeight * (PATH_PERCENTAGES.TURN_3_Y / 100);
Â  Â  Â  Â  const turn4X_px = container.clientWidth * (PATH_PERCENTAGES.TURN_4_X / 100);
Â  Â  Â  Â  const exitY_px = container.clientHeight * (PATH_PERCENTAGES.EXIT_Y / 100);

Â  Â  Â  Â  foodsOnBelt.forEach(food => {
Â  Â  Â  Â  Â  Â  if (food.classList.contains('food-exit')) return;
Â  Â  Â  Â  Â  Â  let currentTop = parseFloat(food.style.top);
Â  Â  Â  Â  Â  Â  let currentLeft = parseFloat(food.style.left);
Â  Â  Â  Â  Â  Â  const path = parseInt(food.dataset.path);

Â  Â  Â  Â  Â  Â  switch (path) {
Â  Â  Â  Â  Â  Â  Â  Â  case PATH_STATE.MOVE_DOWN:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentTop < turn1Y_px) { food.style.top = `${currentTop + speed}px`; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { food.style.top = `${turn1Y_px}px`; food.dataset.path = PATH_STATE.MOVE_RIGHT; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case PATH_STATE.MOVE_RIGHT:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentLeft < turn2X_px) { food.style.left = `${currentLeft + speed}px`; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { food.style.left = `${turn2X_px}px`; food.dataset.path = PATH_STATE.MOVE_UP; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case PATH_STATE.MOVE_UP:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentTop > turn3Y_px) { food.style.top = `${currentTop - speed}px`; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { food.style.top = `${turn3Y_px}px`; food.dataset.path = PATH_STATE.MOVE_LEFT; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case PATH_STATE.MOVE_LEFT:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentLeft > turn4X_px) { food.style.left = `${currentLeft - speed}px`; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { food.style.left = `${turn4X_px}px`; food.dataset.path = PATH_STATE.MOVE_UP_EXIT; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case PATH_STATE.MOVE_UP_EXIT:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentTop > exitY_px) { food.style.top = `${currentTop - speed}px`; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  food.classList.add('food-exit');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  food.addEventListener('animationend', () => food.remove(), { once: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
Â  Â  // --- FIM FUNÃ‡Ã•ES PRINCIPAIS DO JOGO ---

Â  Â  // --- FUNÃ‡Ã•ES DE INTERAÃ‡ÃƒO (DRAG & DROP, VERIFICAÃ‡ÃƒO) ---

Â  Â  // --- NOVO: Handlers de Toque ---

Â  Â  function handleTouchStart(e) {
Â  Â  Â  Â  // Ignora se nÃ£o for um Ãºnico toque ou se o jogo estiver pausado
Â  Â  Â  Â  if (e.touches.length !== 1 || isPaused) return;

Â  Â  Â  Â  e.preventDefault(); // Previne scroll e "clique fantasma"
Â  Â  Â  Â Â 
Â  Â  Â  Â  draggedItem = e.currentTarget; // O .food-item
Â  Â  Â  Â  esteiraRect = esteiraContainer.getBoundingClientRect(); // Pega a posiÃ§Ã£o da esteira
Â  Â  Â  Â  const touch = e.touches[0];

Â  Â  Â  Â  // Calcula o offset do toque *dentro* do item
Â  Â  Â  Â  const itemRect = draggedItem.getBoundingClientRect();
Â  Â  Â  Â  touchOffsetX = touch.clientX - itemRect.left;
Â  Â  Â  Â  touchOffsetY = touch.clientY - itemRect.top;

Â  Â  Â  Â  // Marca como "arrastando" para pausar o movimento da esteira
Â  Â  Â  Â  draggedItem.dataset.dragging = 'true';
Â  Â  Â  Â  playSound('pegar-soltar');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Estilos de "pegar"
Â  Â  Â  Â  draggedItem.style.zIndex = 1000; // PÃµe sobre tudo
Â  Â  Â  Â  draggedItem.classList.add('opacity-50');
Â  Â  Â  Â  draggedItem.style.transform = 'scale(1.1)'; // Aumenta um pouco
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Move o item para a posiÃ§Ã£o inicial do dedo (jÃ¡ aplicando o offset)
Â  Â  Â  Â  // Converte coordenada do viewport (touch.clientX) para coordenada da esteira (style.left)
Â  Â  Â  Â  let x = touch.clientX - esteiraRect.left - touchOffsetX;
Â  Â  Â  Â  let y = touch.clientY - esteiraRect.top - touchOffsetY;
Â  Â  Â  Â Â 
Â  Â  Â  Â  draggedItem.style.left = `${x}px`;
Â  Â  Â  Â  draggedItem.style.top = `${y}px`;
Â  Â  }

Â  Â  function handleTouchMove(e) {
Â  Â  Â  Â  if (!draggedItem || isPaused) return;

Â  Â  Â  Â  e.preventDefault(); // Previne scroll
Â  Â  Â  Â Â 
Â  Â  Â  Â  const touch = e.touches[0];
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Move o item
Â  Â  Â  Â  // Usa o esteiraRect cacheado para melhor performance
Â  Â  Â  Â  let x = touch.clientX - esteiraRect.left - touchOffsetX;
Â  Â  Â  Â  let y = touch.clientY - esteiraRect.top - touchOffsetY;
Â  Â  Â  Â Â 
Â  Â  Â  Â  draggedItem.style.left = `${x}px`;
Â  Â  Â  Â  draggedItem.style.top = `${y}px`;

Â  Â  Â  Â  // Simula dragover/dragleave checando a posiÃ§Ã£o
Â  Â  Â  Â  let foundTarget = null;
Â  Â  Â  Â  // Itera sobre as cestas para ver se o toque estÃ¡ em cima de alguma
Â  Â  Â  Â  for (const slot of plateSlots) {
Â  Â  Â  Â  Â  Â  const slotRect = slot.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  if (
Â  Â  Â  Â  Â  Â  Â  Â  touch.clientX >= slotRect.left &&
Â  Â  Â  Â  Â  Â  Â  Â  touch.clientX <= slotRect.right &&
Â  Â  Â  Â  Â  Â  Â  Â  touch.clientY >= slotRect.top &&
Â  Â  Â  Â  Â  Â  Â  Â  touch.clientY <= slotRect.bottom
Â  Â  Â  Â  Â  Â  ) {
Â  Â  Â  Â  Â  Â  Â  Â  foundTarget = slot;
Â  Â  Â  Â  Â  Â  Â  Â  break; // Encontrou um
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Atualiza o highlight (classe 'drag-over')
Â  Â  Â  Â  if (foundTarget !== currentDropTarget) {
Â  Â  Â  Â  Â  Â  if (currentDropTarget) {
Â  Â  Â  Â  Â  Â  Â  Â  currentDropTarget.classList.remove('drag-over');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (foundTarget) {
Â  Â  Â  Â  Â  Â  Â  Â  foundTarget.classList.add('drag-over');
Â  Â  Â  Â  Â   }
Â  Â  Â  Â  Â  Â  currentDropTarget = foundTarget; // Atualiza o alvo atual
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function handleTouchEnd(e) {
Â  Â  Â  Â  if (!draggedItem) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let dropped = false;
Â  Â  Â  Â  // 'currentDropTarget' foi definido no Ãºltimo 'touchmove'
Â  Â  Â  Â  if (currentDropTarget) {
Â  Â  Â  Â  Â  Â  // Tenta colocar no slot
Â  Â  Â  Â  Â  Â  dropped = placeItemInSlot(draggedItem, currentDropTarget);
Â  Â  Â  Â  Â  Â  currentDropTarget.classList.remove('drag-over'); // Limpa o highlight
Â  Â  Â  Â  }

Â  Â  Â  Â  // Se nÃ£o foi solto com sucesso (ou nÃ£o tinha dropTarget)
Â  Â  Â  Â  if (!dropped) {
Â  Â  Â  Â  Â  Â  // Item "volta" para a esteira (apenas removemos os estilos de drag)
Â  Â  Â  Â  Â  Â  delete draggedItem.dataset.dragging;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Limpa estilos de drag/touch
Â  Â  Â  Â  draggedItem.classList.remove('opacity-50');
Â  Â  Â  Â  draggedItem.style.zIndex = 15; // Z-index normal
Â  Â  Â  Â  draggedItem.style.transform = 'scale(1)'; // Tamanho normal
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Reseta variÃ¡veis globais de toque
Â  Â  Â  Â  draggedItem = null;
Â  Â  Â  Â  currentDropTarget = null;
Â  Â  Â  Â  esteiraRect = null;
Â  Â  }

Â  Â  // --- FIM: Handlers de Toque ---

Â  Â  function handleDragOver(e) {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  e.currentTarget.classList.add('drag-over');
Â  Â  }

Â  Â  function handleDragLeave(e) {
Â  Â  Â  Â  e.currentTarget.classList.remove('drag-over');
Â  Â  }

Â  Â  // --- NOVO: FunÃ§Ã£o reutilizÃ¡vel para colocar item ---
Â  Â  /**
Â  Â  * Tenta colocar um foodEl (de mouse ou toque) em um slotEl (cesta).
Â  Â  * Retorna true se foi sucesso, false se o slot estava ocupado.
Â  Â  */
Â  Â  function placeItemInSlot(foodEl, slotEl) {
Â  Â  Â  Â  const slotIndex = parseInt(slotEl.dataset.slotIndex);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Permite soltar apenas se o slot estiver vazio
Â  Â  Â  Â  if (plateContents[slotIndex] === null) {
Â  Â  Â  Â  Â  Â  plateContents[slotIndex] = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  type: foodEl.dataset.type,Â 
Â  Â  Â  Â  Â  Â  Â  Â  img: foodEl.dataset.img,Â 
Â  Â  Â  Â  Â  Â  Â  Â  name: foodEl.dataset.nameÂ 
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const imgInPlate = document.createElement('img');
Â  Â  Â  Â  Â  Â  imgInPlate.src = foodEl.dataset.img;
Â  Â  Â  Â  Â  Â  slotEl.innerHTML = ''; // Limpa antes de adicionar
Â  Â  Â  Â  Â  Â  slotEl.appendChild(imgInPlate);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  foodEl.remove(); // Remove o item da esteira
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  playSound('pegar-soltar');
Â  Â  Â  Â  Â  Â  checkPlateFullness();
Â  Â  Â  Â  Â  Â  return true; // Sucesso
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  return false; // Falha (slot ocupado)
Â  Â  Â  Â  }
Â  Â  }
Â  Â  // --- FIM: FunÃ§Ã£o reutilizÃ¡vel ---

Â  Â  // --- ATUALIZADO: handleDrop agora usa a nova funÃ§Ã£o ---
Â  Â  function handleDrop(e) {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const slotEl = e.currentTarget;
Â  Â  Â  Â  slotEl.classList.remove('drag-over');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const foodId = e.dataTransfer.getData('text/plain');
Â  Â  Â  Â  const foodEl = document.getElementById(foodId);
Â  Â  Â  Â  if (!foodEl) return;

Â  Â  Â  Â  const success = placeItemInSlot(foodEl, slotEl);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Se nÃ£o teve sucesso (slot ocupado), o dragend listener
Â  Â  Â  Â  // jÃ¡ vai lidar com a remoÃ§Ã£o do 'dataset.dragging'
Â  Â  Â  Â  if (!success) {
Â  Â  Â  Â  Â  Â  delete foodEl.dataset.dragging;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function handlePotClick(e) {
Â  Â  Â  Â  const slotEl = e.currentTarget;
Â  Â  Â  Â  const slotIndex = parseInt(slotEl.dataset.slotIndex);
Â  Â  Â  Â  if (plateContents[slotIndex] !== null) {
Â  Â  Â  Â  Â  Â  plateContents[slotIndex] = null;
Â  Â  Â  Â  Â  Â  slotEl.innerHTML = '';
Â  Â  Â  Â  Â  Â  playSound('pegar-soltar');
Â  Â  Â  Â  Â  Â  checkPlateFullness();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function checkPlateFullness() {
Â  Â  Â  Â  const isFull = plateContents.every(item => item !== null);
Â  Â  Â  Â  verifyButton.disabled = !isFull;
Â  Â  Â  Â  if (isFull) {
Â  Â  Â  Â  Â  Â  verifyButton.classList.remove('opacity-50', 'cursor-not-allowed');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  verifyButton.classList.add('opacity-50', 'cursor-not-allowed');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function verifyOrder() {
Â  Â  if (!plateContents.every(item => item !== null)) return;
Â  Â Â 
Â  Â  // --- LÃ“GICA CORRIGIDA: A ORDEM IMPORTA ---
Â  Â  const insertedTypes = plateContents.map(p => p.type); // Ordem em que foram inseridos (slot 0, 1, 2)
Â  Â  const requiredTypes = currentOrder;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Ordem que foi pedida (slot 0, 1, 2)

    // DEBUG: Verifique no console para entender o que estÃ¡ sendo comparado.
    console.log("Pedido (requiredTypes):", requiredTypes);
    console.log("Inserido (insertedTypes):", insertedTypes);
    
Â  Â  // Compara se os tamanhos sÃ£o iguais E se cada elemento na posiÃ§Ã£o 'i' Ã© igual ao elemento na mesma posiÃ§Ã£o do pedido.
Â  Â  let isCorrect = insertedTypes.length === requiredTypes.length && 
                    insertedTypes.every((type, index) => type === requiredTypes[index]);
    
    console.log("Resultado da verificaÃ§Ã£o (isCorrect):", isCorrect);
Â  Â  // --- FIM DA LÃ“GICA CORRIGIDA ---

Â  Â  verifyButton.disabled = true;
Â  Â  Â  Â  verifyButton.classList.add('opacity-50', 'cursor-not-allowed');

Â  Â  Â  Â  if (isCorrect) {
Â  Â  Â  Â  Â  Â  handleCorrectOrder();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  handleWrongOrder();
Â  Â  Â  Â  Â  Â  // Re-habilita o botÃ£o apÃ³s um delay se estiver errado,
Â  Â  Â  Â  Â  Â  // permitindo que o usuÃ¡rio veja o feedback antes de tentar de novo.
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!isPaused) checkPlateFullness();
Â  Â  Â  Â  Â  Â  }, 600);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function handleCorrectOrder() {
Â  Â  Â  Â  playSound('acerto');
Â  Â  Â  Â  playSound('bonus-tempo');
Â  Â  Â  Â  plateSlots.forEach(slot => {
Â  Â  Â  Â  Â  Â  slot.classList.add('correct-plate');
Â  Â  Â  Â  Â  Â  setTimeout(() => { slot.innerHTML = ''; }, 500);
Â  Â  Â  Â  });
Â  Â  Â  Â  setTimeout(() => plateSlots.forEach(slot => slot.classList.remove('correct-plate')), 700);

Â  Â  Â  Â  updateScore(score + 1);
Â  Â  Â  Â  stageOrders++;
Â  Â  Â  Â  timer += TIME_BONUS;
Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  showMacawMessage(getRandomDialogue('praise'), 4000, 'feliz');

Â  Â  Â  Â  plateContents.forEach(food => lastUsedFoods.push(food.name));
Â  Â  Â  Â  if (lastUsedFoods.length > 9) lastUsedFoods.shift();
Â  Â  Â  Â  const lastFoodName = plateContents[plateContents.length-1].name;
  Â  Â  if (lastUsedFoods.filter(foodName => foodName === lastFoodName).length >= 3) {
Â  Â  Â  Â  Â  Â  setTimeout(() => showMacawMessage(getRandomDialogue('variety'), 4000, 'curiosa'), 3500);
Â  Â  Â  Â  Â  Â  lastUsedFoods = [];
Â  Â  Â  Â  }

Â  Â  Â  Â  const stage = STAGES[currentStageIndex];
Â  Â  Â  Â  const delayNextAction = 1000;
Â  Â  Â  Â  if (stageOrders >= stage.goal) {
Â  Â  Â  Â  Â  Â  if (currentStageIndex < STAGES.length - 1) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(advanceStage, delayNextAction);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => endGame(true), delayNextAction);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  setTimeout(generateOrder, delayNextAction);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function handleWrongOrder() {
Â  Â  Â  Â  playSound('erro');
Â  Â  Â  Â  plateSlots.forEach(slot => slot.classList.add('wrong-plate'));
Â  Â  Â  Â  setTimeout(() => plateSlots.forEach(slot => slot.classList.remove('wrong-plate')), 500);
Â  Â  Â  Â  showMacawMessage(getRandomDialogue('hints'), 5000, 'triste');
Â  Â  }

Â  Â  function clearPlate() {
Â  Â  Â  Â  plateContents = [null, null, null];
Â  Â  Â  Â  plateSlots.forEach(slot => { slot.innerHTML = ''; });
Â  Â  Â  Â  orderSlots.forEach(slot => slot.textContent = '');
Â  Â  Â  Â  checkPlateFullness();
Â  Â  }

Â  Â  function updateScore(newScore) {
Â  Â  Â  Â  score = newScore;
Â  Â  Â  Â  scoreEl.textContent = score;
Â  Â  }
Â  Â  // --- FIM FUNÃ‡Ã•ES DE INTERAÃ‡ÃƒO ---

Â  Â  // --- FUNÃ‡Ã•ES DA ARARA E FIM DE JOGO ---
Â  Â  function showMacawMessage(text, duration = 4000, expression = 'falando') {
Â  Â  Â  Â  if (macawTimeout) clearTimeout(macawTimeout);
Â  Â  Â  Â  macawSprite.src = MACAW_SPRITES[expression];
Â  Â  Â  Â  macawText.textContent = text;
Â  Â  Â  Â  macawMessage.classList.remove('opacity-0');
    Â  Â  macawTimeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  macawMessage.classList.add('opacity-0');
Â  Â  Â  Â  }, duration);
Â  Â  }

Â  Â  function scheduleRandomDialogue() {
Â  Â  Â  Â  if (otherDialogueTimeout) clearTimeout(otherDialogueTimeout);
Â  Â  Â  Â  otherDialogueTimeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  if (!isPaused && !isShowingIntro && macawMessage.classList.contains('opacity-0')) {
Â  Â  Â  Â  Â  Â  Â  Â  showMacawMessage(getRandomDialogue('other'), 4000, 'falando');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  scheduleRandomDialogue();
Â  Â  Â  Â  }, 20000 + Math.random() * 15000); 
}


Â  Â  function advanceStage() {
Â  Â  Â  Â  isPaused = true;
Â  Â  Â  Â  currentStageIndex++;
Â  Â  Â  Â  if (currentStageIndex >= STAGES.length) {
Â  Â  Â  Â  Â  Â  endGame(true);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const stage = STAGES[currentStageIndex];
Â  Â  Â  Â  // --- NOVO: Pega o diÃ¡logo da etapa do objeto de traduÃ§Ã£o ---
Â  Â  Â  Â  const stageDialogueKey = `stage${currentStageIndex + 1}`;
Â  Â  Â  Â  const stageDialogue = translations[stageDialogueKey] || "PrÃ³xima etapa!";
Â  Â  Â  Â  // --- FIM DA MUDANÃ‡A ---

Â  Â  Â  Â  stageMacawSprite.src = MACAW_SPRITES.falando;
Â  Â  Â  Â  document.getElementById('stage-title').textContent = stage.title;
Â  Â  Â  Â  document.getElementById('stage-explanation').textContent = stageDialogue;

Â  Â  Â  Â  stageTransitionScreen.classList.remove('hidden');
Â  Â  Â  Â  stageTransitionScreen.classList.add('flex');
Â  Â  }

Â  Â  function resumeGame() {
Â  Â  Â  Â  stageTransitionScreen.classList.add('hidden');
Â  Â  Â  Â  stageTransitionScreen.classList.remove('flex');
Â  Â  Â  Â  isPaused = false;
Â  Â  Â  Â  setupStage();
Â  Â  }

Â  Â  function stopGameIntervals() {
Â  Â  Â  Â  clearInterval(timerInterval);
Â  Â  Â  Â  clearInterval(foodSpawnInterval);
Â  Â  Â  Â  clearInterval(gameLoopInterval);
Â  Â  Â  Â  clearTimeout(macawTimeout);
Â  Â  Â  Â  clearTimeout(otherDialogueTimeout);
Â  Â  Â  Â  timerInterval = null;
Â  Â  Â  Â  foodSpawnInterval = null;
Â  Â  Â  Â  gameLoopInterval = null;
Â  Â  Â  Â  macawTimeout = null;
Â  Â  Â  Â  otherDialogueTimeout = null;
Â  Â  Â  Â  fadeOut('musica-fundo', 1000);
Â  Â  Â  Â  stopSound('alerta-cronometro');
Â  Â  }

Â  Â  function endGame(isWinner) {
Â  Â  Â  Â  isPaused = true;
Â  Â  Â  Â  stopGameIntervals();
Â  Â  Â  Â  playSound('avaliacao-final');
Â  Â  Â  Â  gameHeader.classList.add('hidden');
Â  Â  Â  Â  gameMain.classList.add('hidden');
Â  Â  Â  Â  document.getElementById('final-score').textContent = score;
Â  Â  Â  Â  const starsContainer = document.getElementById('stars-container');
Â  Â  Â  Â  starsContainer.innerHTML = '';
Â  Â  Â  Â  let stars = 0, message = "", title = "";
Â  Â  Â  Â  const totalGoal = STAGES[STAGES.length-1].goal;

Â  Â  Â  Â  if (isWinner) {
Â  Â  Â  Â  Â  Â  // --- NOVO: Textos de vitÃ³ria traduzidos ---
Â  Â  Â  Â  Â  Â  title = translations.end_titulo_vitoria;
Â  Â  Â  Â  Â  Â  stars = 3;
Â  Â  Â  Â  Â  Â  message = translations.performance[2];
Â  Â  Â  Â  Â  Â  endMacawSprite.src = MACAW_SPRITES.feliz;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // --- NOVO: Textos de derrota traduzidos ---
Â  Â  Â  Â  Â  Â  title = translations.end_titulo_padrao;
Â  Â  Â  Â  Â  Â  if (score >= totalGoal) { // Venceu, mas o tempo acabou? (Caso de Borda)
Â  Â  Â  Â  Â  Â  Â  Â  stars = 2;
Â  Â  Â  Â  Â  Â  Â  Â  message = translations.performance[1];
  Â  Â  Â  Â  Â  Â  Â  endMacawSprite.src = MACAW_SPRITES.feliz;
Â  Â  Â  Â  Â  Â  } else if (score >= totalGoal * 0.5) {
Â  Â  Â  Â  Â  Â  Â  Â  stars = 1;
Â  Â  Â  Â  Â  Â  Â  Â  message = translations.performance[0];
Â  Â  Â  Â  Â  Â  Â  Â  endMacawSprite.src = MACAW_SPRITES.curiosa;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  stars = 0;
Â  Â  Â  Â  Â  Â  Â  Â  message = getRandomDialogue('defeat');
Â  Â  Â  Â  Â  Â  Â  Â  endMacawSprite.src = MACAW_SPRITES.triste;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  for(let i = 0; i < 3; i++) {
Â  Â  Â  Â  Â  Â  const starSpan = document.createElement('span');
Â  Â  Â  Â  Â  Â  starSpan.textContent = i < stars ? 'â­' : 'â˜†';
Â  Â  Â  Â  Â  Â  starsContainer.appendChild(starSpan);
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById('end-title').textContent = title;
Â  Â  Â  Â  document.getElementById('end-message').textContent = message;
Â  Â  Â  Â  endScreen.classList.remove('hidden');
Â  Â  Â  Â  endScreen.classList.add('flex');
Â  Â  }
Â  Â  // --- FIM FUNÃ‡Ã•ES DA ARARA E FIM DE JOGO ---

Â  Â  // --- INICIALIZAÃ‡ÃƒO ---
Â  Â  init();
=======
    // --- NOVO: CARREGA E APLICA O IDIOMA ---
    const currentLang = getLanguage();
    const translations = gameTranslations[currentLang];
    translatePage(currentLang);
    // --- FIM DA APLICAÃ‡ÃƒO DE IDIOMA ---


    // --- BLOQUEIO DE ZOOM ---
    window.addEventListener('wheel', function(event) {
        if (event.ctrlKey || event.metaKey) {
            event.preventDefault();
        }
    }, { passive: false });

    // --- SELEÃ‡ÃƒO DOS ELEMENTOS DA UI ---
    const gameContainer = document.getElementById('game-container');
    const startScreen = document.getElementById('start-screen');
    const stageTransitionScreen = document.getElementById('stage-transition-screen');
    const endScreen = document.getElementById('end-screen');
    const startButton = document.getElementById('start-button');
    const nextStageButton = document.getElementById('next-stage-button');
    const restartButton = document.getElementById('restart-button');
    const scoreEl = document.getElementById('score');
    const stageDisplayEl = document.getElementById('stage-display');
    const timerEl = document.getElementById('timer');
    const esteiraContainer = document.getElementById('esteira-container'); // ReferÃªncia ao contÃªiner da esteira
    const orderSlots = document.querySelectorAll('.ticket-item');
    const plateSlots = document.querySelectorAll('#cestas-container .cesta');
    const verifyButton = document.getElementById('verify-button');
    const macawMessage = document.getElementById('macaw-message');
    const macawText = document.getElementById('macaw-text');
    const gameHeader = document.querySelector('header');
    const gameMain = document.querySelector('main');
    const macawSprite = document.getElementById('macaw-sprite');
    const endMacawSprite = document.getElementById('end-macaw-sprite');
    const stageMacawSprite = document.getElementById('stage-macaw-sprite');
    const bookButton = document.getElementById('book-button');
    const bookModal = document.getElementById('book-modal');
    const bookModalClose = document.getElementById('book-modal-close');
    const bookPagesContainer = document.getElementById('book-pages-container');
    const pageSections = document.querySelectorAll('.page .section');
    const prevPageBtn = document.getElementById('prev-page-btn');
    const nextPageBtn = document.getElementById('next-page-btn');
    const pageIndicator = document.getElementById('page-indicator');
    const foodDetailModal = document.getElementById('food-detail-modal');
    const foodDetailClose = document.getElementById('food-detail-close');
    const foodDetailName = document.getElementById('food-detail-name');
    const foodDetailImg = document.getElementById('food-detail-img');
    const foodDetailDesc = document.getElementById('food-detail-desc');
    const foodDetailFunFact = document.getElementById('food-detail-funfact');
    const foodDetailNutri = document.getElementById('food-detail-nutri');

    const MACAW_SPRITES = {
        falando: 'assets/arara-falando-padrao.png',
        feliz: 'assetsa/rara-feliz-padrao.png',
        triste: 'assets/arara-triste-padrao.png',
        curiosa: 'assets/arara-curiosa-padrao.png'
    };
    
    // --- NOVO: Define os diÃ¡logos dinÃ¢micos com base no idioma ---
    const introDialogues = [
        { title: translations.tutorial_title, text: translations.tutorial },
        { title: translations.stage1_title, text: translations.stage1 }
    ];

    // --- NOVO: FunÃ§Ã£o getRandomDialogue ---
    const getRandomDialogue = (type) => {
        const options = translations[type]; // 'type' serÃ¡ 'praise', 'hints', etc.
        if (!options) return "DiÃ¡logo nÃ£o encontrado.";
        return options[Math.floor(Math.random() * options.length)];
    };
    // --- FIM DAS MUDANÃ‡AS DE DIÃLOGO ---

    const INITIAL_TIME = 90;
    const TIME_BONUS = 10;
    const FOOD_SPAWN_INTERVAL = 2000;
    const FOOD_SPEED = 120; // Pixels por segundo (ajustado na funÃ§Ã£o moveFood)

    // --- LÃ“GICA DO CAMINHO DA ESTEIRA (REVISADA COM 4 CURVAS) ---

    // Define os estados do caminho (5 estados de movimento)
    const PATH_STATE = {
        MOVE_DOWN: 1,      // Spawn -> Curva 1 (Inferior Esquerda)
        MOVE_RIGHT: 2,     // Curva 1 -> Curva 2 (Inferior Direita)
        MOVE_UP: 3,        // Curva 2 -> Curva 3 (Superior Direita)
        MOVE_LEFT: 4,      // Curva 3 -> Curva 4 (Superior Esquerda)
        MOVE_UP_EXIT: 5    // Curva 4 -> SaÃ­da
    };

    // Objeto de "MarcaÃ§Ã£o de Coordenadas" (em % DENTRO do #esteira-container)
    // **AJUSTE ESTES VALORES** para corresponder ao desenho da sua 'esteira1.png'
    const PATH_PERCENTAGES = {
        // Ponto de Surgimento (Spawn) - Canto Superior Esquerdo da esteira visÃ­vel
        SPAWN_X: 6,        // % da esquerda do #esteira-container
        SPAWN_Y: 19,       // % do topo do #esteira-container (um pouco abaixo do topo real)

        // Ponto de SaÃ­da (Despawn) - Acima do ponto de spawn
        EXIT_X: 3,         // % da esquerda (deve ser igual a SPAWN_X e TURN_4_X)
        EXIT_Y: 20,        // % do topo (sair pelo topo do contÃªiner)

        // Pontos das Curvas (relativos ao #esteira-container)
        TURN_1_Y: 63,      // Y% da Curva 1 (Inferior Esquerda)
        TURN_2_X: 92,      // X% da Curva 2 (Inferior Direita)
        TURN_3_Y: 50,      // Y% da Curva 3 (Superior Direita - alinhado com SPAWN_Y)
        TURN_4_X: 18       // X% da Curva 4 (Superior Esquerda - alinhado com SPAWN_X)
    };

    // --- FIM DA LÃ“GICA DO CAMINHO ---

    // --- MUDANÃ‡A PRINCIPAL: Objeto de alimentos multi-idioma ---
    const ALL_FOODS_DATA = {
        // --- PORTUGUÃŠS (Original) ---
        'pt': {
            carboidrato: [{ name: 'Arroz', img: 'assets/arroz-padrao.png', description: 'O arroz integral Ã© um grÃ£o que mantÃ©m a casca e o farelo. Ele fornece energia, ajuda na digestÃ£o por ter mais fibras.', funFact: 'Quando o arroz estÃ¡ cozinhando ele faz um barulhinho (como estalinhos), como se estivesse avisando que jÃ¡ estÃ¡ quase pronto.', nutritionalInfo: 'O arroz integral Ã© uma boa fonte de fibra, contÃ©m vitaminas do complexo B e minerais como magnÃ©sio, fÃ³sforo e ferro. A fibra contribui para a saciedade, as vitaminas e os minerais sÃ£o essenciais para diversas funÃ§Ãµes do corpo.' },{ name: 'MacarrÃ£o', img: 'assets/macarrao-padrao.png', description: 'O macarrÃ£o integral fornece vitaminas, minerais e fibras para o nosso corpo, ajudando na digestÃ£o, controlando os nÃ­veis de aÃ§Ãºcar no sangue e fornecendo energia.', funFact: 'Alguns arqueÃ³logos encontraram vestÃ­gios de macarrÃ£o com quase 4 mil anos de idade, na China.', nutritionalInfo: 'O macarrÃ£o integral Ã© uma fonte rica de fibras, vitaminas e minerais, cada 100g de macarrÃ£o integral possui 124 calorias, auxilia na saciedade e no funcionamento do intestino.' },{ name: 'Banana', img: 'assets/banana-padrao-tea.png', description: 'A banana contribui para a saÃºde do coraÃ§Ã£o, melhora o funcionamento intestinal, aumenta a energia, fortifica os mÃºsculos e auxilia no humor.', funFact: 'As bananeiras nÃ£o sÃ£o Ã¡rvores, â€œsÃ£o ervas gigantesâ€, onde podem crescer mais de 7 metros de altura.', nutritionalInfo: 'A banana Ã© uma fonte de minerais como potÃ¡ssio e magnÃ©sio, vitamina B6 e C, e hidratos de carbono. Possui 26g de carboidrato, 98 calorias, 2g de fibras e 1,3g de proteÃ­nas.' },],
            proteina: [{ name: 'Carne', img: 'assets/carne-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Frango', img: 'assets/frango-padrao.png', description: 'O frango ajuda a construir mÃºsculos e dÃ¡ energia para o corpo.', funFact: 'Os atletas gostam de incluir bastante frango em seus pratos, pois ele ajuda a construir mÃºsculos e a dar bastante energia, principalmente o frango grelhado e cozido.', nutritionalInfo: 'O frango geralmente Ã© uma fonte rica em proteÃ­nas de alta qualidade e pobre em gorduras, com vitaminas do complexo B e minerais como selÃªnio e fÃ³sforo, sem hidratos de carbono e fibras.' },{ name: 'Ovo', img: 'assets/ovo-padrao-tea.png', description: 'O ovo da galinha ajuda o corpo a crescer e se manter saudÃ¡vel, alÃ©m disso, contÃ©m vitaminas e minerais importantes para os ossos, mÃºsculos e cÃ©rebro.', funFact: 'Se vocÃª girar um ovo cru e outro cozido, o cozido gira de forma firme, mas o cru balanÃ§a e tropeÃ§a por dentro.', nutritionalInfo: 'O ovo Ã© uma fonte de nutrientes completo, com baixo custo e versatilidade culinÃ¡ria, Ã© importante consumi-lo com cuidado para evitar contaminaÃ§Ã£o. Ele possui vitaminas A, D, E, B2, B12, folato e minerais essenciais como fÃ³sforo, ferro e selÃªnio.' },{ name: 'SalmÃ£o', img: 'assets/salmao-padrao.png', description: 'O salmÃ£o grelhado ajuda na saÃºde dos ossos e no bem-estar mental por conta das vitaminas e minerais, no crescimento muscular devido as proteÃ­nas presentes.', funFact: 'A cor laranja do salmÃ£o nÃ£o Ã© natural, Ã© apenas um resultado da alimentaÃ§Ã£o do peixe ao comer algas e crustÃ¡ceos.', nutritionalInfo: 'O salmÃ£o grelhado sem sal ou Ã³leo, pode conter 243 calorias e 26g de proteÃ­nas Ã© uma fonte rica em vitaminas como a D e B12, e do mineral selÃªnio.' },{ name: 'Peixe', img: 'assets/peixe-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' }],
            vitamina: [{ name: 'Cenoura', img: 'assets/cenoura-padrao.png', description: 'A cenoura ajuda a manter a visÃ£o saudÃ¡vel, ajudam o intestino a funcionar bem e dÃ¡ energia para o corpo.', funFact: 'Se vocÃª colocar cenouras cortadas em uma Ã¡gua com gÃ¡s, elas vÃ£o subir e descer como se estivessem fazendo uma coreografia.', nutritionalInfo: 'A cenoura Ã© um vegetal rico em vitamina A, que contribui para a saÃºde da visÃ£o e tem aÃ§Ã£o intoxicante. Ela contÃ©m vitaminas e minerais como potÃ¡ssio, e as fibras ajudam no funcionamento do intestino.' },{ name: 'FeijÃ£o', img: 'assets/feijao-padrao.png', description: 'O feijÃ£o Ã© uma leguminosa rica em proteÃ­na e fibra, que ajuda a manter os mÃºsculos fortes e o intestino funcionando bem.', funFact: 'A planta mais alta do feijÃ£o alcanÃ§ou mais de 14 metros de altura, o que Ã© mais de trÃªs girafas empilhadas.', nutritionalInfo: 'O feijÃ£o Ã© um alimento rico em nutrientes, fornecendo proteÃ­nas vegetais, carboidratos completos, fibras e vitaminas de complexo B e minerais como ferro, fÃ³sforo e potÃ¡ssio. A forma de preparo do feijÃ£o influencia o valor nutricional exato.' },{ name: 'Tomate', img: 'assets/tomate-padrao.png', description: 'O tomate auxilia na saÃºde do coraÃ§Ã£o e intestinal, fortalecendo os ossos, protegendo a pele e sendo aliado a imunidade.', funFact: 'A palavra tomate vem de "tomati", que significa "coisa roliÃ§a com umbigo", nome dado pelos astecas.', nutritionalInfo: 'O tomate Ã© rico em Ã¡gua, fibras, vitamina C e A e minerais como o potÃ¡ssio, magnÃ©sio, ferro e fÃ³sforo. Um tomate de 100g possui entre 18-23 calorias e aproximadamente 93-95% de Ã¡gua.' },{ name: 'Abacaxi', img: 'assets/abacaxi-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'BrÃ³colis', img: 'assets/brocolis-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Couve', img: 'assets/couve-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Laranja', img: 'assets/laranja-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'MaÃ§Ã£', img: 'assets/maca-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Pimenta', img: 'assets/pimenta-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Repolho', img: 'assets/repolho-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' }],
            pegadinha: [{ name: 'Presunto', img: 'assets/presunto-padrao.png', description: 'O peito de peru processado tem proteÃ­nas, mas possui muito sal e conservantes, que podem fazer mal se comer em excesso.', funFact: 'No passado, os fabricantes queriam uma carne fatiada rÃ¡pida e prÃ¡tica, que parecesse mais "gorda e suculenta", ou seja, o peito de peru processado Ã© um tipo de truque mÃ¡gico.', nutritionalInfo: 'O peito de peru processado Ã© rico em proteÃ­nas e tem baixa quantidade de gordura, mas Ã© alto em sÃ³dio e contÃ©m aditivos conservantes, estabilizantes e amido. O valor nutritivo depende da marca.' },{ name: 'Suco de Caixinha', img: 'assets/suco-de-caixinha-padrao.png', description: 'O suco de caixinha dÃ¡ energia rÃ¡pida, mas tem muito aÃ§Ãºcar e nem sempre muita fruta, ou seja, pode fazer mal aos dentes e ao corpo.', funFact: 'Apesar de parecer "sÃ³" fruta, a maioria dos sucos de caixinha contÃ©m Ã¡gua e aÃ§Ãºcar adicionados, entÃ£o nem sempre Ã© 100% fruta.', nutritionalInfo: 'Os sucos de caixinha variam nutricionalmente, mas sÃ£o ricos em calorias e aÃ§Ãºcares, com poucas fibras, podem conter aditivos como conservantes e aromatizantes. Sucos 100% integrais sem aÃ§Ãºcar Ã© a melhor opÃ§Ã£o.' },{ name: 'Iogurte', img: 'assets/yogurt-padrao.png', description: 'O iogurte com sabor ajuda os ossos e mÃºsculos, mas contÃ©m bastante aÃ§Ãºcar, podendo prejudicar os dentes e aumentar os riscos de doenÃ§as.', funFact: 'Muitos dos corantes vermelhos usados em produtos como iogurte de morango podem ser feitos a partir de um inseto chamado cochonilha.', nutritionalInfo: 'Variam bastante dependendo da marca e do tipo, mas contÃ©m calorias, proteÃ­nas, gorduras, aÃ§Ãºcares e cÃ¡lcio.' },{ name: 'Cupcake', img: 'assets/cupcake-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Pizza', img: 'assets/pizza-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Hamburguer', img: 'assets/hamburgue-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Coca-Cola', img: 'assets/cocacola-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Bolo', img: 'assets/bolo-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' }]
        },
        // --- ENGLISH (TraduÃ§Ã£o) ---
        'en': {
            carboidrato: [{ name: 'Rice', img: 'assets/arroz-padrao.png', description: 'Brown rice is a grain that retains its husk and bran. It provides energy and aids digestion due to having more fiber.', funFact: 'When rice is cooking, it makes a little crackling noise, as if it\'s letting you know it\'s almost ready.', nutritionalInfo: 'Brown rice is a good source of fiber, contains B-complex vitamins, and minerals like magnesium, phosphorus, and iron. The fiber contributes to satiety, and the vitamins and minerals are essential for various body functions.' },{ name: 'Pasta', img: 'assets/macarrao-padrao.png', description: 'Whole wheat pasta provides vitamins, minerals, and fiber for our body, helping with digestion, controlling blood sugar levels, and providing energy.', funFact: 'Some archaeologists found traces of pasta nearly 4,000 years old in China.', nutritionalInfo: 'Whole wheat pasta is a rich source of fiber, vitamins, and minerals. Every 100g of whole wheat pasta has 124 calories, aids in satiety, and helps intestinal function.' },{ name: 'Banana', img: 'assets/banana-padrao-tea.png', description: 'Bananas contribute to heart health, improve intestinal function, increase energy, strengthen muscles, and help with mood.', funFact: 'Banana plants are not trees, they are "giant herbs," which can grow over 7 meters tall.', nutritionalInfo: 'The banana is a source of minerals like potassium and magnesium, vitamins B6 and C, and carbohydrates. It has 26g of carbohydrates, 98 calories, 2g of fiber, and 1.3g of protein.' },],
            proteina: [{ name: 'Meat', img: 'assets/carne-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Chicken', img: 'assets/frango-padrao.png', description: 'Chicken helps build muscles and gives the body energy.', funFact: 'Athletes like to include a lot of chicken in their meals because it helps build muscle and provides plenty of energy, especially grilled and cooked chicken.', nutritionalInfo: 'Chicken is generally a source rich in high-quality proteins and low in fat, with B-complex vitamins and minerals like selenium and phosphorus, without carbohydrates and fiber.' },{ name: 'Egg', img: 'assets/ovo-padrao-tea.png', description: 'The chicken egg helps the body grow and stay healthy, and it also contains important vitamins and minerals for bones, muscles, and the brain.', funFact: 'If you spin a raw egg and a cooked egg, the cooked one spins steadily, but the raw one wobbles and stumbles inside.', nutritionalInfo: 'The egg is a complete nutrient source, with low cost and culinary versatility. It is important to consume it carefully to avoid contamination. It has vitamins A, D, E, B2, B12, folate, and essential minerals like phosphorus, iron, and selenium.' },{ name: 'Salmon', img: 'assets/salmao-padrao.png', description: 'Grilled salmon supports bone health and mental well-being due to its vitamins and minerals, and muscle growth due to its proteins.', funFact: 'The orange color of salmon is not natural; it is just a result of the fish\'s diet of eating algae and crustaceans.', nutritionalInfo: 'Grilled salmon without salt or oil can contain 243 calories and 26g of protein. It is a rich source of vitamins like D and B12, and the mineral selenium.' },{ name: 'Fish', img: 'assets/peixe-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' }],
            vitamina: [{ name: 'Carrot', img: 'assets/cenoura-padrao.png', description: 'Carrots help maintain healthy vision, help the intestines work well, and give the body energy.', funFact: 'If you put cut carrots in sparkling water, they will rise and fall as if they are doing a choreography.', nutritionalInfo: 'The carrot is a vegetable rich in vitamin A, which contributes to vision health and has a detoxifying action. It contains vitamins and minerals like potassium, and the fibers help with intestinal function.' },{ name: 'Beans', img: 'assets/feijao-padrao.png', description: 'Beans are a legume rich in protein and fiber, which helps keep muscles strong and the intestines working well.', funFact: 'The tallest bean plant reached over 14 meters in height, which is more than three giraffes stacked on top of each other.', nutritionalInfo: 'Beans are a nutrient-rich food, providing plant-based proteins, complex carbohydrates, fiber, and B-complex vitamins, as well as minerals like iron, phosphorus, and potassium. The preparation method influences the exact nutritional value.' },{ name: 'Tomato', img: 'assets/tomate-padrao.png', description: 'Tomatoes support heart and intestinal health, strengthening bones, protecting the skin, and boosting immunity.', funFact: 'The word tomato comes from "tomati," which means "plump thing with a navel," a name given by the Aztecs.', nutritionalInfo: 'The tomato is rich in water, fiber, vitamins C and A, and minerals like potassium, magnesium, iron, and phosphorus. A 100g tomato has between 18-23 calories and is approximately 93-95% water.' },{ name: 'Pineapple', img: 'assets/abacaxi-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Broccoli', img: 'assets/brocolis-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Kale', img: 'assets/couve-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Orange', img: 'assets/laranja-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Apple', img: 'assets/maca-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Pepper', img: 'assets/pimenta-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Cabbage', img: 'assets/repolho-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' }],
            pegadinha: [{ name: 'Ham', img: 'assets/presunto-padrao.png', description: 'Processed turkey breast has protein, but it has a lot of salt and preservatives, which can be harmful if eaten in excess.', funFact: 'In the past, manufacturers wanted a quick and practical sliced meat that seemed "fatter and juicier," meaning processed turkey breast is a kind of magic trick.', nutritionalInfo: 'Processed turkey breast is rich in protein and low in fat, but high in sodium and contains additives like preservatives, stabilizers, and starch. The nutritional value depends on the brand.' },{ name: 'Juice Box', img: 'assets/suco-de-caixinha-padrao.png', description: 'Juice boxes provide quick energy, but they have a lot of sugar and not always a lot of fruit, meaning they can be bad for your teeth and body.', funFact: 'Although it may seem like "just" fruit, most juice boxes contain added water and sugar, so it\'s not always 100% fruit.', nutritionalInfo: 'Juice boxes vary nutritionally, but are high in calories and sugars, with little fiber. They may contain additives like preservatives and flavorings. 100% whole juices without sugar are the best option.' },{ name: 'Yogurt', img: 'assets/yogurt-padrao.png', description: 'Flavored yogurt helps bones and muscles, but contains a lot of sugar, which can harm teeth and increase the risk of diseases.', funFact: 'Many of the red dyes used in products like strawberry yogurt can be made from an insect called cochineal.', nutritionalInfo: 'They vary greatly depending on the brand and type, but contain calories, protein, fat, sugar, and calcium.' },{ name: 'Cupcake', img: 'assets/cupcake-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Pizza', img: 'assets/pizza-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Hamburger', img: 'assets/hamburgue-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Coca-Cola', img: 'assets/cocacola-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' },{ name: 'Cake', img: 'assets/bolo-padrao.png', description: 'Information not available.', funFact: 'Information not available.', nutritionalInfo: 'Information not available.' }]
        },
        // --- ESPAÃ‘OL (TraduÃ§Ã£o) ---
        'es': {
            carboidrato: [{ name: 'Arroz', img: 'assets/arroz-padrao.png', description: 'El arroz integral es un grano que conserva su cÃ¡scara y salvado. Proporciona energÃ­a y ayuda en la digestiÃ³n por tener mÃ¡s fibra.', funFact: 'Cuando el arroz se estÃ¡ cocinando, hace un pequeÃ±o ruido de crujido, como si avisara que ya estÃ¡ casi listo.', nutritionalInfo: 'El arroz integral es una buena fuente de fibra, contiene vitaminas del complejo B y minerales como magnesio, fÃ³sforo y hierro. La fibra contribuye a la saciedad, y las vitaminas y minerales son esenciales para diversas funciones del cuerpo.' },{ name: 'Pasta', img: 'assets/macarrao-padrao.png', description: 'La pasta integral proporciona vitaminas, minerales y fibra a nuestro cuerpo, ayudando en la digestiÃ³n, controlando los niveles de azÃºcar en sangre y proporcionando energÃ­a.', funFact: 'Algunos arqueÃ³logos encontraron restos de pasta de casi 4.000 aÃ±os de antigÃ¼edad en China.', nutritionalInfo: 'La pasta integral es una fuente rica en fibra, vitaminas y minerales. Cada 100g de pasta integral tiene 124 calorÃ­as, ayuda a la saciedad y al funcionamiento del intestino.' },{ name: 'Banana', img: 'assets/banana-padrao-tea.png', description: 'La banana contribuye a la salud del corazÃ³n, mejora el funcionamiento intestinal, aumenta la energÃ­a, fortalece los mÃºsculos y ayuda con el estado de Ã¡nimo.', funFact: 'Las plantas de banana no son Ã¡rboles, son "hierbas gigantes", que pueden crecer mÃ¡s de 7 metros de altura.', nutritionalInfo: 'La banana es una fuente de minerales como potasio y magnesio, vitaminas B6 y C, e hidratos de carbono. Posee 26g de carbohidratos, 98 calorÃ­as, 2g de fibra y 1.3g de proteÃ­na.' },],
            proteina: [{ name: 'Carne', img: 'assets/carne-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Pollo', img: 'assets/frango-padrao.png', description: 'El pollo ayuda a construir mÃºsculos y da energÃ­a al cuerpo.', funFact: 'A los atletas les gusta incluir mucho pollo en sus platos, ya que ayuda a construir mÃºsculo y a dar mucha energÃ­a, especialmente el pollo a la parrilla y cocido.', nutritionalInfo: 'El pollo generalmente es una fuente rica en proteÃ­nas de alta calidad y baja en grasas, con vitaminas del complejo B y minerales como selenio y fÃ³sforo, sin carbohidratos ni fibra.' },{ name: 'Huevo', img: 'assets/ovo-padrao-tea.png', description: 'El huevo de gallina ayuda al cuerpo a crecer y mantenerse saludable, ademÃ¡s, contiene vitaminas y minerales importantes para los huesos, mÃºsculos y cerebro.', funFact: 'Si giras un huevo crudo y uno cocido, el cocido gira firmemente, pero el crudo se tambalea y tropieza por dentro.', nutritionalInfo: 'El huevo es una fuente completa de nutrientes, de bajo costo y versatilidad culinaria. Es importante consumirlo con cuidado para evitar la contaminaciÃ³n. Posee vitaminas A, D, E, B2, B12, folato y minerales esenciales como fÃ³sforo, hierro y selenio.' },{ name: 'SalmÃ³n', img: 'assets/salmao-padrao.png', description: 'El salmÃ³n a la parrilla ayuda a la salud Ã³sea y al bienestar mental gracias a sus vitaminas y minerales, y al crecimiento muscular debido a las proteÃ­nas presentes.', funFact: 'El color naranja del salmÃ³n no es natural; es solo el resultado de la alimentaciÃ³n del pez al comer algas y crustÃ¡ceos.', nutritionalInfo: 'El salmÃ³n a la parrilla sin sal ni aceite puede contener 243 calorÃ­as y 26g de proteÃ­na. Es una fuente rica en vitaminas como la D y B12, y el mineral selenio.' },{ name: 'Pescado', img: 'assets/peixe-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' }],
            vitamina: [{ name: 'Zanahoria', img: 'assets/cenoura-padrao.png', description: 'La zanahoria ayuda a mantener una visiÃ³n saludable, ayuda a que los intestinos funcionen bien y da energÃ­a al cuerpo.', funFact: 'Si pones zanahorias cortadas en agua con gas, subirÃ¡n y bajarÃ¡n como si estuvieran haciendo una coreografÃ­a.', nutritionalInfo: 'La zanahoria es un vegetal rico en vitamina A, que contribuye a la salud de la visiÃ³n y tiene una acciÃ³n desintoxicante. Contiene vitaminas y minerales como el potasio, y las fibras ayudan al funcionamiento del intestino.' },{ name: 'Frijoles', img: 'assets/feijao-padrao.png', description: 'Los frijoles son una legumbre rica en proteÃ­na y fibra, que ayuda a mantener los mÃºsculos fuertes y el intestino funcionando bien.', funFact: 'La planta de frijol mÃ¡s alta alcanzÃ³ mÃ¡s de 14 metros de altura, lo que es mÃ¡s que tres jirafas apiladas.', nutritionalInfo: 'Los frijoles son un alimento rico en nutrientes, que proporciona proteÃ­nas vegetales, carbohidratos complejos, fibra y vitaminas del complejo B, y minerales como hierro, fÃ³sforo y potasio. La forma de preparar los frijoles influye en el valor nutricional exacto.' },{ name: 'Tomate', img: 'assets/tomate-padrao.png', description: 'El tomate ayuda a la salud del corazÃ³n e intestinal, fortaleciendo los huesos, protegiendo la piel y siendo un aliado de la inmunidad.', funFact: 'La palabra tomate proviene de "tomati", que significa "cosa redonda con ombligo", nombre dado por los aztecas.', nutritionalInfo: 'El tomate es rico en agua, fibra, vitaminas C y A, y minerales como potasio, magnesio, hierro y fÃ³sforo. Un tomate de 100g tiene entre 18-23 calorÃ­as y aproximadamente 93-95% de agua.' },{ name: 'PiÃ±a', img: 'assets/abacaxi-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'BrÃ³coli', img: 'assets/brocolis-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Col Rizada', img: 'assets/couve-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Naranja', img: 'assets/laranja-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Manzana', img: 'assets/maca-padrao.png', description: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', funFact: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.', nutritionalInfo: 'InformaÃ§Ã£o nÃ£o disponÃ­vel.' },{ name: 'Pimiento', img: 'assets/pimenta-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Repollo', img: 'assets/repolho-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' }],
            pegadinha: [{ name: 'JamÃ³n', img: 'assets/presunto-padrao.png', description: 'La pechuga de pavo procesada tiene proteÃ­nas, pero tiene mucha sal y conservantes, que pueden ser perjudiciales si se comen en exceso.', funFact: 'En el pasado, los fabricantes querÃ­an una carne en lonchas rÃ¡pida y prÃ¡ctica, que pareciera mÃ¡s "grasa y jugosa", es decir, la pechuga de pavo procesada es una especie de truco de magia.', nutritionalInfo: 'La pechuga de pavo procesada es rica en proteÃ­nas y baja en grasas, pero alta en sodio y contiene aditivos como conservantes, estabilizadores y almidÃ³n. El valor nutricional depende de la marca.' },{ name: 'Jugo en Caja', img: 'assets/suco-de-caixinha-padrao.png', description: 'El jugo en caja da energÃ­a rÃ¡pida, pero tiene mucho azÃºcar y no siempre mucha fruta, es decir, puede ser malo para los dientes y el cuerpo.', funFact: 'Aunque parezca "solo" fruta, la mayorÃ­a de los jugos en caja contienen agua y azÃºcar aÃ±adidos, por lo que no siempre es 100% fruta.', nutritionalInfo: 'Los jugos en caja varÃ­an nutricionalmente, pero son altos en calorÃ­as y azÃºcares, con poca fibra. Pueden contener aditivos como conservantes y saborizantes. Los jugos 100% integrales sin azÃºcar son la mejor opciÃ³n.' },{ name: 'Yogur', img: 'assets/yogurt-padrao.png', description: 'El yogur de sabores ayuda a los huesos y mÃºsculos, pero contiene bastante azÃºcar, lo que puede daÃ±ar los dientes y aumentar el riesgo de enfermedades.', funFact: 'Muchos de los colorantes rojos usados en productos como el yogur de fresa pueden estar hechos de un insecto llamado cochinilla.', nutritionalInfo: 'VarÃ­an mucho segÃºn la marca y el tipo, pero contienen calorÃ­as, proteÃ­nas, grasas, azÃºcares y calcio.' },{ name: 'Cupcake', img: 'assets/cupcake-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Pizza', img: 'assets/pizza-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Hamburguesa', img: 'assets/hamburgue-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Coca-Cola', img: 'assets/cocacola-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' },{ name: 'Pastel', img: 'assets/bolo-padrao.png', description: 'InformaciÃ³n no disponible.', funFact: 'InformaciÃ³n no disponible.', nutritionalInfo: 'InformaciÃ³n no disponible.' }]
        }
    };

    // --- MUDANÃ‡A PRINCIPAL: Seleciona o objeto de alimentos com base no idioma carregado ---
    // O resto do script usarÃ¡ esta variÃ¡vel 'FOODS'
    const FOODS = ALL_FOODS_DATA[currentLang] || ALL_FOODS_DATA['pt'];
    // --- FIM DA MUDANÃ‡A ---


    // --- NOVO: Nomes dos grupos de alimentos traduzidos ---
    const FOOD_GROUP_NAMES = { 
        carboidrato: translations.almanaque_titulo_carb, 
        proteina: translations.almanaque_titulo_prot, 
        vitamina: translations.almanaque_titulo_vit, 
        pegadinha: translations.almanaque_titulo_pega
    };
    
    // --- NOVO: TÃ­tulos das etapas traduzidos ---
    const STAGES = [
        { stage: 1, goal: 3, orderSize: 3, foodTypes: ['carboidrato'], possibleOrderTypes: ['carboidrato'], title: translations.stage1_title },
        { stage: 2, goal: 5, orderSize: 3, foodTypes: ['carboidrato', 'proteina'], possibleOrderTypes: ['carboidrato', 'proteina'], title: translations.stage2_title },
        { stage: 3, goal: 7, orderSize: 3, foodTypes: ['carboidrato', 'proteina', 'vitamina'], possibleOrderTypes: ['carboidrato', 'proteina', 'vitamina'], title: translations.stage3_title },
        { stage: 4, goal: 10, orderSize: 3, foodTypes: ['carboidrato', 'proteina', 'vitamina', 'pegadinha'], possibleOrderTypes: ['carboidrato', 'proteina', 'vitamina'], title: translations.stage4_title }
    ];

    let timer, score, currentStageIndex, stageOrders, timerInterval, foodSpawnInterval, gameLoopInterval, macawTimeout, otherDialogueTimeout;
    let isPaused = false;
    let currentOrder = [];
    let plateContents = [null, null, null];
    let sounds = {};
    let audioInitialized = false;
    let lastUsedFoods = [];
    let isShowingIntro = false;
    let introStep = 0;

    let allBookFoods = [];
    let pages = [];
    let currentPage = 1;
    const ITEMS_PER_SECTION = 3;
    const SECTIONS_PER_PAGE = 6;
    const ITEMS_PER_PAGE = ITEMS_PER_SECTION * SECTIONS_PER_PAGE;

    let pausedBeforeModal = false;
    let modalPauseCount = 0;

    // --- NOVO: VariÃ¡veis para Drag & Drop por Toque ---
    let draggedItem = null;      // Armazena o item sendo arrastado pelo toque
    let currentDropTarget = null; // Armazena a cesta (slot) que estÃ¡ sob o dedo
    let touchOffsetX = 0;        // Offset X do toque dentro do item
    let touchOffsetY = 0;        // Offset Y do toque dentro do item
    let esteiraRect = null;      // Cache da posiÃ§Ã£o da esteira para performance
    // --- FIM: VariÃ¡veis de Toque ---

    function pushModalPause() {
        if (modalPauseCount === 0) {
            pausedBeforeModal = isPaused;
            isPaused = true;
        }
        modalPauseCount++;
    }

    function popModalPause() {
        if (modalPauseCount > 0) modalPauseCount--;
        if (modalPauseCount === 0) {
            isPaused = pausedBeforeModal;
            pausedBeforeModal = false;
        } else {
            isPaused = true;
        }
    }

    // --- SEÃ‡ÃƒO DE ÃUDIO ---
    function initAudio() {
        if (audioInitialized) return;
        const soundFiles = {
            'acerto': 'assets/acerto.mp3',
            'alerta-cronometro': 'assets/alerta-do-cronometro.mp3',
            'avaliacao-final': 'assets/avaliacao-final.mp3',
            'bonus-tempo': 'assets/bonus-de-tempo.mp3',
            'clique-ui': 'assets/clique-ui.mp3',
            'erro': 'assets/erro.mp3',
            'musica-fundo': 'assets/musica-dinamica-fundo.mp3',
            'pegar-soltar': 'assets/pegar-soltar-item.mp3'
        };
        for (const key in soundFiles) {
            sounds[key] = new Audio(soundFiles[key]);
        }
        sounds['musica-fundo'].loop = true;
        audioInitialized = true;
    }

    function playSound(name) {
        if (!audioInitialized || !sounds[name]) return;
        
        // --- NOVO: Verifica Ã¡udio nas configuraÃ§Ãµes ---
        const settingsString = localStorage.getItem('safequest-settings');
        let canPlay = true;
        if (settingsString) {
            try {
                const settings = JSON.parse(settingsString);
                if (name === 'musica-fundo' && !settings.music) canPlay = false;
                if (name !== 'musica-fundo' && !settings.sfx) canPlay = false;
            } catch (e) { /* ignora erro */ }
        }
        if (!canPlay) return;
        // --- FIM DA VERIFICAÃ‡ÃƒO ---

        const sound = sounds[name];
        if (name !== 'musica-fundo') {
            sound.currentTime = 0;
        }
        sound.play().catch(error => console.error(`Erro ao tocar o som '${name}':`, error));
    }

    function stopSound(name) {
        if (!audioInitialized || !sounds[name]) return;
        const sound = sounds[name];
        sound.pause();
        sound.currentTime = 0;
    }

    function fadeIn(name, targetVolume = 0.3, duration = 1500) {
        if (!audioInitialized || !sounds[name]) return;

        // --- NOVO: Verifica Ã¡udio nas configuraÃ§Ãµes ---
        const settingsString = localStorage.getItem('safequest-settings');
        if (settingsString) {
            try {
                const settings = JSON.parse(settingsString);
                if (name === 'musica-fundo' && !settings.music) return; // NÃ£o toca
            } catch (e) { /* ignora erro */ }
        }
        // --- FIM DA VERIFICAÃ‡ÃƒO ---

        const sound = sounds[name];
        const intervalTime = 50;
        const fadeSteps = duration / intervalTime;
        const volumeIncrement = targetVolume / fadeSteps;
        sound.volume = 0;
        sound.play().catch(error => console.error(`Erro ao iniciar o som para fade-in:`, error));
        const fadeInterval = setInterval(() => {
            if (sound.volume < targetVolume) {
                sound.volume = Math.min(targetVolume, sound.volume + volumeIncrement);
            } else {
                clearInterval(fadeInterval);
            }
        }, intervalTime);
    }

    function fadeOut(name, duration = 1000) {
        if (!audioInitialized || !sounds[name]) return;
        const sound = sounds[name];
        const intervalTime = 50;
        const fadeSteps = duration / intervalTime;
        const startVolume = sound.volume;
        const volumeDecrement = startVolume / fadeSteps;
        const fadeInterval = setInterval(() => {
            if (sound.volume > 0) {
                sound.volume = Math.max(0, sound.volume - volumeDecrement);
            } else {
                clearInterval(fadeInterval);
                sound.pause();
                sound.currentTime = 0;
                sound.volume = startVolume;
            }
        }, intervalTime);
    }
    // --- FIM DA SEÃ‡ÃƒO DE ÃUDIO ---

    function init() {
        startButton.addEventListener('click', () => {
            initAudio();
            startIntroduction();
        });
        restartButton.addEventListener('click', () => {
        playSound('clique-ui');
        stopSound('avaliacao-final');
        stopSound('alerta-cronometro');
        stopSound('musica-fundo');
        startGame();
        });
        nextStageButton.addEventListener('click', () => {
            playSound('clique-ui');
            handleNextButtonClick();
        });
        verifyButton.addEventListener('click', () => {
            playSound('clique-ui');
            verifyOrder();
        });
        plateSlots.forEach(slot => {
            slot.addEventListener('dragover', handleDragOver);
            slot.addEventListener('dragleave', handleDragLeave);
            slot.addEventListener('drop', handleDrop);
            slot.addEventListener('click', handlePotClick);
        });

        // --- NOVO: Listeners de Toque Globais ---
        // Adiciona os listeners ao gameContainer para capturar o movimento em qualquer lugar
        gameContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
        gameContainer.addEventListener('touchend', handleTouchEnd);
        gameContainer.addEventListener('touchcancel', handleTouchEnd); // Cancela o toque se algo interromper
        // --- FIM: Listeners de Toque ---

        const portraitMediaQuery = window.matchMedia("(orientation: portrait)");
        function handleOrientationChange(e) {
            const orientationWarning = document.getElementById('orientation-warning');
            if (e.matches) {
                // Se estÃ¡ em modo retrato, pausa o jogo e MOSTRA o aviso
                orientationWarning.classList.remove('hidden');
                orientationWarning.classList.add('flex');
                isPaused = true;
            } else {
                // Se estÃ¡ em modo paisagem, ESCONDE o aviso e despausa (se nÃ£o houver outra pausa)
                orientationWarning.classList.add('hidden');
                orientationWarning.classList.remove('flex');

                const isAnyModalOpen = bookModal.classList.contains('flex') ||
                                        stageTransitionScreen.classList.contains('flex') ||
                                        endScreen.classList.contains('flex') ||
                                        startScreen.classList.contains('flex');
                if (!isShowingIntro && !isAnyModalOpen && modalPauseCount === 0) {
                    isPaused = false;
                }
            }
        }
        portraitMediaQuery.addEventListener('change', handleOrientationChange);
        handleOrientationChange(portraitMediaQuery); // Checa a orientaÃ§Ã£o inicial
        const resizeObserver = new ResizeObserver(handleResize);
        resizeObserver.observe(gameContainer);
        prepareBookContent();
        calculatePages();
        bookButton.addEventListener('click', () => {
            playSound('clique-ui');
            openBook();
        });
        bookModalClose.addEventListener('click', () => {
            playSound('clique-ui');
            closeBook();
        });
        foodDetailClose.addEventListener('click', () => {
            playSound('clique-ui');
            closeFoodDetails();
        });
        prevPageBtn.addEventListener('click', () => {
            playSound('clique-ui');
            changePage(-1);
        });
        nextPageBtn.addEventListener('click', () => {
            playSound('clique-ui');
            changePage(1);
        });
    }

    // --- FUNÃ‡Ã•ES DO LIVRO E MODAIS ---
    function prepareBookContent() {
    allBookFoods = [];
    const categoryOrder = ['carboidrato', 'proteina', 'vitamina', 'pegadinha'];
    categoryOrder.forEach(categoryKey => {
        // A variÃ¡vel 'FOODS' jÃ¡ estÃ¡ no idioma correto
        if (FOODS[categoryKey]) {
            FOODS[categoryKey].forEach(food => {
                allBookFoods.push({ ...food, category: categoryKey });
            });
        }
    });
}

    function calculatePages() {
        pages = [];
        for (let i = 0; i < allBookFoods.length; i += ITEMS_PER_PAGE) {
            pages.push(allBookFoods.slice(i, i + ITEMS_PER_PAGE));
        }
    }

    function renderPage(pageNumber) {
    currentPage = pageNumber;
    const pageData = pages[currentPage - 1] || [];
    pageSections.forEach(section => section.innerHTML = '');

    for (let s = 0; s < pageSections.length; s++) {
        const sectionEl = pageSections[s];
        const chunkStart = s * ITEMS_PER_SECTION;
        const chunk = pageData.slice(chunkStart, chunkStart + ITEMS_PER_SECTION);

        if (chunk.length === 0) continue;

        const inner = document.createElement('div');
        inner.className = 'section-inner';

        const categoryKey = chunk[0].category;
        const titleEl = document.createElement('div');
        titleEl.className = 'category-title';
        // --- NOVO: Usa o nome traduzido do grupo ---
        titleEl.textContent = FOOD_GROUP_NAMES[categoryKey] || '';
        inner.appendChild(titleEl);

        const itemsContainer = document.createElement('div');
        itemsContainer.className = 'food-items-container';

        chunk.forEach(food => {
            const itemEl = document.createElement('div');
            itemEl.className = 'book-food-item';
            itemEl.onclick = () => {
                playSound('clique-ui');
                showFoodDetails(food);
            };
            const img = document.createElement('img');
            img.src = food.img;
            img.alt = food.name;
            const name = document.createElement('p');
            name.textContent = food.name;
            itemEl.appendChild(img);
            itemEl.appendChild(name);
            itemsContainer.appendChild(itemEl);
        });

        inner.appendChild(itemsContainer);
        sectionEl.appendChild(inner);
    }

    updateNavigation();
}

    function updateNavigation() {
        // --- NOVO: Texto do indicador de pÃ¡gina traduzido ---
        pageIndicator.textContent = `${translations.pagina_indicador} ${currentPage} ${translations.de_indicador} ${pages.length}`;
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === pages.length;
    }

    function changePage(direction) {
        const newPage = currentPage + direction;
        if (newPage > 0 && newPage <= pages.length) {
            bookPagesContainer.classList.add('fade-out');
            setTimeout(() => {
                renderPage(newPage);
                bookPagesContainer.classList.remove('fade-out');
            }, 300);
        }
    }

    function openBook() {
    pushModalPause();
    renderPage(1);
    bookModal.classList.remove('hidden');
    bookModal.classList.add('flex');
}

    function closeBook() {
    bookModal.classList.add('hidden');
    bookModal.classList.remove('flex');
    popModalPause();
}

    function showFoodDetails(food) {
        foodDetailName.textContent = food.name;
        foodDetailImg.src = food.img;
        foodDetailImg.alt = food.name;
        foodDetailDesc.textContent = food.description;
        foodDetailFunFact.textContent = food.funFact;
        foodDetailNutri.textContent = food.nutritionalInfo;
        foodDetailModal.classList.remove('hidden');
        foodDetailModal.classList.add('flex');
        pushModalPause();
    }

    function closeFoodDetails() {
        foodDetailModal.classList.add('hidden');
        foodDetailModal.classList.remove('flex');
        popModalPause();
    }
    // --- FIM FUNÃ‡Ã•ES DO LIVRO E MODAIS ---

    // --- FUNÃ‡Ã•ES DE INTRODUÃ‡ÃƒO E TRANSIÃ‡ÃƒO ---
    function startIntroduction() {
        playSound('clique-ui');
        startScreen.classList.add('hidden');
        isShowingIntro = true;
        introStep = 0;
        showNextIntroDialogue();
    }

    function showNextIntroDialogue() {
        if (introStep < introDialogues.length) {
            const dialogue = introDialogues[introStep];
            stageMacawSprite.src = MACAW_SPRITES.falando;
            document.getElementById('stage-title').textContent = dialogue.title;
            document.getElementById('stage-explanation').textContent = dialogue.text;
            stageTransitionScreen.classList.remove('hidden');
            stageTransitionScreen.classList.add('flex');
            isPaused = true;
            introStep++;
        } else {
            isShowingIntro = false;
            stageTransitionScreen.classList.add('hidden');
            stageTransitionScreen.classList.remove('flex'); // Garante que saiu do flex
            isPaused = false;
            startGame();
        }
    }

    function handleNextButtonClick() {
        if (isShowingIntro) {
            showNextIntroDialogue();
        } else {
            resumeGame();
        }
    }
    // --- FIM FUNÃ‡Ã•ES DE INTRODUÃ‡ÃƒO E TRANSIÃ‡ÃƒO ---

    // --- AJUSTE DE REDIMENSIONAMENTO ---
    function handleResize() {
        if (isPaused || !gameLoopInterval || !esteiraContainer) return;
        const foodsOnBelt = esteiraContainer.querySelectorAll('.food-item');
        const container = esteiraContainer;
        const verticalCenterPx = container.clientWidth * (PATH_PERCENTAGES.SPAWN_X / 100);
        const wiggle = 20;
        foodsOnBelt.forEach(food => {
            const path = parseInt(food.dataset.path);
            if (path === PATH_STATE.MOVE_DOWN) {
                food.style.left = `${verticalCenterPx - (wiggle / 2) + (Math.random() * wiggle)}px`;
            }
        });
    }
    // --- FIM AJUSTE DE REDIMENSIONAMENTO ---

    // --- FUNÃ‡Ã•ES PRINCIPAIS DO JOGO ---
    function startGame() {
        endScreen.classList.add('hidden');
        endScreen.classList.remove('flex');
        startScreen.classList.add('hidden');
        startScreen.classList.remove('flex');
        gameHeader.classList.remove('hidden');
        gameMain.classList.remove('hidden');
        timer = INITIAL_TIME;
        score = 0;
        currentStageIndex = 0;
        isPaused = false;
        lastUsedFoods = [];
        updateScore(0);
        updateTimerDisplay();
        esteiraContainer.innerHTML = '';
        setupStage();
        startGameplayLoops();
        scheduleRandomDialogue();
        fadeIn('musica-fundo', 0.3, 1500);
    }

    function startGameplayLoops() {
        if (timerInterval) clearInterval(timerInterval);
        if (foodSpawnInterval) clearInterval(foodSpawnInterval);
        if (gameLoopInterval) clearInterval(gameLoopInterval);
        startTimer();
        startSpawningFood();
        startGameLoop();
    }

    function setupStage() {
        stageOrders = 0;
        stageDisplayEl.textContent = STAGES[currentStageIndex].stage;
        generateOrder();
    }

    function generateOrder() {
        const stage = STAGES[currentStageIndex];
        currentOrder = [];
        clearPlate();
        for (let i = 0; i < stage.orderSize; i++) {
            const type = stage.possibleOrderTypes[Math.floor(Math.random() * stage.possibleOrderTypes.length)];
            currentOrder.push(type);
            // --- NOVO: Usa o nome traduzido do grupo ---
            orderSlots[i].textContent = FOOD_GROUP_NAMES[type];
        }
    }

    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if (isPaused) return;
            timer--;
            updateTimerDisplay();
            if (timer <= 15 && timer > 0) {
                timerEl.classList.add('timer-warning');
                if (timer % 2 === 0) {
                    playSound('alerta-cronometro');
                }
            } else {
                timerEl.classList.remove('timer-warning');
            }
            if (timer <= 0) {
                timer = 0;
                updateTimerDisplay();
                endGame(false);
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timer / 60).toString().padStart(2, '0');
        const seconds = (timer % 60).toString().padStart(2, '0');
        timerEl.textContent = `${minutes}:${seconds}`;
    }

    function startSpawningFood() {
        if (foodSpawnInterval) clearInterval(foodSpawnInterval);
        if (!isPaused) spawnFood();
        foodSpawnInterval = setInterval(() => {
            if (isPaused) return;
            spawnFood();
        }, FOOD_SPAWN_INTERVAL);
    }

    function spawnFood() {
        const stage = STAGES[currentStageIndex];
        const randomType = stage.foodTypes[Math.floor(Math.random() * stage.foodTypes.length)];
        
        // A variÃ¡vel 'FOODS' jÃ¡ estÃ¡ no idioma correto
        if (!FOODS[randomType] || FOODS[randomType].length === 0) return; // Checagem de seguranÃ§a

        const foodData = FOODS[randomType][Math.floor(Math.random() * FOODS[randomType].length)];
        const container = esteiraContainer;
        if (!container) return;

        const foodEl = document.createElement('div');
        foodEl.id = `food-${Date.now()}-${Math.random()}`;
        foodEl.className = 'food-item';
        foodEl.style.backgroundImage = `url('${foodData.img}')`;
        foodEl.draggable = true;
        foodEl.dataset.type = randomType;
        foodEl.dataset.img = foodData.img;
        foodEl.dataset.name = foodData.name;

        // --- Eventos de MOUSE (PC) ---
        foodEl.addEventListener('dragstart', (e) => {
            if (isPaused) {
                e.preventDefault();
                return;
            }
            playSound('pegar-soltar');
            e.dataTransfer.setData('text/plain', foodEl.id);
            foodEl.dataset.dragging = 'true';
            setTimeout(() => foodEl.classList.add('opacity-50'), 0);
        });
        foodEl.addEventListener('dragend', () => {
             foodEl.classList.remove('opacity-50');
             delete foodEl.dataset.dragging;
        });

        // --- NOVO: Evento de TOQUE (Mobile) ---
        // { passive: false } Ã© crucial para permitir o e.preventDefault()
        foodEl.addEventListener('touchstart', handleTouchStart, { passive: false });
        // --- FIM: Evento de Toque ---

        foodEl.style.top = `${container.clientHeight * (PATH_PERCENTAGES.SPAWN_Y / 100)}px`;
        const wiggle = 20;
        const verticalCenterPx = container.clientWidth * (PATH_PERCENTAGES.SPAWN_X / 100);
        foodEl.style.left = `${verticalCenterPx - (wiggle / 2) + (Math.random() * wiggle)}px`;
        foodEl.dataset.path = PATH_STATE.MOVE_DOWN;

        foodEl.classList.add('food-spawn');
        foodEl.addEventListener('animationend', () => foodEl.classList.remove('food-spawn'), { once: true });

        container.appendChild(foodEl);
    }

    function startGameLoop() {
        if (gameLoopInterval) clearInterval(gameLoopInterval);
        gameLoopInterval = setInterval(() => {
            if (isPaused) return;
            moveFood();
        }, 1000 / 60);
    }

    function moveFood() {
        const foodsOnBelt = esteiraContainer.querySelectorAll('.food-item:not([data-dragging="true"])');
        const speed = (FOOD_SPEED / 60);
        const container = esteiraContainer;
        if (!container) return;

        const turn1Y_px = container.clientHeight * (PATH_PERCENTAGES.TURN_1_Y / 100);
        const turn2X_px = container.clientWidth * (PATH_PERCENTAGES.TURN_2_X / 100);
        const turn3Y_px = container.clientHeight * (PATH_PERCENTAGES.TURN_3_Y / 100);
        const turn4X_px = container.clientWidth * (PATH_PERCENTAGES.TURN_4_X / 100);
        const exitY_px = container.clientHeight * (PATH_PERCENTAGES.EXIT_Y / 100);

        foodsOnBelt.forEach(food => {
            if (food.classList.contains('food-exit')) return;
            let currentTop = parseFloat(food.style.top);
            let currentLeft = parseFloat(food.style.left);
            const path = parseInt(food.dataset.path);

            switch (path) {
                case PATH_STATE.MOVE_DOWN:
                    if (currentTop < turn1Y_px) { food.style.top = `${currentTop + speed}px`; }
                    else { food.style.top = `${turn1Y_px}px`; food.dataset.path = PATH_STATE.MOVE_RIGHT; }
                    break;
                case PATH_STATE.MOVE_RIGHT:
                    if (currentLeft < turn2X_px) { food.style.left = `${currentLeft + speed}px`; }
                    else { food.style.left = `${turn2X_px}px`; food.dataset.path = PATH_STATE.MOVE_UP; }
                    break;
                case PATH_STATE.MOVE_UP:
                    if (currentTop > turn3Y_px) { food.style.top = `${currentTop - speed}px`; }
                    else { food.style.top = `${turn3Y_px}px`; food.dataset.path = PATH_STATE.MOVE_LEFT; }
                    break;
                case PATH_STATE.MOVE_LEFT:
                    if (currentLeft > turn4X_px) { food.style.left = `${currentLeft - speed}px`; }
                    else { food.style.left = `${turn4X_px}px`; food.dataset.path = PATH_STATE.MOVE_UP_EXIT; }
                    break;
                case PATH_STATE.MOVE_UP_EXIT:
                    if (currentTop > exitY_px) { food.style.top = `${currentTop - speed}px`; }
                    else {
                        food.classList.add('food-exit');
                        food.addEventListener('animationend', () => food.remove(), { once: true });
                    }
                    break;
            }
        });
    }
    // --- FIM FUNÃ‡Ã•ES PRINCIPAIS DO JOGO ---

    // --- FUNÃ‡Ã•ES DE INTERAÃ‡ÃƒO (DRAG & DROP, VERIFICAÃ‡ÃƒO) ---

    // --- NOVO: Handlers de Toque ---

    function handleTouchStart(e) {
        // Ignora se nÃ£o for um Ãºnico toque ou se o jogo estiver pausado
        if (e.touches.length !== 1 || isPaused) return;

        e.preventDefault(); // Previne scroll e "clique fantasma"
        
        draggedItem = e.currentTarget; // O .food-item
        esteiraRect = esteiraContainer.getBoundingClientRect(); // Pega a posiÃ§Ã£o da esteira
        const touch = e.touches[0];

        // Calcula o offset do toque *dentro* do item
        const itemRect = draggedItem.getBoundingClientRect();
        touchOffsetX = touch.clientX - itemRect.left;
        touchOffsetY = touch.clientY - itemRect.top;

        // Marca como "arrastando" para pausar o movimento da esteira
        draggedItem.dataset.dragging = 'true';
        playSound('pegar-soltar');
        
        // Estilos de "pegar"
        draggedItem.style.zIndex = 1000; // PÃµe sobre tudo
        draggedItem.classList.add('opacity-50');
        draggedItem.style.transform = 'scale(1.1)'; // Aumenta um pouco
        
        // Move o item para a posiÃ§Ã£o inicial do dedo (jÃ¡ aplicando o offset)
        // Converte coordenada do viewport (touch.clientX) para coordenada da esteira (style.left)
        let x = touch.clientX - esteiraRect.left - touchOffsetX;
        let y = touch.clientY - esteiraRect.top - touchOffsetY;
        
        draggedItem.style.left = `${x}px`;
        draggedItem.style.top = `${y}px`;
    }

    function handleTouchMove(e) {
        if (!draggedItem || isPaused) return;

        e.preventDefault(); // Previne scroll
        
        const touch = e.touches[0];
        
        // Move o item
        // Usa o esteiraRect cacheado para melhor performance
        let x = touch.clientX - esteiraRect.left - touchOffsetX;
        let y = touch.clientY - esteiraRect.top - touchOffsetY;
        
        draggedItem.style.left = `${x}px`;
        draggedItem.style.top = `${y}px`;

        // Simula dragover/dragleave checando a posiÃ§Ã£o
        let foundTarget = null;
        // Itera sobre as cestas para ver se o toque estÃ¡ em cima de alguma
        for (const slot of plateSlots) {
            const slotRect = slot.getBoundingClientRect();
            if (
                touch.clientX >= slotRect.left &&
                touch.clientX <= slotRect.right &&
                touch.clientY >= slotRect.top &&
                touch.clientY <= slotRect.bottom
            ) {
                foundTarget = slot;
                break; // Encontrou um
            }
        }

        // Atualiza o highlight (classe 'drag-over')
        if (foundTarget !== currentDropTarget) {
            if (currentDropTarget) {
                currentDropTarget.classList.remove('drag-over');
            }
            if (foundTarget) {
                foundTarget.classList.add('drag-over');
            }
            currentDropTarget = foundTarget; // Atualiza o alvo atual
        }
    }

    function handleTouchEnd(e) {
        if (!draggedItem) return;
        
        let dropped = false;
        // 'currentDropTarget' foi definido no Ãºltimo 'touchmove'
        if (currentDropTarget) {
            // Tenta colocar no slot
            dropped = placeItemInSlot(draggedItem, currentDropTarget);
            currentDropTarget.classList.remove('drag-over'); // Limpa o highlight
        }

        // Se nÃ£o foi solto com sucesso (ou nÃ£o tinha dropTarget)
        if (!dropped) {
            // Item "volta" para a esteira (apenas removemos os estilos de drag)
            delete draggedItem.dataset.dragging;
        }
        
        // Limpa estilos de drag/touch
        draggedItem.classList.remove('opacity-50');
        draggedItem.style.zIndex = 15; // Z-index normal
        draggedItem.style.transform = 'scale(1)'; // Tamanho normal
        
        // Reseta variÃ¡veis globais de toque
        draggedItem = null;
        currentDropTarget = null;
        esteiraRect = null;
    }

    // --- FIM: Handlers de Toque ---

    function handleDragOver(e) {
        e.preventDefault();
        e.currentTarget.classList.add('drag-over');
    }

    function handleDragLeave(e) {
        e.currentTarget.classList.remove('drag-over');
    }

    // --- NOVO: FunÃ§Ã£o reutilizÃ¡vel para colocar item ---
    /**
    * Tenta colocar um foodEl (de mouse ou toque) em um slotEl (cesta).
    * Retorna true se foi sucesso, false se o slot estava ocupado.
    */
    function placeItemInSlot(foodEl, slotEl) {
        const slotIndex = parseInt(slotEl.dataset.slotIndex);
        
        // Permite soltar apenas se o slot estiver vazio
        if (plateContents[slotIndex] === null) {
            plateContents[slotIndex] = { 
                type: foodEl.dataset.type, 
                img: foodEl.dataset.img, 
                name: foodEl.dataset.name 
            };
            
            const imgInPlate = document.createElement('img');
            imgInPlate.src = foodEl.dataset.img;
            slotEl.innerHTML = ''; // Limpa antes de adicionar
            slotEl.appendChild(imgInPlate);
            
            foodEl.remove(); // Remove o item da esteira
            
            playSound('pegar-soltar');
            checkPlateFullness();
            return true; // Sucesso
        } else {
            return false; // Falha (slot ocupado)
        }
    }
    // --- FIM: FunÃ§Ã£o reutilizÃ¡vel ---

    // --- ATUALIZADO: handleDrop agora usa a nova funÃ§Ã£o ---
    function handleDrop(e) {
        e.preventDefault();
        const slotEl = e.currentTarget;
        slotEl.classList.remove('drag-over');
        
        const foodId = e.dataTransfer.getData('text/plain');
        const foodEl = document.getElementById(foodId);
        if (!foodEl) return;

        const success = placeItemInSlot(foodEl, slotEl);
        
        // Se nÃ£o teve sucesso (slot ocupado), o dragend listener
        // jÃ¡ vai lidar com a remoÃ§Ã£o do 'dataset.dragging'
        if (!success) {
            delete foodEl.dataset.dragging;
        }
    }

    function handlePotClick(e) {
        const slotEl = e.currentTarget;
        const slotIndex = parseInt(slotEl.dataset.slotIndex);
        if (plateContents[slotIndex] !== null) {
            plateContents[slotIndex] = null;
            slotEl.innerHTML = '';
            playSound('pegar-soltar');
            checkPlateFullness();
        }
    }

    function checkPlateFullness() {
        const isFull = plateContents.every(item => item !== null);
        verifyButton.disabled = !isFull;
        if (isFull) {
            verifyButton.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            verifyButton.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    function verifyOrder() {
        if (!plateContents.every(item => item !== null)) return;
        const currentPlateTypes = plateContents.map(p => p.type).sort();
        const currentOrderTypes = [...currentOrder].sort();
        let isCorrect = JSON.stringify(currentPlateTypes) === JSON.stringify(currentOrderTypes);

        verifyButton.disabled = true;
        verifyButton.classList.add('opacity-50', 'cursor-not-allowed');

        if (isCorrect) {
            handleCorrectOrder();
        } else {
            handleWrongOrder();
            // Re-habilita o botÃ£o apÃ³s um delay se estiver errado,
            // permitindo que o usuÃ¡rio veja o feedback antes de tentar de novo.
            setTimeout(() => {
                if (!isPaused) checkPlateFullness();
            }, 600);
        }
    }

    function handleCorrectOrder() {
        playSound('acerto');
        playSound('bonus-tempo');
        plateSlots.forEach(slot => {
            slot.classList.add('correct-plate');
            setTimeout(() => { slot.innerHTML = ''; }, 500);
        });
        setTimeout(() => plateSlots.forEach(slot => slot.classList.remove('correct-plate')), 700);

        updateScore(score + 1);
        stageOrders++;
        timer += TIME_BONUS;
        updateTimerDisplay();
        showMacawMessage(getRandomDialogue('praise'), 4000, 'feliz');

        plateContents.forEach(food => lastUsedFoods.push(food.name));
        if (lastUsedFoods.length > 9) lastUsedFoods.shift();
        const lastFoodName = plateContents[plateContents.length-1].name;
        if (lastUsedFoods.filter(foodName => foodName === lastFoodName).length >= 3) {
            setTimeout(() => showMacawMessage(getRandomDialogue('variety'), 4000, 'curiosa'), 3500);
            lastUsedFoods = [];
        }

        const stage = STAGES[currentStageIndex];
        const delayNextAction = 1000;
        if (stageOrders >= stage.goal) {
            if (currentStageIndex < STAGES.length - 1) {
                setTimeout(advanceStage, delayNextAction);
            } else {
                setTimeout(() => endGame(true), delayNextAction);
            }
        } else {
            setTimeout(generateOrder, delayNextAction);
        }
    }

    function handleWrongOrder() {
        playSound('erro');
        plateSlots.forEach(slot => slot.classList.add('wrong-plate'));
        setTimeout(() => plateSlots.forEach(slot => slot.classList.remove('wrong-plate')), 500);
        showMacawMessage(getRandomDialogue('hints'), 5000, 'triste');
    }

    function clearPlate() {
        plateContents = [null, null, null];
        plateSlots.forEach(slot => { slot.innerHTML = ''; });
        orderSlots.forEach(slot => slot.textContent = '');
        checkPlateFullness();
    }

    function updateScore(newScore) {
        score = newScore;
        scoreEl.textContent = score;
    }
    // --- FIM FUNÃ‡Ã•ES DE INTERAÃ‡ÃƒO ---

    // --- FUNÃ‡Ã•ES DA ARARA E FIM DE JOGO ---
    function showMacawMessage(text, duration = 4000, expression = 'falando') {
        if (macawTimeout) clearTimeout(macawTimeout);
        macawSprite.src = MACAW_SPRITES[expression];
        macawText.textContent = text;
        macawMessage.classList.remove('opacity-0');
        macawTimeout = setTimeout(() => {
            macawMessage.classList.add('opacity-0');
        }, duration);
    }

    function scheduleRandomDialogue() {
        if (otherDialogueTimeout) clearTimeout(otherDialogueTimeout);
        otherDialogueTimeout = setTimeout(() => {
            if (!isPaused && !isShowingIntro && macawMessage.classList.contains('opacity-0')) {
                showMacawMessage(getRandomDialogue('other'), 4000, 'falando');
            }
            scheduleRandomDialogue();
        }, 20000 + Math.random() * 15000);
    }

    function advanceStage() {
        isPaused = true;
        currentStageIndex++;
        if (currentStageIndex >= STAGES.length) {
            endGame(true);
            return;
        }
        const stage = STAGES[currentStageIndex];
        // --- NOVO: Pega o diÃ¡logo da etapa do objeto de traduÃ§Ã£o ---
        const stageDialogueKey = `stage${currentStageIndex + 1}`;
        const stageDialogue = translations[stageDialogueKey] || "PrÃ³xima etapa!";
        // --- FIM DA MUDANÃ‡A ---

        stageMacawSprite.src = MACAW_SPRITES.falando;
        document.getElementById('stage-title').textContent = stage.title;
        document.getElementById('stage-explanation').textContent = stageDialogue;

        stageTransitionScreen.classList.remove('hidden');
        stageTransitionScreen.classList.add('flex');
    }

    function resumeGame() {
        stageTransitionScreen.classList.add('hidden');
        stageTransitionScreen.classList.remove('flex');
        isPaused = false;
        setupStage();
    }

    function stopGameIntervals() {
        clearInterval(timerInterval);
        clearInterval(foodSpawnInterval);
        clearInterval(gameLoopInterval);
        clearTimeout(macawTimeout);
        clearTimeout(otherDialogueTimeout);
        timerInterval = null;
        foodSpawnInterval = null;
        gameLoopInterval = null;
        macawTimeout = null;
        otherDialogueTimeout = null;
        fadeOut('musica-fundo', 1000);
        stopSound('alerta-cronometro');
    }

    function endGame(isWinner) {
        isPaused = true;
        stopGameIntervals();
        playSound('avaliacao-final');
        gameHeader.classList.add('hidden');
        gameMain.classList.add('hidden');
        document.getElementById('final-score').textContent = score;
        const starsContainer = document.getElementById('stars-container');
        starsContainer.innerHTML = '';
        let stars = 0, message = "", title = "";
        const totalGoal = STAGES[STAGES.length-1].goal;

        if (isWinner) {
            // --- NOVO: Textos de vitÃ³ria traduzidos ---
            title = translations.end_titulo_vitoria;
            stars = 3;
            message = translations.performance[2];
            endMacawSprite.src = MACAW_SPRITES.feliz;
        } else {
            // --- NOVO: Textos de derrota traduzidos ---
            title = translations.end_titulo_padrao;
            if (score >= totalGoal) { // Venceu, mas o tempo acabou? (Caso de Borda)
                stars = 2;
                message = translations.performance[1];
                endMacawSprite.src = MACAW_SPRITES.feliz;
            } else if (score >= totalGoal * 0.5) {
                stars = 1;
                message = translations.performance[0];
                endMacawSprite.src = MACAW_SPRITES.curiosa;
            } else {
                stars = 0;
                message = getRandomDialogue('defeat');
                endMacawSprite.src = MACAW_SPRITES.triste;
            }
        }
        for(let i = 0; i < 3; i++) {
            const starSpan = document.createElement('span');
            starSpan.textContent = i < stars ? 'â­' : 'â˜†';
            starsContainer.appendChild(starSpan);
        }
        document.getElementById('end-title').textContent = title;
        document.getElementById('end-message').textContent = message;
        endScreen.classList.remove('hidden');
        endScreen.classList.add('flex');
    }
    // --- FIM FUNÃ‡Ã•ES DA ARARA E FIM DE JOGO ---

    // --- INICIALIZAÃ‡ÃƒO ---
    init();
>>>>>>> 1e29ed259d7cfc1a081e9058b6deb5b2e2b2d9e8
};